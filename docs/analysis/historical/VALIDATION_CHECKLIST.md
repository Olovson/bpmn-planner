# Validering av Genererade HTML-filer

## Förväntade filer efter generering av `mortgage-se-household.bpmn`

### 1. Filnivå-dokumentation
- **Filnamn**: `mortgage-se-household.html`
- **Sökväg i Storage**: `docs/slow/chatgpt/mortgage-se-household.bpmn/{versionHash}/mortgage-se-household.html`
- **Legacy sökväg**: `docs/mortgage-se-household.html`

### 2. Nodnivå-dokumentation (om genererad separat)
- **Filnamn**: `nodes/mortgage-se-household/register-household-economy-information.html`
- **Sökväg i Storage**: `docs/slow/chatgpt/mortgage-se-household.bpmn/{versionHash}/nodes/mortgage-se-household/register-household-economy-information.html`

## Valideringskriterier

### Filnivå-dokumentation (`mortgage-se-household.html`)

✅ **Struktur:**
- Innehåller `<!DOCTYPE html>` eller `<html>`
- Innehåller `<body>` tag med innehåll
- Innehåller `</html>` closing tag
- Minst 500 tecken lång (inte tom eller trunkerad)

✅ **Innehåll:**
- Refererar till `mortgage-se-household.bpmn` eller `mortgage-se-household`
- Innehåller information om user task `register-household-economy-information`
- Innehåller minst en `<h1>` eller `<h2>` heading
- Innehåller generation metadata (t.ex. "Generated by" eller "generation-meta")

✅ **Kvalitet:**
- Innehåller INTE "undefined" eller "null" som text
- Innehåller INTE tomma sektioner
- Innehåller faktiskt dokumentationsinnehåll (inte bara placeholder)

### Nodnivå-dokumentation (om genererad)

✅ **Struktur:**
- Samma som filnivå-dokumentation

✅ **Innehåll:**
- Innehåller element ID `register-household-economy-information`
- Innehåller information specifik för user task
- Innehåller Epic-dokumentation (summary, prerequisites, flowSteps, userStories, etc.)

## Sätt att validera

### Via Browser Console

1. Öppna appen i browser
2. Öppna Developer Tools (F12)
3. Gå till Console
4. Använd följande kod för att validera:

```javascript
// Validera filnivå-dokumentation
async function validateHouseholdDoc() {
  const supabase = window.supabase; // Om tillgänglig
  const bpmnFile = 'mortgage-se-household.bpmn';
  const docFileName = 'mortgage-se-household.html';
  
  // Hämta version hash
  const { data: fileData } = await supabase
    .from('bpmn_files')
    .select('content_hash')
    .eq('file_name', bpmnFile)
    .single();
  
  if (!fileData) {
    console.error('File not found in database');
    return;
  }
  
  const versionHash = fileData.content_hash;
  const storagePath = `docs/slow/chatgpt/${bpmnFile}/${versionHash}/${docFileName}`;
  
  // Hämta filen
  const { data, error } = await supabase.storage
    .from('bpmn-files')
    .download(storagePath);
  
  if (error) {
    console.error('Error downloading file:', error);
    return;
  }
  
  const html = await data.text();
  console.log('File size:', html.length, 'bytes');
  console.log('Has DOCTYPE:', html.includes('<!DOCTYPE html>'));
  console.log('Has body:', /<body[^>]*>/i.test(html));
  console.log('Has closing html:', html.includes('</html>'));
  console.log('Contains element ID:', html.includes('register-household-economy-information'));
  console.log('Contains BPMN file:', html.includes('mortgage-se-household'));
  console.log('Has headings:', /<h[1-6][^>]*>/i.test(html));
  console.log('Has undefined/null:', html.includes('undefined') || html.includes('null'));
  
  // Visa första 500 tecknen
  console.log('First 500 chars:', html.substring(0, 500));
}
```

### Via DocViewer

1. Navigera till: `#/doc-viewer/mortgage-se-household`
2. Kontrollera att dokumentationen laddas korrekt
3. Kontrollera att innehållet är komplett och korrekt

### Via Script (kräver .env.local)

Kör valideringsscriptet:
```bash
tsx scripts/validate-generated-html.ts mortgage-se-household.bpmn
```

## Förväntat innehåll för Household user task

Baserat på LLM-genereringen i loggarna, bör dokumentationen innehålla:

- **Summary**: Information om att kunder kan registrera hushållets ekonomiska information
- **Prerequisites**: 
  - Kunden måste ha påbörjat en bolåneansökan
  - Grundläggande kundinformation måste vara tillgänglig
- **Flow Steps**: Steg för registrering av ekonomisk information
- **User Stories**: User stories med role, goal, value, acceptance criteria
- **Implementation Notes**: Tekniska noteringar om implementationen

## Checklista

- [ ] Filen finns i Supabase Storage
- [ ] Filen har korrekt HTML-struktur
- [ ] Filen innehåller dokumentation för user task
- [ ] Filen innehåller Epic-innehåll (summary, prerequisites, etc.)
- [ ] Filen innehåller INTE "undefined" eller "null"
- [ ] Filen är inte tom eller trunkerad
- [ ] Filen kan öppnas i DocViewer utan fel
