// Vitest Snapshot v1, https://vitest.dev/guide/snapshot.html

exports[`documentation rendering regression (legacy vs schema) > Business Rule legacy HTML matches snapshot and equals schema HTML (normalized) > business-rule-legacy 1`] = `"<div class="doc-shell"> <section class="doc-section"> <span class="doc-badge">Business Rule / DMN</span> <h1>Eligibility Rule</h1> <ul> <li><strong>Regel-ID:</strong> Rule_Eligibility</li> <li><strong>BPMN-element:</strong> Rule_Eligibility (businessRuleTask)</li> <li><strong>Version:</strong> 1.0 (exempel) – uppdateras vid ändring</li> <li><strong>Ägare:</strong> Risk &amp; Kreditpolicy</li> <li><strong>Kreditprocess-steg:</strong> mortgage</li> </ul> </section> <section class="doc-section"> <h2>Sammanfattning &amp; scope</h2> <p>Eligibility Rule kombinerar flera risk- och kreditparametrar för att avgöra om en ansökan kan godkännas, ska skickas till manuell granskning eller avslås.</p> <p>Regeln säkerställer konsekvent tillämpning av kreditpolicy och riskmandat för målgrupperna.</p> <ul><li>Eligibility Rule avgör om en ansökan ligger inom bankens riktlinjer för kreditgivning.</li><li>Regeln används för att automatisera delar av kreditbeslutet och säkerställa likabehandling.</li><li>Omfattar endast den aktuella kreditprodukten – andra produkter hanteras i separata regler.</li></ul> </section> <section class="doc-section"> <h2>Förutsättningar &amp; kontext</h2> <ul><li>Triggas normalt efter <strong>Run Scoring</strong>.</li><li>Kräver att central kund- och ansökningsdata är komplett och validerad.</li><li>Förutsätter att nödvändiga externa registerslagningar (t.ex. UC, kreditupplysning) är gjorda.</li></ul> </section> <section class="doc-section"> <h2>Inputs &amp; datakällor</h2> <table> <tr> <th>Fält</th> <th>Datakälla</th> <th>Typ / format</th> <th>Obligatoriskt</th> <th>Validering</th> <th>Felhantering</th> </tr> <tr> <td>riskScore</td> <td>Kreditmotor / UC</td> <td>Tal (0–1000)</td> <td>Ja</td> <td>Inom definierat intervall</td> <td>Avslå eller skicka till manuell granskning</td> </tr> <tr> <td>debtToIncomeRatio</td> <td>Intern beräkning</td> <td>Decimal</td> <td>Ja</td> <td>&gt;= 0</td> <td>Flagga för manuell granskning vid saknade data</td> </tr> <tr> <td>loanToValue</td> <td>Fastighetsvärdering</td> <td>Procent</td> <td>Ja</td> <td>0–100 %</td> <td>Avslå vid orimliga värden</td> </tr> </table> </section> <section class="doc-section"> <h2>Beslutslogik (DMN / regler)</h2> <p>Regeln kombinerar riskScore, skuldsättning, belåningsgrad och eventuella riskflaggor för att fatta ett samlat beslut.</p> <ul><li>Hög riskScore och måttlig skuldsättning ger normalt auto-approve.</li><li>Mellanrisk eller ofullständig data leder till manuell granskning.</li><li>Tydliga exklusionskriterier (t.ex. betalningsanmärkningar eller sanktionsflaggor) ger auto-decline.</li></ul> </section> <section class="doc-section"> <h2>Output &amp; effekter</h2> <ul><li>Beslut: APPROVE, REFER (manuell granskning) eller DECLINE.</li><li>Processpåverkan: fortsätter till Final Decision vid APPROVE, pausas i manuell kö vid REFER, avslutas vid DECLINE.</li><li>Flaggor: t.ex. hög skuldsättning, bristfällig dokumentation, sanktions-/fraudträff.</li><li>Loggning: beslut, huvudparametrar och regelversion loggas för audit.</li></ul> </section> <section class="doc-section"> <h2>Affärsregler &amp; policystöd</h2> <ul><li>Stödjer intern kreditpolicy och mandat för respektive produkt och segment.</li><li>Bygger på dokumenterade riskramverk och beslutsmodeller.</li><li>Tar hänsyn till regulatoriska krav (t.ex. konsumentkreditlag, AML/KYC) på en övergripande nivå.</li></ul> </section> <section class="doc-section"> <h2>Nyckelscenarier / testkriterier (affärsnivå)</h2> <p class="muted">Nedan scenarier är affärsnära exempel och ska mappas mot automatiska tester.</p> <table> <tr> <th>Scenario-ID</th> <th>Scenario</th> <th>Input (kortfattat)</th> <th>Förväntat beslut/flagga</th> <th>Automatiskt test</th> </tr> <tr> <td>BR1</td> <td>Standardkund med låg risk</td> <td>Stabil inkomst, låg skuldsättning, normal kreditdata.</td> <td>Beslut: APPROVE utan manuell granskning.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> <tr> <td>BR2</td> <td>Kund med hög skuldsättning</td> <td>Hög debt-to-income, flera befintliga krediter.</td> <td>Beslut: REFER till manuell granskning med tydlig flagga.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> <tr> <td>BR3</td> <td>Kund med allvarliga betalningsanmärkningar</td> <td>Aktiva betalningsanmärkningar eller inkassoärenden.</td> <td>Beslut: DECLINE enligt exklusionskriterier.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> </table> </section> <section class="doc-section"> <h2>Implementation &amp; integrationsnoter</h2> <ul><li>DMN-tabell: <a href="/dmn/example.dmn">example.dmn</a></li><li>BPMN-koppling: Business Rule Task i filen mortgage.bpmn.</li><li>BPMN viewer: <a href="#/bpmn/mortgage.bpmn">Öppna noden i viewer</a></li><li>API: regelmotorn exponeras normalt via intern tjänst (t.ex. /decision/evaluate).</li><li>Beroenden: kreditmotor, kunddata, engagemangsdata och sanktions-/fraudregister.</li></ul> </section> <section class="doc-section"> <h2>Relaterade regler &amp; subprocesser</h2> <ul><li>Relaterad DMN-modell: <a href="/dmn/example.dmn">example.dmn</a></li><li>Relaterad BPMN-subprocess: <a href="#/bpmn/mortgage.bpmn">Visa i BPMN viewer</a></li><li>Överordnad nod: <a href="#/doc-viewer/nodes%2Fmortgage%2FTask_Scoring">Run Scoring</a></li></ul> </section> </div>"`;

exports[`documentation rendering regression (legacy vs schema) > Epic legacy HTML matches snapshot and equals schema HTML (normalized) > epic-legacy 1`] = `"<div class="doc-shell"> <section class="doc-section"> <span class="doc-badge">Epic</span> <h1>Approve Application</h1> <p class="muted">userTask i mortgage mellan Previous Step → Next Step.</p> <ul> <li><strong>BPMN-element:</strong> Task_Approve (userTask)</li> <li><strong>Kreditprocess-steg:</strong> mortgage</li> <li><strong>Swimlane/ägare:</strong> Kund / Rådgivare</li> <li><strong>Version &amp; datum:</strong> 1.0 (exempel) – uppdateras vid ändring</li> <li><strong>Ansvarig:</strong> Produktteam Kredit / Arkitektur</li> </ul> </section> <section class="doc-section"> <h2>Syfte &amp; Scope</h2> <p>Approve Application är ett delsteg i kreditflödet som säkerställer att rätt data, regler och interaktioner hanteras innan processen går vidare. Epiken bidrar till en spårbar och begriplig kreditprocess för både kund och interna användare.</p> <ul><li>Input: användarens/handläggarens uppgifter och val från Previous Step.</li></ul> </section> <section class="doc-section"> <h2>Trigger &amp; Förutsättningar</h2> <ul><li>Triggas normalt efter <strong>Previous Step</strong>.</li><li>Förutsätter att grundläggande kund- och ansökningsdata är validerade.</li><li>Eventuella föregående KYC/AML- och identitetskontroller ska vara godkända.</li></ul> </section> <section class="doc-section"> <h2>Huvudflöde (High-level scenario)</h2> <ol> <li>Användaren öppnar vyn och ser sammanfattad ansöknings- och kundinformation.</li><li>Formulär eller val presenteras baserat på föregående steg och riskprofil.</li><li>Användaren fyller i eller bekräftar uppgifter och skickar vidare.</li><li>Systemet validerar indata och uppdaterar processens status samt triggar nästa steg.</li> </ol> </section> <section class="doc-section"> <h2>Interaktioner &amp; Kanaler</h2> <ul><li>Kanal: web/app eller internt handläggargränssnitt beroende på roll.</li><li>UI ska vara förklarande, med tydlig koppling till kreditbeslut och nästa steg.</li><li>Felmeddelanden ska vara begripliga och vägleda till rätt åtgärd.</li></ul> </section> <section class="doc-section"> <h2>Data &amp; Kontrakt</h2> <ul><li>Input: Previous Step – underlag som triggar epiken.</li><li>Output: Next Step – status, flaggor och berikad data.</li></ul> </section> <section class="doc-section"> <h2>Affärsregler &amp; Policykoppling</h2> <ul><li>Regeln använder eller påverkas av relevanta Business Rule / DMN-beslut (se separat dokumentation).</li><li>Policykrav för risk, skuldsättning och produktvillkor ska vara spårbara via kopplade regler.</li><li>Eventuella AML/KYC-krav hanteras i samverkan med dedikerade kontrollnoder.</li></ul> </section> <section class="doc-section"> <h2>Testkriterier (affärsnivå)</h2> <p class="muted">Scenarierna nedan är affärsnära och ska mappas till automatiska tester.</p> <table> <tr> <th>Scenario-ID</th> <th>Scenario</th> <th>Typ</th> <th>Förväntat utfall</th> <th>Automatiskt test</th> </tr> <tr> <td>EPIC-S1</td> <td>Happy path</td> <td>Happy</td> <td>Epiken slutförs utan avvikelser och processen går vidare till nästa steg.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> <tr> <td>EPIC-S2</td> <td>Valideringsfel</td> <td>Edge</td> <td>Fel visas/loggas och användaren eller tjänsten kan hantera och rätta indata innan processen går vidare.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> <tr> <td>EPIC-S3</td> <td>Tekniskt fel / beroende nere</td> <td>Error</td> <td>Ärendet hanteras enligt felstrategi utan att data tappas, och fel loggas för uppföljning.</td> <td><code>tests/mortgage.example.spec.ts</code></td> </tr> </table> </section> <section class="doc-section"> <h2>Implementation Notes (för dev/test)</h2> <ul><li>Primära API:er/tjänster: t.ex. POST /api/approve-application för exekvering.</li><li>Viktiga fält och beslut bör loggas för att möjliggöra felsökning och efterkontroll.</li><li>Eventuella externa beroenden (kreditupplysning, folkbokföring, engagemangsdata) hanteras via plattformens integrationslager.</li><li>Prestanda- och tillgänglighetskrav hanteras på plattformsnivå men bör beaktas i designen.</li></ul> </section> <section class="doc-section"> <h2>Relaterade steg &amp; artefakter</h2> <ul><li>Närliggande noder: Previous Step (userTask), Next Step (serviceTask)</li><li>Visa processen: <a href="#/bpmn/mortgage.bpmn">BPMN viewer</a></li></ul> </section> </div>"`;

exports[`documentation rendering regression (legacy vs schema) > Feature Goal legacy HTML matches snapshot and equals schema HTML (normalized) > feature-goal-legacy 1`] = `"<div class="doc-shell"> <section class="doc-section"> <span class="doc-badge">Feature Goal</span> <h1>Application Assessment</h1> <ul> <li><strong>Initiativ:</strong> mortgage</li> <li><strong>BPMN Call Activity:</strong> Call_Feature (Application Assessment)</li> <li><strong>Regel/affärsägare:</strong> Produktägare Kredit / Risk & Policy</li> <li><strong>Kreditprocess-steg:</strong> mortgage</li> <li><strong>Version / datum:</strong> 1.0 (LLM-validerad) – uppdateras vid ändring</li> </ul> </section> <section class="doc-section"> <h2>Sammanfattning &amp; scope</h2> <p>Application Assessment samlar och koordinerar ett antal epics för att skapa ett sammanhängande kreditflöde med tydlig ansvarsfördelning och spårbarhet. Feature Goalet säkerställer att rätt data, regler och interaktioner finns på plats för att fatta välgrundade kreditbeslut.</p> </section> <section class="doc-section"> <h2>Omfattning &amp; Avgränsningar</h2> <ul><li>Ingår: Feature Goal <strong>Application Assessment</strong> binder ihop Start Application med Collect Applicant Data i initiativet mortgage.; Möjliggör ett sammanhängande kreditflöde där data, regler och interaktioner hänger ihop.; Fokuserar på att skapa ett spårbart underlag för kreditbeslut i hela initiativet.</li><li>Ingår inte: Ingår: end-to-end-flöde för det specifika kreditinitiativet.; Ingår inte: eftermarknadsprocesser och generella engagemangsändringar.; Ingår inte: tekniska implementationer i underliggande system – dessa dokumenteras separat.</li></ul> </section> <section class="doc-section"> <h2>Ingående Epics</h2> <table> <tr> <th>Epic-ID</th> <th>Epic-namn</th> <th>Beskrivning</th> <th>Team</th> </tr> <tr> <td>E1</td> <td>Collect Applicant Data</td> <td>Delsteg som bidrar till att application assessment uppnås.</td> <td>Frontend & UX</td> </tr> </table> </section> <section class="doc-section"> <h2>Affärsflöde</h2> <ol> <li>Initiativet startar i Start Application när en kreditprocess initieras.</li><li>Application Assessment samlar in, koordinerar och kvalitetssäkrar data och beslut från ingående epics.</li><li>Regler och policystöd appliceras på ett konsekvent sätt för att möjliggöra välgrundade kreditbeslut.</li><li>Resultat och status förs vidare till Collect Applicant Data och vidare in i efterföljande processer.</li> </ol> </section> <section class="doc-section"> <h2>Kritiska beroenden</h2> <ul><li>Tillgång till stabil kreditmotor och beslutsregler (DMN) med tydlig versionering.</li><li>Integrationer mot kunddata, engagemangsdata och externa källor (t.ex. UC, PSD2).</li><li>Överenskommen målbild för kundupplevelse, riskaptit och produktportfölj.</li></ul> </section> <section class="doc-section"> <h2>Affärs-scenarion</h2> <table> <tr> <th>Scenario</th> <th>Beskrivning</th> <th>Typ (Happy/Edge/Error)</th> <th>Förväntat resultat</th> </tr> <tr> <td>S1</td> <td>Normalflöde – komplett ansökan</td> <td>Happy</td> <td>Kunden får ett tydligt besked och flödet fortsätter utan manuell friktion.</td> </tr> <tr> <td>S2</td> <td>Ofullständig information</td> <td>Edge</td> <td>Kunden eller handläggaren styrs till komplettering, och beslut skjuts upp på ett kontrollerat sätt.</td> </tr> <tr> <td>S3</td> <td>Hög riskprofil</td> <td>Edge</td> <td>Ärendet flaggas för extra granskning eller avslag enligt policy.</td> </tr> </table> </section> <section class="doc-section"> <h2>Koppling till automatiska tester</h2> <p> Scenarion ovan mappas mot automatiska tester. Testblock och scenarionamngivning bör återspegla affärs-scenariernas ID och namn. <br />Testfil: <code>tests/mortgage.example.spec.ts</code> <br /> Testblock och scenarionamngivning bör återspegla affärs-scenariernas ID och namn. </p> </section> <section class="doc-section"> <h2>Implementation Notes (för dev)</h2> <ul><li>API- och integrationskontrakt ska vara dokumenterade per epic och nod.</li><li>Viktiga datafält bör speglas i loggar och domän-events för spårbarhet.</li><li>Edge-cases (t.ex. avbrutna flöden eller externa tjänstefel) ska hanteras konsekvent över epics.</li><li>DMN-kopplingar för risk, skuldsättning och produktvillkor dokumenteras i respektive Business Rule-dokumentation.</li></ul> </section> <section class="doc-section"> <h2>Relaterade regler / subprocesser</h2> <ul><li>Relaterad subprocess: <a href="#/bpmn/mortgage.bpmn">Visa i BPMN viewer</a></li><li>Relaterade regler/DMN: <a href="/dmn/example.dmn">example.dmn</a></li><li>Föregående noder: Start Application</li></ul> </section> </div>"`;
