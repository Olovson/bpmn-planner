<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Register loan details</title>
  <style>
    :root {
      color-scheme: light;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --card-bg: #ffffff;
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #475569;
      --border: #e2e8f0;
      --accent: #dbeafe;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.7;
    }
    .doc-shell {
      max-width: 960px;
      margin: 0 auto;
    }
    h1 {
      font-size: 1.5rem;
      margin: 0 0 24px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }
    h2 {
      color: var(--primary);
      margin: 24px 0 12px;
      font-size: 1.1rem;
    }
    p { margin: 0 0 12px; }
    ul { padding-left: 20px; margin: 0 0 12px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 8px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted { color: var(--text-muted); font-size: 0.9rem; }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
    .doc-section {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    .doc-section + .doc-section { margin-top: 16px; }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    .mermaid {
      margin: 16px 0;
      text-align: center;
    }
    details {
      margin: 12px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 8px;
      background: var(--accent);
      border-radius: 4px;
    }
    details summary:hover {
      background: #bfdbfe;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
  </script>
</head>
<body>
  <div class="doc-shell">
    
    
    
    <div class="doc-badge">üìÑ Lokal version ‚Äì F√∂rb√§ttrat inneh√•ll</div>

    <section class="doc-section">
      <h1>Epic ‚Äì Register loan details</h1>
      <ul>
        <li><strong>Epic-namn:</strong> Register loan details</li>
        <li><strong>BPMN-fil:</strong> mortgage-se-object.bpmn</li>
        <li><strong>Element ID:</strong> register-loan-details</li>
        <li><strong>Nodtyp:</strong> userTask</li>
        <li><strong>Version:</strong> 1.0 (exempel) ‚Äì uppdateras vid √§ndring</li>
        <li><strong>√Ñgare:</strong> Produktteam Kredit / Arkitektur</li>
        <li><strong>Confluence:</strong> <a href="#confluence-link">#confluence-link</a></li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>Syfte & V√§rde</h2>
      <p class="muted">Beskrivning av epikens syfte och aff√§rsv√§rde.</p>
      <div class="card">
        <p>Epiken ger kunden m√∂jlighet att registrera detaljerade l√•nedetaljer f√∂r bol√•net, inklusive l√•nebelopp, l√∂ptid, r√§ntetyp (fast/r√∂rlig), amorteringsplan, och eventuella specialvillkor. Detta √§r en kritisk del av bol√•neans√∂kan eftersom banken beh√∂ver veta exakt vilket l√•n kunden efterfr√•gar f√∂r att kunna g√∂ra en korrekt kreditbed√∂mning. Kunden kan v√§lja mellan olika l√•nealternativ baserat p√• fastighetsv√§rde, eget kapital, och bankens produkter. Systemet validerar att l√•nedetaljer √§r rimliga och att obligatoriska f√§lt √§r ifyllda innan informationen kan sparas och processen kan forts√§tta.</p>
      </div>
    </section>

    <section class="doc-section">
      <h2>Processkontext</h2>
      <p class="muted">Var epicen befinner sig i Application-processen.</p>
      <div class="card">
        <p>Epiken <strong>register-loan-details</strong> √§r en del av <strong>object</strong> subprocessen i <strong>mortgage-se-application</strong> processen. Den k√∂rs n√§r gateway "purposes" returnerar "Refinancing / Move loan" eller n√§r gateway "objects-valid" returnerar "Some" (vilket indikerar att vissa objekt beh√∂ver uppdateras). Efter att l√•nedetaljer har registrerats forts√§tter processen till <strong>object-information</strong> subprocessen f√∂r att validera objekt.</p>
        
        <details>
          <summary>Application Process Flow</summary>
          <div class="mermaid">
flowchart TD
    Start[Application Start]
    InternalData[internal-data-gathering<br/>subprocess]
    Gateway1[Parallel Gateway]
    Household[household<br/>subprocess]
    Stakeholders[stakeholders<br/>subprocess]
    Object[object<br/>subprocess]
    Gateway2[Parallel Gateway]
    Confirm[confirm-application]
    End[Application End]
    
    Start --> InternalData
    InternalData --> Gateway1
    Gateway1 -->|Parallel| Household
    Gateway1 -->|Parallel| Stakeholders
    Stakeholders --> Object
    Household --> Gateway2
    Stakeholders --> Gateway2
    Object --> Gateway2
    Gateway2 -->|All complete| Confirm
    Confirm --> End
    
    style Object fill:#1d4ed8,color:#fff
    style RegisterLoan fill:#3b82f6,color:#fff
          </div>
          <p class="muted">Application Process Flow visar √∂vergripande fl√∂de: Application startar ‚Üí internal-data-gathering ‚Üí parallellt household och stakeholders ‚Üí object ‚Üí confirm-application.</p>
        </details>
        
        <details>
          <summary>Object Subprocess Flow</summary>
          <div class="mermaid">
flowchart TD
    Start[Start Event]
    Purposes{Purposes?<br/>Gateway}
    RegisterSource[register-source-of-equity<br/>userTask]
    Gateway1[Gateway Merge]
    NeedsValuation{needs-valuation?<br/>Gateway}
    Valuate[valuate-property<br/>serviceTask]
    Gateway2[Gateway Merge]
    End[End Event]
    RegisterLoan[register-loan-details<br/>userTask]
    ObjectInfo[object-information<br/>subprocess]
    ObjectsValid{objects-valid?<br/>Gateway}
    Rejected[Object rejected]
    
    Start --> Purposes
    Purposes -->|Purchase| RegisterSource
    Purposes -->|Refinancing/Move loan| RegisterLoan
    RegisterSource --> Gateway1
    Gateway1 --> NeedsValuation
    NeedsValuation -->|Yes| Valuate
    NeedsValuation -->|No| Gateway2
    Valuate --> Gateway2
    Gateway2 --> End
    RegisterLoan --> ObjectInfo
    ObjectInfo --> ObjectsValid
    ObjectsValid -->|All| Gateway1
    ObjectsValid -->|Some| RegisterLoan
    ObjectsValid -->|None| Rejected
    
    style RegisterSource fill:#3b82f6,color:#fff
    style RegisterLoan fill:#3b82f6,color:#fff
    style Valuate fill:#3b82f6,color:#fff
    style ObjectInfo fill:#1d4ed8,color:#fff
    style Purposes fill:#fbbf24,color:#000
    style NeedsValuation fill:#fbbf24,color:#000
    style ObjectsValid fill:#fbbf24,color:#000
    style Rejected fill:#ef4444,color:#fff
          </div>
          <p class="muted">Object Subprocess Flow visar: Start ‚Üí purposes gateway ‚Üí register-source-of-equity (om Purchase) eller register-loan-details (om Refinancing/Move loan) ‚Üí object-information ‚Üí objects-valid ‚Üí (loop tillbaka om Some, eller forts√§tt om All).</p>
        </details>
        
        <h3>F√∂reg√•ende steg</h3>
        <ul>
          <li><strong>Gateway "purposes":</strong> M√•ste returnera "Refinancing / Move loan" f√∂r att register-loan-details ska k√∂ras f√∂rsta g√•ngen</li>
          <li><strong>Gateway "objects-valid":</strong> Om den returnerar "Some" loopar processen tillbaka till register-loan-details</li>
        </ul>
        
        <h3>Efterf√∂ljande steg</h3>
        <ul>
          <li><strong>object-information:</strong> Subprocess som validerar objektinformation efter att l√•nedetaljer har registrerats</li>
          <li><strong>objects-valid:</strong> Gateway som avg√∂r om objekt √§r giltiga (All/Some/None)</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Anv√§ndarupplevelse</h2>
      <p class="muted">Beskrivning av anv√§ndarupplevelsen f√∂r b√•de s√∂kande (kund) och anst√§lld (r√•dgivare/admin).</p>
      
      <h3>S√∂kande (Kund)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Kunden ser ett formul√§r f√∂r att registrera l√•nedetaljer med sektioner f√∂r l√•nebelopp, l√∂ptid, r√§ntetyp, amorteringsplan, och eventuella specialvillkor. Formul√§ret kan visa rekommenderade l√•nealternativ baserat p√• fastighetsv√§rde och eget kapital.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Kunden √∂ppnar formul√§ret f√∂r l√•nedetaljer</li><li>Kunden ser rekommenderade l√•nealternativ baserat p√• fastighetsv√§rde och eget kapital</li><li>Kunden v√§ljer eller anpassar l√•nebelopp, l√∂ptid, r√§ntetyp (fast/r√∂rlig), och amorteringsplan</li><li>Kunden kan l√§gga till eventuella specialvillkor eller √∂nskem√•l</li><li>Systemet validerar att l√•nedetaljer √§r rimliga och att obligatoriska f√§lt √§r ifyllda</li><li>Kunden bekr√§ftar och sparar informationen</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Fyll i formul√§r, V√§lj l√•nealternativ, Anpassa l√•nebelopp och l√∂ptid, V√§lj r√§ntetyp, V√§lj amorteringsplan, Spara som draft, Bekr√§fta och spara</li>
          <li><strong>Design:</strong> <a href="#figma-link">[L√§nk till Figma-design]</a></li>
          
        </ul>
        
        <details>
          <summary>User Journey Map</summary>
          <div class="mermaid">
flowchart LR
    Start[Start<br/>√ñppna formul√§r]
    View[Visa rekommenderade<br/>l√•nealternativ]
    Select[V√§lj eller anpassa<br/>l√•nedetaljer]
    Validate[Validera<br/>l√•nedetaljer]
    Confirm[Bekr√§fta och<br/>spara]
    Complete[Klart<br/>Forts√§tt process]
    
    Start -->|Laddar formul√§r| View
    View -->|Ser alternativ| Select
    Select -->|Fyller i| Validate
    Validate -->|Validering OK| Confirm
    Validate -->|Validering misslyckas| Select
    Confirm -->|Sparar| Complete
    
    style Start fill:#dbeafe,color:#000
    style View fill:#bfdbfe,color:#000
    style Select fill:#93c5fd,color:#000
    style Validate fill:#fbbf24,color:#000
    style Confirm fill:#10b981,color:#fff
    style Complete fill:#059669,color:#fff
          </div>
          <p class="muted">User Journey Map visar kundens resa fr√•n start till bekr√§ftelse, inklusive touchpoints och tidslinje.</p>
        </details>
        
        <details>
          <summary>Interaktionsfl√∂de</summary>
          <div class="mermaid">
sequenceDiagram
    participant User as Kund/Handl√§ggare
    participant UI as UI Formul√§r
    participant API as API Service
    participant Calculator as Payment Calculator
    participant Validator as Validation Service
    participant Store as Loan Data Store
    
    User->>UI: √ñppna formul√§r f√∂r l√•nedetaljer
    UI->>API: H√§mta rekommenderade l√•nealternativ
    API-->>UI: L√•nealternativ (baserat p√• fastighetsv√§rde, eget kapital)
    UI-->>User: Visar formul√§r + rekommenderade alternativ
    
    User->>UI: V√§ljer eller anpassar l√•nebelopp, l√∂ptid, r√§ntetyp
    UI->>Calculator: Ber√§kna m√•nadskostnad (realtid)
    Calculator-->>UI: M√•nadskostnad
    UI-->>User: Visar m√•nadskostnad
    
    User->>UI: Fyller i amorteringsplan, specialvillkor
    User->>UI: Klickar "Spara som draft" eller "Bekr√§fta"
    
    alt Bekr√§fta
        UI->>Validator: Validera l√•nedetaljer
        Validator-->>UI: Valideringsresultat
        
        alt Validering OK
            UI->>API: Spara l√•nedetaljer
            API->>Store: Spara l√•nedetaljer + m√•nadskostnad
            Store-->>API: Bekr√§ftelse
            API-->>UI: Success
            UI-->>User: Bekr√§ftelse + forts√§tt till n√§sta steg
        else Validering misslyckas
            UI-->>User: Felmeddelanden (vilka f√§lt beh√∂ver korrigeras)
            User->>UI: Korrigerar information
        end
    else Spara som draft
        UI->>API: Spara som draft
        API->>Store: Spara draft
        Store-->>API: Bekr√§ftelse
        API-->>UI: Draft sparad
        UI-->>User: Draft sparad (kan √•terkomma senare)
    end
          </div>
          <p class="muted">Interaktionsfl√∂de visar UI-sk√§rmar/steg, anv√§ndarinteraktioner, systemresponser, valideringar och felhantering.</p>
        </details>
      </div>
      
      <h3>Anst√§lld (R√•dgivare/Admin)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Handl√§ggare ser samma formul√§r som kunden, men med ytterligare administrativa funktioner. Handl√§ggare kan se registrerade l√•nedetaljer, rekommenderade l√•nealternativ, och eventuella flaggor eller varningar.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Handl√§ggare √∂ppnar ans√∂kan och ser status f√∂r l√•nedetaljer</li><li>Handl√§ggare kan se registrerade l√•nedetaljer och rekommenderade l√•nealternativ</li><li>Handl√§ggare kan verifiera att l√•nedetaljer √§r rimliga och korrekta</li><li>Handl√§ggare kan komplettera eller korrigera information vid behov</li><li>Handl√§ggare kan registrera l√•nedetaljer √• kundens v√§gnar vid behov</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Granska registrerade l√•nedetaljer, Verifiera l√•nebelopp och l√∂ptid, Komplettera eller korrigera information, Registrera √• kundens v√§gnar (vid behov)</li>
          <li><strong>Design:</strong> <a href="#figma-link">[L√§nk till Figma-design]</a></li>
          
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Funktionellt fl√∂de</h2>
      <p class="muted">Steg-f√∂r-steg beskrivning av processen.</p>
      <div class="card">
        <ol>
          <li>Epiken triggas n√§r f√∂reg√•ende steg i object-processen har slutf√∂rts och kunden beh√∂ver registrera l√•nedetaljer.</li><li>Systemet presenterar formul√§r f√∂r l√•nedetaljer med sektioner f√∂r l√•nebelopp, l√∂ptid, r√§ntetyp, amorteringsplan, och eventuella specialvillkor.</li><li>Systemet ber√§knar rekommenderade l√•nealternativ baserat p√• fastighetsv√§rde, eget kapital, och bankens produkter.</li><li>Kunden eller handl√§ggare v√§ljer eller anpassar l√•nebelopp, l√∂ptid, r√§ntetyp (fast/r√∂rlig), och amorteringsplan. Systemet st√∂djer olika l√•nealternativ.</li><li>Systemet validerar att l√•nedetaljer √§r rimliga (t.ex. l√•nebelopp inte √∂verstiger fastighetsv√§rde minus eget kapital, l√∂ptid inom till√•tna gr√§nser) och att obligatoriska f√§lt √§r ifyllda.</li><li>Kunden eller handl√§ggare bekr√§ftar och sparar informationen. Systemet ber√§knar m√•nadskostnad baserat p√• l√•nedetaljer.</li><li>Efter bekr√§ftelse markeras l√•nedetaljer som registrerade och processen forts√§tter till n√§sta steg i object-processen eller kreditbeslut.</li>
        </ol>
        <p><strong>Beslutslogik:</strong> Epiken √§r en userTask d√§r anv√§ndaren m√•ste registrera l√•nedetaljer. Om validering misslyckas kan anv√§ndaren inte bekr√§fta och m√•ste korrigera informationen. Efter bekr√§ftelse forts√§tter processen automatiskt till n√§sta steg. Systemet kan rekommendera l√•nealternativ baserat p√• kundens profil och bankens produkter.</p>
        <p><strong>Felhantering:</strong> Om validering misslyckas visas tydliga felmeddelanden som indikerar vilka f√§lt som beh√∂ver korrigeras. Anv√§ndaren kan spara informationen som draft och √•terkomma senare. Om systemfel uppst√•r vid sparning loggas felet och anv√§ndaren informeras. Om l√•nebelopp √∂verstiger till√•tna gr√§nser kan anv√§ndaren justera belopp eller l√∂ptid.</p>
        <p><strong>Edge cases:</strong> Kunder med komplexa l√•nebehov (kan kr√§va anpassade l√∂sningar), kunder med ofullst√§ndig information (kan sparas som draft), l√•nebelopp som √∂verstiger fastighetsv√§rde minus eget kapital (valideras och avvisas), l√∂ptider utanf√∂r till√•tna gr√§nser (valideras och avvisas), kunder som √§ndrar information efter bekr√§ftelse (kan kr√§va ombekr√§ftelse).</p>
      </div>
      
      <details>
        <summary>Process Flow Diagram</summary>
        <div class="mermaid">
flowchart TD
    Start[Start<br/>Epik triggas]
    LoadForm[Ladda formul√§r<br/>+ rekommenderade alternativ]
    UserInput[Anv√§ndarinput<br/>L√•nebelopp, l√∂ptid, r√§ntetyp,<br/>amorteringsplan]
    Calculate[Ber√§kna<br/>m√•nadskostnad]
    Validate{Validering<br/>OK?}
    SaveDraft{Spara som<br/>draft?}
    Confirm[Bekr√§fta och<br/>spara]
    Save[Spara l√•nedetaljer<br/>+ m√•nadskostnad]
    Complete[Klart<br/>Forts√§tt process]
    Error[Felmeddelanden<br/>Korrigera information]
    
    Start --> LoadForm
    LoadForm --> UserInput
    UserInput --> Calculate
    Calculate --> Validate
    Validate -->|Nej| Error
    Error --> UserInput
    Validate -->|Ja| SaveDraft
    SaveDraft -->|Ja| Save
    SaveDraft -->|Nej| Confirm
    Confirm --> Save
    Save --> Complete
    
    style Start fill:#1d4ed8,color:#fff
    style LoadForm fill:#3b82f6,color:#fff
    style UserInput fill:#60a5fa,color:#fff
    style Calculate fill:#93c5fd,color:#000
    style Validate fill:#fbbf24,color:#000
    style Confirm fill:#10b981,color:#fff
    style Save fill:#10b981,color:#fff
    style Complete fill:#059669,color:#fff
    style Error fill:#ef4444,color:#fff
        </div>
        <p class="muted">Process Flow Diagram visar steg-f√∂r-steg fl√∂de: ladda formul√§r, anv√§ndarinput, ber√§kning, validering, draft-sparning, bekr√§ftelse, och sparning.</p>
      </details>
    </section>

    <section class="doc-section">
      <h2>Inputs & Datak√§llor</h2>
      <p class="muted">Beskrivning av inputs och datak√§llor (interna och externa).</p>
      
      <h3>Inputs</h3>
      <p class="muted">Data som epiken tar emot fr√•n f√∂reg√•ende steg eller anv√§ndaren.</p>
      <table>
        <tr>
          <th>Input</th>
          <th>K√§lla</th>
          <th>Typ</th>
          <th>Obligatoriskt</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Fastighetsv√§rde och eget kapital</td>
          <td>Valuate-property (serviceTask), register-source-of-equity (userTask)</td>
          <td>PropertyValue, EquityAmount</td>
          <td>Ja</td>
          <td>F√∂r att ber√§kna maximalt l√•nebelopp och rekommenderade l√•nealternativ</td>
        </tr>
        <tr>
          <td>Bankens produkter och l√•nealternativ</td>
          <td>Product Catalog eller konfiguration</td>
          <td>LoanProducts</td>
          <td>Ja</td>
          <td>F√∂r att presentera rekommenderade l√•nealternativ baserat p√• kundens profil</td>
        </tr>
        <tr>
          <td>Ans√∂knings-ID</td>
          <td>Processkontext</td>
          <td>String/UUID</td>
          <td>Ja</td>
          <td>F√∂r att koppla registrerade l√•nedetaljer till r√§tt ans√∂kan</td>
        </tr>
      </table>

      <h3>Datak√§llor</h3>
      <p class="muted">System och k√§llor som epiken h√§mtar data fr√•n.</p>
      
      
      <h4>Interna datak√§llor (bankens system)</h4>
      <ul>
        <li><strong>Application DB:</strong> Ans√∂kningsdata, fastighetsv√§rde, och eget kapital</li>
        <li><strong>Product Catalog:</strong> Bankens produkter och l√•nealternativ f√∂r att presentera rekommenderade alternativ</li>
        <li><strong>Loan Data Store:</strong> Tidigare registrerade l√•nedetaljer om tillg√§nglig</li>
      </ul>
      

      
      <h4>Externa APIs</h4>
      <ul>
        <li>Inga externa APIs ‚Äì all data registreras av kunden eller handl√§ggare. L√•nedetaljer kan kompletteras med r√§ntekalkyler fr√•n bankens system.</li>
      </ul>
      

      
      <h4>Databaser</h4>
      <ul>
        <li><strong>Application DB:</strong> PostgreSQL-databas f√∂r ans√∂kningsdata och processkontext</li>
        <li><strong>Loan Data Store:</strong> Lagrar registrerade l√•nedetaljer f√∂r anv√§ndning i efterf√∂ljande steg</li>
      </ul>
      

      
    </section>

    

    <section class="doc-section">
      <h2>Outputs</h2>
      <p class="muted">Data som skapas, uppdateras eller skickas vidare.</p>
      <table>
        <tr>
          <th>Output</th>
          <th>Mottagare</th>
          <th>Typ</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Registrerade l√•nedetaljer (l√•nebelopp, l√∂ptid, r√§ntetyp, amorteringsplan)</td>
          <td>Loan Data Store, efterf√∂ljande steg</td>
          <td>LoanDetails</td>
          <td>Strukturerade l√•nedetaljer inklusive l√•nebelopp, l√∂ptid, r√§ntetyp (fast/r√∂rlig), amorteringsplan, och eventuella specialvillkor</td>
        </tr>
        <tr>
          <td>Ber√§knad m√•nadskostnad</td>
          <td>Processkontext, efterf√∂ljande steg</td>
          <td>MonthlyPayment</td>
          <td>Systember√§knad m√•nadskostnad baserat p√• l√•nedetaljer f√∂r anv√§ndning i kreditbed√∂mning</td>
        </tr>
        <tr>
          <td>Registreringsstatus och metadata</td>
          <td>Processkontext, loggsystem</td>
          <td>RegistrationStatus</td>
          <td>Status f√∂r registreringen (completed/draft), timestamp, anv√§ndar-ID, och eventuella flaggor</td>
        </tr>
      </table>
    </section>

    
    <section class="doc-section">
      <h2>Arkitektur & Systeminteraktioner</h2>
      <p class="muted">Beskrivning av systemarkitektur, integrationer och teknisk stack.</p>
      <div class="card">
        <ul>
          
          
          
          <li><strong>System som interagerar:</strong>
            <ul>
              <li><strong>Application DB:</strong> PostgreSQL-databas f√∂r ans√∂kningsdata och processkontext</li>
              <li><strong>Loan Data Store:</strong> Lagrar registrerade l√•nedetaljer</li>
              <li><strong>Product Catalog:</strong> Bankens produkter och l√•nealternativ</li>
              <li><strong>Payment Calculator Service:</strong> Tj√§nst f√∂r ber√§kning av m√•nadskostnad</li>
            </ul>
          </li>
          
          <li><strong>Integrationer:</strong>
            <ul>
              <li><strong>API-integrationer:</strong> REST API f√∂r att spara l√•nedetaljer och h√§mta l√•nealternativ. API:et exponerar endpoints f√∂r att registrera l√•nedetaljer, h√§mta rekommenderade l√•nealternativ, ber√§kna m√•nadskostnad, och validera l√•nedetaljer.</li>
              <li><strong>Event-integrationer:</strong> Processen triggas n√§r f√∂reg√•ende steg i object-processen √§r slutf√∂rd. Vid bekr√§ftelse publiceras event f√∂r att trigga n√§sta steg i processen eller kreditbeslut.</li>
              <li><strong>Databas-integrationer:</strong> PostgreSQL f√∂r ans√∂kningsdata. Loan Data Store f√∂r lagring av registrerade l√•nedetaljer.</li>
            </ul>
          </li>
          
          <li><strong>Teknisk stack:</strong>
            <ul>
              <li>BPMN-processmotor (Camunda) f√∂r orkestrering</li>
              <li>REST API f√∂r anv√§ndarinteraktion</li>
              <li>PostgreSQL f√∂r datalagring</li>
              <li>Frontend-komponenter f√∂r l√•neformul√§r</li>
            </ul>
          </li>
          
          
          
        </ul>
      </div>
    </section>
    

    

    <section class="doc-section">
      <h2>Aff√§rsregler & Beroenden</h2>
      <p class="muted">Beskrivning av aff√§rsregler, kreditregler och beroenden.</p>
      <div class="card">
        <h3>Aff√§rsregler</h3>
        <ul>
          <li><strong>Validering:</strong> L√•nebelopp m√•ste vara inom till√•tna gr√§nser (t.ex. max 85% av fastighetsv√§rde minus eget kapital). L√∂ptid m√•ste vara inom till√•tna gr√§nser (t.ex. 5-30 √•r). R√§ntetyp m√•ste vara giltig (fast eller r√∂rlig). Obligatoriska f√§lt (t.ex. l√•nebelopp, l√∂ptid, r√§ntetyp) m√•ste vara ifyllda innan bekr√§ftelse.</li>
          <li><strong>L√•negr√§nser:</strong> Banken har olika l√•negr√§nser beroende p√• produkt och riskprofil. L√•nebelopp f√•r inte √∂verstiga fastighetsv√§rde minus eget kapital. Systemet b√∂r validera att l√•nebelopp √§r inom till√•tna gr√§nser.</li>
          <li><strong>R√§ntetyper:</strong> Kunden kan v√§lja mellan fast r√§nta (l√•st under en period) eller r√∂rlig r√§nta (varierar med marknadsr√§nta). Systemet b√∂r presentera b√•da alternativen med f√∂r- och nackdelar.</li>
          <li><strong>Amorteringsplan:</strong> Kunden kan v√§lja mellan olika amorteringsplaner (t.ex. rak amortering, annuitetsl√•n). Systemet b√∂r ber√§kna m√•nadskostnad baserat p√• vald plan.</li>
          <li><strong>Draft-funktionalitet:</strong> Kunder kan spara informationen som draft och √•terkomma senare f√∂r att komplettera. Draft-information sparas men processen kan inte forts√§tta f√∂rr√§n all obligatorisk information √§r ifylld och bekr√§ftad.</li>
          <li><strong>Kreditbed√∂mning:</strong> Registrerade l√•nedetaljer anv√§nds tillsammans med fastighetsv√§rde, eget kapital, och kundens ekonomi f√∂r att bed√∂ma kundens finansieringsm√∂jligheter i efterf√∂ljande steg.</li>
          <li><strong>Sp√•rbarhet:</strong> Alla √§ndringar m√•ste loggas med timestamp och anv√§ndar-ID f√∂r sp√•rbarhet och efterkontroll.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Test Information</h2>
      <p class="muted">Beskrivning av testscenarier, testdata och testmilj√∂er.</p>
      <div class="card">
        <h3>Testscenarier</h3>
        <ul>
          <li><strong>Normalfl√∂de med komplett underlag:</strong> Kunden eller handl√§ggaren har l√§mnat kompletta och konsistenta uppgifter som uppfyller grundl√§ggande krav.</li><li><strong>Delvis ofullst√§ndigt eller oklart underlag:</strong> Enstaka uppgifter saknas eller √§r mots√§gelsefulla, men √§rendet bed√∂ms kunna kompletteras utan att avbrytas.</li><li><strong>Tekniskt fel eller kritisk avvikelse:</strong> Centrala data inte kan l√§sas in, valideras eller sparas p√• ett s√§kert s√§tt.</li>
        </ul>

        <h3>Testdata</h3>
        <ul>
          <li>[Beskrivning av testdata som beh√∂vs]</li>
        </ul>

        <h3>Testmilj√∂er</h3>
        <ul>
          <li>[Milj√∂ 1: t.ex. "Local development"]</li>
          <li>[Milj√∂ 2: t.ex. "Staging"]</li>
        </ul>

        <h3>Automatiska tester</h3>
        <p>Aff√§rs-scenarierna EPIC-S1‚ÄìEPIC-S3 ska mappas mot automatiska tester d√§r scenario-ID och namn anv√§nds i testfallens ben√§mningar. Testerna b√∂r t√§cka normalfl√∂de, kompletteringsfall samt tekniska fel eller kritiska avvikelser.</p>
        
      </div>
    </section>

    <section class="doc-section">
      <h2>Felhantering & Edge Cases</h2>
      <p class="muted">Beskrivning av felhantering och edge cases.</p>
      
      <h3>Tekniska fel</h3>
      <div class="card">
        <ul>
          <li><strong>Databasfel:</strong> Vid databasfel n√§r l√•nedetaljer sparas (connection timeout, deadlock) ska systemet logga felet och flagga processen f√∂r manuell hantering. √ñverv√§g retry f√∂r tillf√§lliga databasfel. Anv√§ndaren b√∂r informeras om att data inte kunde sparas och att de kan f√∂rs√∂ka igen.</li>
          <li><strong>Session timeout:</strong> Om anv√§ndarens session g√•r ut innan l√•nedetaljer sparas ska systemet logga felet och informera anv√§ndaren. √ñverv√§g att spara l√•nedetaljer automatiskt n√§r anv√§ndaren fyller i information f√∂r att undvika dataf√∂rlust.</li>
          <li><strong>N√§tverksfel:</strong> Vid n√§tverksfel (connection refused, DNS failure) n√§r l√•nedetaljer sparas ska systemet logga felet och informera anv√§ndaren. √ñverv√§g retry f√∂r tillf√§lliga n√§tverksfel.</li>
        </ul>
      </div>
      
      <h3>Aff√§rsrelaterade fel</h3>
      <div class="card">
        <ul>
          <li><strong>Valideringsfel:</strong> Om validering misslyckas (t.ex. negativt l√•nebelopp, ofullst√§ndig information, l√•nebelopp √∂verstiger till√•tna gr√§nser) ska systemet visa tydliga felmeddelanden och l√•ta anv√§ndaren korrigera informationen. Validering ska ske b√•de p√• klientsidan (f√∂r snabb feedback) och serversidan (f√∂r s√§kerhet).</li>
          <li><strong>Ofullst√§ndig information:</strong> Om obligatoriska f√§lt saknas (t.ex. l√•nebelopp saknas, l√∂ptid saknas) ska systemet f√∂rhindra bekr√§ftelse och visa tydliga felmeddelanden. Anv√§ndaren b√∂r informeras om vilka f√§lt som saknas.</li>
          <li><strong>L√•negr√§nser:</strong> Om l√•nebelopp √∂verstiger till√•tna gr√§nser (max 85% av fastighetsv√§rde) ska systemet visa tydligt felmeddelande och l√•ta anv√§ndaren korrigera informationen. Anv√§ndaren b√∂r informeras om maximalt till√•tet l√•nebelopp.</li>
        </ul>
      </div>
      
      <h3>Edge cases</h3>
      <div class="card">
        <ul>
          <li><strong>Stora l√•nebelopp:</strong> Om l√•nebelopp √§r mycket stort (>10M SEK) ska systemet validera att detta √§r rimligt och flagga f√∂r manuell granskning om n√∂dv√§ndigt. √ñverv√§g att kr√§va s√§rskild godk√§nnande f√∂r stora l√•nebelopp.</li>
          <li><strong>L√•nga l√∂ptider:</strong> Om l√∂ptid √§r mycket l√•ng (>30 √•r) ska systemet validera att detta √§r rimligt och flagga f√∂r manuell granskning om n√∂dv√§ndigt. √ñverv√§g att kr√§va s√§rskild godk√§nnande f√∂r l√•nga l√∂ptider.</li>
          <li><strong>H√∂ga m√•nadskostnader:</strong> Om m√•nadskostnad √§r mycket h√∂g (>50% av disponibel inkomst) ska systemet identifiera detta och flagga f√∂r manuell granskning. Detta kan vara ett tecken p√• ekonomiska problem.</li>
          <li><strong>Historiska data:</strong> Om l√•nedetaljer √§ndras under ans√∂kningsprocessen ska systemet sp√•ra √§ndringar och logga dem f√∂r sp√•rbarhet. √ñverv√§g att kr√§va manuell granskning f√∂r stora √§ndringar.</li>
        </ul>
      </div>
      
      <h3>Retry-strategier</h3>
      <div class="card">
        <ul>
          <li><strong>Databas:</strong> Retry med exponentiell backoff (1s, 2s, 4s) f√∂r tillf√§lliga databasfel. Max 3 f√∂rs√∂k innan processen flaggas f√∂r manuell hantering.</li>
          <li><strong>Session:</strong> Om session g√•r ut ska systemet informera anv√§ndaren och ge m√∂jlighet att logga in igen. √ñverv√§g att spara l√•nedetaljer automatiskt f√∂r att undvika dataf√∂rlust.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Implementation Notes</h2>
      <p class="muted">Tekniska noteringar, k√§nda begr√§nsningar och framtida f√∂rb√§ttringar.</p>
      <div class="card">
        <ul>
          <li><strong>UI/UX:</strong> Formul√§ret b√∂r vara tydligt och l√§ttl√§st med tydliga sektioner f√∂r l√•nebelopp, l√∂ptid, r√§ntetyp, och amorteringsplan. St√∂d f√∂r att visa rekommenderade l√•nealternativ. Validering ska ske i realtid f√∂r snabb feedback. √ñverv√§g att visa m√•nadskostnad i realtid n√§r anv√§ndaren √§ndrar l√•nedetaljer.</li>
          <li><strong>Ber√§kningar:</strong> Systemet m√•ste ber√§kna m√•nadskostnad korrekt baserat p√• l√•nedetaljer. √ñverv√§g att visa b√•de m√•nadskostnad och total kostnad f√∂r transparens. Ber√§kningar b√∂r ske i realtid n√§r anv√§ndaren √§ndrar l√•nedetaljer.</li>
          <li><strong>Loggning:</strong> Loggning ska omfatta: n√§r l√•nedetaljer registrerades, vem som registrerade (kund/handl√§ggare), l√•nebelopp, l√∂ptid, r√§ntetyp, amorteringsplan, m√•nadskostnad, och eventuella flaggor. Alla √§ndringar ska loggas f√∂r sp√•rbarhet.</li>
          <li><strong>Prestanda:</strong> Formul√§ret b√∂r laddas snabbt (< 2 sekunder). Ber√§kningar (m√•nadskostnad) b√∂r ske i realtid n√§r anv√§ndaren √§ndrar l√•nedetaljer.</li>
          <li><strong>Datavalidering:</strong> Validera att l√•nebelopp √§r positiva tal och inom till√•tna gr√§nser. Verifiera att obligatoriska f√§lt finns med innan bekr√§ftelse till√•ts. Validera att l√∂ptid √§r inom till√•tna gr√§nser. Validering b√∂r ske b√•de p√• klientsidan (f√∂r snabb feedback) och serversidan (f√∂r s√§kerhet).</li>
          <li><strong>Framtida f√∂rb√§ttringar:</strong> √ñverv√§g att importera l√•nedetaljer fr√•n bankens system om kunden √§r befintlig kund. St√∂d f√∂r att j√§mf√∂ra olika l√•nealternativ. Integration med r√§ntekalkyler f√∂r mer exakta ber√§kningar.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Relaterade noder</h2>
      <p class="muted">L√§nkar till relaterade epics, feature goals och business rules.</p>
      
      <details>
        <summary>Beroendediagram</summary>
        <div class="mermaid">
flowchart LR
    Start[Start Event]
    Purposes{Purposes?<br/>Gateway}
    Gateway1[Gateway Merge]
    Current[register-loan-details<br/>userTask]
    ObjectInfo[object-information<br/>subprocess]
    ObjectsValid{objects-valid?<br/>Gateway}
    Gateway2[Gateway Merge]
    NeedsValuation{needs-valuation?<br/>Gateway}
    End[Object Subprocess<br/>End]
    
    Start --> Purposes
    Purposes -->|Refinancing/Move loan| Gateway1
    Gateway1 --> Current
    Current --> ObjectInfo
    ObjectInfo --> ObjectsValid
    ObjectsValid -->|All| Gateway2
    ObjectsValid -->|Some| Gateway1
    ObjectsValid -->|None| End
    Gateway2 --> NeedsValuation
    NeedsValuation --> End
    
    style Current fill:#3b82f6,color:#fff
    style ObjectInfo fill:#1d4ed8,color:#fff
    style Purposes fill:#fbbf24,color:#000
    style ObjectsValid fill:#fbbf24,color:#000
    style NeedsValuation fill:#fbbf24,color:#000
        </div>
        <p class="muted">Beroendediagram visar: Start ‚Üí purposes gateway ‚Üí register-loan-details (om Refinancing/Move loan) ‚Üí object-information ‚Üí objects-valid ‚Üí (loop tillbaka om Some, eller forts√§tt om All).</p>
      </details>
      
      <h3>F√∂reg√•ende steg</h3>
      <ul>
        <li><strong>Gateway "purposes":</strong> M√•ste returnera "Refinancing / Move loan" f√∂r att register-loan-details ska k√∂ras f√∂rsta g√•ngen</li>
        <li><strong>Gateway "objects-valid":</strong> Om den returnerar "Some" loopar processen tillbaka till register-loan-details</li>
      </ul>
      
      <h3>Efterf√∂ljande steg</h3>
      <ul>
        <li><strong>object-information:</strong> Subprocess som validerar objektinformation efter att l√•nedetaljer har registrerats</li>
        <li><strong>objects-valid:</strong> Gateway som avg√∂r om objekt √§r giltiga (All/Some/None)</li>
        <li><strong>needs-valuation:</strong> Gateway som avg√∂r om fastighetsv√§rdering beh√∂vs (om All)</li>
      </ul>
      
      <h3>Parallella steg</h3>
      <ul>
        <li><strong>register-source-of-equity:</strong> K√∂rs parallellt om purposes √§r "Purchase"</li>
      </ul>
      
      <h3>Business Rules</h3>
      <ul>
        <li><strong>Valideringsregler:</strong> L√•nedetaljer m√•ste vara korrekta och kompletta</li>
        <li><strong>L√•negr√§nser:</strong> Max 85% av fastighetsv√§rde</li>
        <li><strong>Ber√§kningar:</strong> Regler f√∂r ber√§kning av m√•nadskostnad</li>
        <li><strong>Kreditbed√∂mning:</strong> Regler f√∂r anv√§ndning av l√•nedetaljer i kreditbed√∂mning</li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>BPMN ‚Äì Process (Bild)</h2>
      <p class="muted">Bild av BPMN-processen som epiken refererar till.</p>
      <div class="card">
        <p><strong>BPMN-diagram:</strong></p>
        <p><a href="#/bpmn/mortgage-se-object.bpmn">Visa BPMN-processen</a></p>
        <p class="muted">[Beskrivning av BPMN-processen eller l√§nk till BPMN-viewer. Bilden ska visa noden och dess kontext i processen.]</p>
      </div>
    </section>
  
  </div>
</body>
</html>