<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Assess stakeholder</title>
  <style>
    :root {
      color-scheme: light;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --card-bg: #ffffff;
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #475569;
      --border: #e2e8f0;
      --accent: #dbeafe;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.7;
    }
    .doc-shell {
      max-width: 960px;
      margin: 0 auto;
    }
    h1 {
      font-size: 1.5rem;
      margin: 0 0 24px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }
    h2 {
      color: var(--primary);
      margin: 24px 0 12px;
      font-size: 1.1rem;
    }
    p { margin: 0 0 12px; }
    ul { padding-left: 20px; margin: 0 0 12px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 8px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted { color: var(--text-muted); font-size: 0.9rem; }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
    .doc-section {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    .doc-section + .doc-section { margin-top: 16px; }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    .mermaid {
      margin: 16px 0;
      text-align: center;
    }
    details {
      margin: 12px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 8px;
      background: var(--accent);
      border-radius: 4px;
    }
    details summary:hover {
      background: #bfdbfe;
    }
    .dmn-table {
      margin: 16px 0;
      font-size: 0.9rem;
    }
    .dmn-table th {
      background: var(--primary);
      color: #fff;
      font-weight: 600;
    }
    .dmn-table td {
      vertical-align: top;
    }
    .dmn-input {
      background: #f0f9ff;
    }
    .dmn-output {
      background: #ecfdf5;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
  </script>
</head>
<body>
  <div class="doc-shell">
    
    
    
    <div class="doc-badge">üìÑ Lokal version ‚Äì F√∂rb√§ttrat inneh√•ll</div>

    <section class="doc-section">
      <h1>Epic ‚Äì Assess stakeholder</h1>
      <ul>
        <li><strong>Epic-namn:</strong> Assess stakeholder</li>
        <li><strong>BPMN-fil:</strong> mortgage-se-stakeholder.bpmn</li>
        <li><strong>Element ID:</strong> assess-stakeholder</li>
        <li><strong>Nodtyp:</strong> businessRuleTask</li>
        <li><strong>Version:</strong> 1.0 (exempel) ‚Äì uppdateras vid √§ndring</li>
        <li><strong>√Ñgare:</strong> Produktteam Kredit / Arkitektur</li>
        <li><strong>Confluence:</strong> <a href="#confluence-link">#confluence-link</a></li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>Syfte & V√§rde</h2>
      <p class="muted">Beskrivning av epikens syfte och aff√§rsv√§rde.</p>
      <div class="card">
        <p>Assess stakeholder √§r en DMN-beslutsregel (businessRuleTask) som evaluerar borrower capacity baserat p√• √•rsinkomst, DTI-ratio (debt-to-income), och kredithistorik. Regeln utv√§rderar om kunden har tillr√§cklig √•terbetalningsf√∂rm√•ga f√∂r det efterfr√•gade l√•net. Den analyserar kreditupplysning fr√•n fetch-credit-information, inkomstdata, och skulds√§ttning f√∂r att bed√∂ma kundens kreditv√§rdighet och riskprofil. Regeln returnerar ett beslut: APPROVED (kan forts√§tta) eller REJECTED (stoppas) tillsammans med riskkategori. Detta √§r en kritisk del av kreditbed√∂mningen och avg√∂r om processen kan forts√§tta till register-personal-economy-information.</p>
      </div>
    </section>

    <section class="doc-section">
      <h2>Processkontext</h2>
      <p class="muted">Var epicen befinner sig i Application-processen.</p>
      <div class="card">
        <p>Epiken <strong>assess-stakeholder</strong> √§r en del av <strong>stakeholder</strong> subprocessen i <strong>mortgage-se-application</strong> processen. Den k√∂rs efter <strong>fetch-credit-information</strong> och anv√§nder kreditupplysning, inkomstdata, och skulds√§ttning f√∂r borrower capacity evaluation. Resultatet avg√∂r om processen kan forts√§tta till <strong>register-personal-economy-information</strong> (om approved) eller om processen avslutas med "Rejected stakeholder evaluation" (om rejected).</p>
        
        <details>
          <summary>Application Process Flow</summary>
          <div class="mermaid">
flowchart TD
    Start[Application Start]
    InternalData[internal-data-gathering<br/>subprocess]
    Gateway1[Parallel Gateway]
    Household[household<br/>subprocess]
    Stakeholders[stakeholders<br/>subprocess]
    Object[object<br/>subprocess]
    Gateway2[Parallel Gateway]
    Confirm[confirm-application]
    End[Application End]
    
    Start --> InternalData
    InternalData --> Gateway1
    Gateway1 -->|Parallel| Household
    Gateway1 -->|Parallel| Stakeholders
    Stakeholders --> Object
    Household --> Gateway2
    Stakeholders --> Gateway2
    Object --> Gateway2
    Gateway2 -->|All complete| Confirm
    Confirm --> End
    
    style Stakeholders fill:#1d4ed8,color:#fff
    style Assess fill:#f59e0b,color:#fff
          </div>
          <p class="muted">Application Process Flow visar √∂vergripande fl√∂de: Application startar ‚Üí internal-data-gathering ‚Üí parallellt household och stakeholders ‚Üí object ‚Üí confirm-application.</p>
        </details>
        
        <details>
          <summary>Stakeholder Subprocess Flow</summary>
          <div class="mermaid">
flowchart LR
    Start[Start Event]
    HasConsented{has-consented-to-<br/>credit-check?}
    Consent[consent-to-credit-check<br/>userTask]
    DidConsent{did-consent?}
    Gateway[Gateway Merge]
    FetchPersonal[fetch-personal-information<br/>serviceTask]
    Evaluate[evaluate-personal-information<br/>businessRuleTask]
    Gateway2{is-personal-information-<br/>rejected?}
    FetchCredit[fetch-credit-information<br/>serviceTask]
    Assess[assess-stakeholder<br/>businessRuleTask]
    Gateway3{is-stakeholder-<br/>rejected?}
    Register[register-personal-economy-<br/>information<br/>userTask]
    End[End Event]
    Rejected1[Rejected credit check]
    Rejected2[Rejected personal<br/>information]
    Rejected3[Rejected stakeholder<br/>evaluation]
    
    Start --> HasConsented
    HasConsented -->|No| Consent
    HasConsented -->|Yes| Gateway
    Consent --> DidConsent
    DidConsent -->|Yes| Gateway
    DidConsent -->|No| Rejected1
    Gateway --> FetchPersonal
    FetchPersonal --> Evaluate
    Evaluate --> Gateway2
    Gateway2 -->|No| FetchCredit
    Gateway2 -->|Yes| Rejected2
    FetchCredit --> Assess
    Assess --> Gateway3
    Gateway3 -->|No| Register
    Gateway3 -->|Yes| Rejected3
    Register --> End
    
    style FetchPersonal fill:#3b82f6,color:#fff
    style Consent fill:#3b82f6,color:#fff
    style Evaluate fill:#f59e0b,color:#fff
    style FetchCredit fill:#3b82f6,color:#fff
    style Assess fill:#f59e0b,color:#fff
    style Register fill:#3b82f6,color:#fff
    style HasConsented fill:#fbbf24,color:#000
    style DidConsent fill:#fbbf24,color:#000
    style Gateway2 fill:#fbbf24,color:#000
    style Gateway3 fill:#fbbf24,color:#000
    style Rejected1 fill:#ef4444,color:#fff
    style Rejected2 fill:#ef4444,color:#fff
    style Rejected3 fill:#ef4444,color:#fff
          </div>
          <p class="muted">Stakeholder Subprocess Flow visar: Start ‚Üí has-consented-to-credit-check ‚Üí consent-to-credit-check (om No) ‚Üí did-consent ‚Üí fetch-personal-information ‚Üí evaluate-personal-information ‚Üí fetch-credit-information ‚Üí assess-stakeholder ‚Üí register-personal-economy-information (om approved).</p>
        </details>
        
        <h3>F√∂reg√•ende steg</h3>
        <ul>
          <li><strong>fetch-credit-information:</strong> M√•ste vara slutf√∂rd f√∂r att kreditupplysning ska vara tillg√§nglig</li>
          <li><strong>fetch-engagements:</strong> M√•ste vara slutf√∂rd (fr√•n internal-data-gathering) f√∂r att totala skulder ska kunna ber√§knas f√∂r DTI-ratio</li>
        </ul>
        
        <h3>Efterf√∂ljande steg</h3>
        <ul>
          <li><strong>Gateway "is-stakeholder-rejected":</strong> Anv√§nder resultatet fr√•n assess-stakeholder f√∂r att avg√∂ra om processen ska forts√§tta</li>
          <li><strong>register-personal-economy-information:</strong> K√∂rs om gateway returnerar "No" (approved)</li>
          <li><strong>Rejected stakeholder evaluation:</strong> Processen avslutas om gateway returnerar "Yes" (rejected)</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Anv√§ndarupplevelse</h2>
      <p class="muted">Beskrivning av anv√§ndarupplevelsen f√∂r b√•de s√∂kande (kund) och anst√§lld (r√•dgivare/admin).</p>
      
      <h3>S√∂kande (Kund)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Detta √§r en automatisk bakgrundsprocess (DMN businessRuleTask) som k√∂rs utan direkt anv√§ndarinteraktion. Kunden ser ingen direkt UI, men resultatet p√•verkar om ans√∂kan kan forts√§tta eller stoppas.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Processen k√∂rs automatiskt efter att kreditupplysning har h√§mtats</li><li>Kunden forts√§tter med ans√∂kningsprocessen medan bed√∂mningen g√∂rs i bakgrunden</li><li>Vid REJECTED f√•r kunden information om varf√∂r ans√∂kan stoppades</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Ingen direkt anv√§ndarinteraktion ‚Äì automatisk systemprocess</li>
          <li><strong>Design:</strong> N/A ‚Äì backend-process</li>
          
        </ul>
      </div>
      
      <h3>Anst√§lld (R√•dgivare/Admin)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Handl√§ggare kan se resultatet av bed√∂mningen i systemloggar eller admin-gr√§nssnitt. Resultatet (APPROVED/REJECTED) visas i ans√∂knings√∂versikten tillsammans med riskkategori, motivering, och eventuella flaggor.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Systemet k√∂r bed√∂mningen automatiskt n√§r kreditupplysning √§r tillg√§nglig</li><li>Handl√§ggare ser resultatet i ans√∂knings√∂versikten</li><li>Vid REJECTED kan handl√§ggare se motivering och riskkategori, och informera kunden</li><li>Handl√§ggare kan √∂verskriva beslutet vid behov (med r√§tt beh√∂righet)</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Granska bed√∂mningsresultat, Se riskkategori och motivering, √ñverskriv beslut (vid behov), Flagga f√∂r manuell granskning</li>
          <li><strong>Design:</strong> <a href="#figma-link">[L√§nk till Figma-design]</a></li>
          
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Funktionellt fl√∂de</h2>
      <p class="muted">Steg-f√∂r-steg beskrivning av processen.</p>
      <div class="card">
        <ol>
          <li>Epiken triggas automatiskt n√§r fetch-credit-information har slutf√∂rts och kreditupplysning √§r tillg√§nglig.</li><li>DMN-motorn l√§ser in relevanta indata: √•rsinkomst, DTI-ratio (debt-to-income), kredithistorik fr√•n kreditupplysning, och eventuella betalningsanm√§rkningar.</li><li>DMN-regeln utv√§rderar indata mot beslutslogik och aff√§rsregler f√∂r borrower capacity evaluation.</li><li>Regeln ber√§knar DTI-ratio baserat p√• totala skulder och √•rsinkomst, och bed√∂mer kredithistorik och betalningsanm√§rkningar.</li><li>Regeln returnerar ett beslut: APPROVED (kan forts√§tta) eller REJECTED (stoppas) tillsammans med riskkategori (t.ex. LOW, MEDIUM, HIGH) och motivering.</li><li>Resultatet sparas i processens datastore tillsammans med riskkategori, motivering, och eventuella flaggor.</li><li>Beroende p√• resultat forts√§tter processen: APPROVED ‚Üí register-personal-economy-information, REJECTED ‚Üí processen avslutas med fel.</li>
        </ol>
        <p><strong>Beslutslogik:</strong> Epiken √§r en businessRuleTask (DMN) som anv√§nder beslutslogik f√∂r att utv√§rdera borrower capacity. Gateway "is-stakeholder-rejected" anv√§nder resultatet f√∂r att avg√∂ra om processen ska forts√§tta (No ‚Üí register-personal-economy-information) eller stoppas (Yes ‚Üí processen avslutas). Beslutslogiken baseras p√• √•rsinkomst (t.ex. minimum 200k SEK), DTI-ratio (t.ex. maximum 50%), kredithistorik (inga betalningsanm√§rkningar), och eventuella varningar.</p>
        <p><strong>Felhantering:</strong> Om obligatoriska indata saknas eller DMN-motorn inte kan k√∂ras loggas felet och processen flaggas f√∂r manuell granskning. Om DMN-motorn returnerar fel eller timeout uppst√•r loggas detta och processen kan avbrytas eller skickas till felhantering. Alla beslut loggas f√∂r sp√•rbarhet och efterkontroll.</p>
        <p><strong>Edge cases:</strong> Kunder med gr√§nsv√§rden (t.ex. DTI-ratio 48-52%, inkomst 195-205k SEK), kunder med tillf√§llig inkomst eller variabel inkomst, kunder med gamla betalningsanm√§rkningar (kan kr√§va manuell bed√∂mning), kunder med h√∂g inkomst men h√∂g skulds√§ttning, kunder med ofullst√§ndig kreditupplysning (kan kr√§va manuell bed√∂mning).</p>
      </div>
      
      <details>
        <summary>Sekvensdiagram - Borrower Capacity Evaluation</summary>
        <div class="mermaid">
sequenceDiagram
    participant Camunda as BPMN Engine<br/>(Camunda)
    participant Service as Decision Service<br/>Assess Stakeholder
    participant DMN as DMN Decision Engine
    participant CreditStore as Credit Data Store
    participant EngagementsStore as Engagements Data Store
    participant StakeholderStore as Stakeholder Data Store
    participant AppDB as Application DB
    
    Note over Camunda: Triggas efter<br/>fetch-credit-information
    Camunda->>Service: Exekvera assess-stakeholder
    
    Service->>CreditStore: H√§mta kreditupplysning<br/>(kreditscore, betalningsanm√§rkningar)
    CreditStore-->>Service: Kreditupplysning
    
    Service->>EngagementsStore: H√§mta totala skulder
    EngagementsStore-->>Service: Totala skulder
    
    Service->>StakeholderStore: H√§mta √•rsinkomst
    StakeholderStore-->>Service: √Örsinkomst
    
    Service->>Service: Ber√§kna DTI-ratio<br/>(totala skulder / √•rsinkomst)
    
    Service->>DMN: Utv√§rdera borrower capacity<br/>(√•rsinkomst, DTI-ratio, kreditscore,<br/>betalningsanm√§rkningar)
    DMN->>DMN: Applicera beslutslogik<br/>(DMN Decision Table)
    DMN-->>Service: Beslut (APPROVED/REJECTED)<br/>+ Riskkategori + Motivering
    
    Service->>AppDB: Spara beslut + riskkategori<br/>+ motivering + metadata
    AppDB-->>Service: Bekr√§ftelse
    
    Service->>Camunda: Resultat (APPROVED/REJECTED)<br/>+ riskkategori
    
    alt APPROVED
        Camunda->>Camunda: Gateway: is-stakeholder-rejected = No
        Camunda->>Camunda: Forts√§tt till<br/>register-personal-economy-information
    else REJECTED
        Camunda->>Camunda: Gateway: is-stakeholder-rejected = Yes
        Camunda->>Camunda: Avsluta processen
    end
        </div>
        <p class="muted">Sekvensdiagram visar tidslinje f√∂r interaktioner: BPMN Engine triggar Decision Service, som h√§mtar data fr√•n flera Data Stores, ber√§knar DTI-ratio, anropar DMN Decision Engine f√∂r beslutslogik, sparar beslut, och gateway avg√∂r om processen forts√§tter eller avslutas.</p>
      </details>
    </section>

    <section class="doc-section">
      <h2>Inputs & Datak√§llor</h2>
      <p class="muted">Beskrivning av inputs och datak√§llor (interna och externa).</p>
      
      <h3>Inputs</h3>
      <p class="muted">Data som epiken tar emot fr√•n f√∂reg√•ende steg eller anv√§ndaren.</p>
      <table>
        <tr>
          <th>Input</th>
          <th>K√§lla</th>
          <th>Typ</th>
          <th>Obligatoriskt</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Kreditupplysning (kreditscore, betalningsanm√§rkningar, skulder, kredithistorik)</td>
          <td>Fetch-credit-information (serviceTask)</td>
          <td>CreditInformation</td>
          <td>Ja</td>
          <td>Kreditupplysning inklusive kreditscore, betalningsanm√§rkningar, skulder, och kredithistorik f√∂r borrower capacity evaluation</td>
        </tr>
        <tr>
          <td>√Örsinkomst</td>
          <td>Stakeholder-data eller ans√∂kningsdata</td>
          <td>Number</td>
          <td>Ja</td>
          <td>Kundens √•rsinkomst f√∂r att ber√§kna DTI-ratio och bed√∂ma √•terbetalningsf√∂rm√•ga</td>
        </tr>
        <tr>
          <td>Totala skulder</td>
          <td>Fetch-engagements (serviceTask) eller ans√∂kningsdata</td>
          <td>Number</td>
          <td>Ja</td>
          <td>Kundens totala skulder f√∂r att ber√§kna DTI-ratio (debt-to-income)</td>
        </tr>
        <tr>
          <td>Stakeholder-data</td>
          <td>F√∂reg√•ende steg i stakeholder-processen</td>
          <td>StakeholderData</td>
          <td>Ja</td>
          <td>Grundl√§ggande stakeholder-information f√∂r att identifiera r√§tt person</td>
        </tr>
      </table>

      <h3>Datak√§llor</h3>
      <p class="muted">System och k√§llor som epiken h√§mtar data fr√•n.</p>
      
      
      <h4>Interna datak√§llor (bankens system)</h4>
      <ul>
        <li><strong>Credit Data Store:</strong> Kreditupplysning fr√•n fetch-credit-information, inklusive kreditscore, betalningsanm√§rkningar, skulder, och kredithistorik</li>
        <li><strong>Engagements Data Store:</strong> Befintliga engagemang fr√•n fetch-engagements f√∂r att ber√§kna totala skulder</li>
        <li><strong>Stakeholder Data Store:</strong> Stakeholder-information inklusive √•rsinkomst</li>
      </ul>
      

      
      <h4>Externa APIs</h4>
      <ul>
        <li>Inga externa APIs ‚Äì all data h√§mtas fr√•n interna system. DMN-regeln anv√§nder redan h√§mtad kreditupplysning och engagemang.</li>
      </ul>
      

      
      <h4>Databaser</h4>
      <ul>
        <li><strong>Application DB:</strong> Ans√∂kningsdata och processkontext</li>
        <li><strong>DMN Decision Table:</strong> Beslutslogik f√∂r borrower capacity evaluation lagras i DMN-modell</li>
      </ul>
      

      
    </section>

    

    <section class="doc-section">
      <h2>Outputs</h2>
      <p class="muted">Data som skapas, uppdateras eller skickas vidare.</p>
      <table>
        <tr>
          <th>Output</th>
          <th>Mottagare</th>
          <th>Typ</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Bed√∂mningsresultat (APPROVED/REJECTED)</td>
          <td>Gateway "is-stakeholder-rejected", efterf√∂ljande steg</td>
          <td>AssessmentResult</td>
          <td>Beslut fr√•n DMN-regeln: APPROVED (kan forts√§tta) eller REJECTED (stoppas) tillsammans med riskkategori och motivering</td>
        </tr>
        <tr>
          <td>Riskkategori (LOW/MEDIUM/HIGH)</td>
          <td>Processkontext, loggsystem</td>
          <td>RiskCategory</td>
          <td>Riskkategori baserad p√• DTI-ratio, kreditscore, och kredithistorik f√∂r att bed√∂ma kundens riskprofil</td>
        </tr>
        <tr>
          <td>Motivering och flaggor</td>
          <td>Processkontext, loggsystem</td>
          <td>AssessmentReasoning</td>
          <td>Detaljerad motivering f√∂r beslutet, ber√§knad DTI-ratio, och eventuella flaggor eller varningar</td>
        </tr>
        <tr>
          <td>Validerad borrower capacity status</td>
          <td>Efterf√∂ljande steg</td>
          <td>ValidatedCapacity</td>
          <td>Status som anv√§nds av gateway "is-stakeholder-rejected" f√∂r att avg√∂ra om processen ska forts√§tta eller stoppas</td>
        </tr>
      </table>
    </section>

    
    <section class="doc-section">
      <h2>Arkitektur & Systeminteraktioner</h2>
      <p class="muted">Beskrivning av systemarkitektur, integrationer och teknisk stack.</p>
      <div class="card">
        <ul>
          
          
          
          <li><strong>System som interagerar:</strong>
            <ul>
              <li><strong>DMN Decision Engine:</strong> Camunda DMN eller liknande f√∂r att k√∂ra beslutslogik</li>
              <li><strong>Credit Data Store:</strong> Lagrar kreditupplysning fr√•n fetch-credit-information</li>
              <li><strong>Engagements Data Store:</strong> Lagrar engagemang fr√•n fetch-engagements</li>
              <li><strong>Application DB:</strong> PostgreSQL-databas f√∂r ans√∂kningsdata och processkontext</li>
            </ul>
          </li>
          
          <li><strong>Integrationer:</strong>
            <ul>
              <li><strong>API-integrationer:</strong> REST API f√∂r att k√∂ra DMN-beslutsregel. API:et exponerar endpoint /api/dmn/assess-stakeholder som tar indata (√•rsinkomst, DTI-ratio, kredithistorik) och returnerar beslut (APPROVED/REJECTED + riskkategori).</li>
              <li><strong>Event-integrationer:</strong> Processen triggas n√§r fetch-credit-information √§r slutf√∂rd. Vid beslut publiceras event f√∂r att trigga gateway "is-stakeholder-rejected".</li>
              <li><strong>Databas-integrationer:</strong> PostgreSQL f√∂r ans√∂kningsdata. DMN-beslutslogik lagras i DMN-modell och kan uppdateras utan kod√§ndringar.</li>
            </ul>
          </li>
          
          <li><strong>Teknisk stack:</strong>
            <ul>
              <li>BPMN-processmotor (Camunda) f√∂r orkestrering</li>
              <li>DMN Decision Engine f√∂r beslutslogik</li>
              <li>REST API f√∂r DMN-anrop</li>
              <li>PostgreSQL f√∂r datalagring</li>
            </ul>
          </li>
          
          <li><strong>Arkitekturdiagram:</strong>
            <details>
              <summary>C4 System Context Diagram</summary>
              <div class="mermaid">
graph TB
    Customer[üë§ Customer<br/>Kund]
    Handler[üë§ Handler<br/>Handl√§ggare]
    
    Epic[Assess Stakeholder<br/>businessRuleTask / DMN]
    
    CreditStore[(Credit Data Store<br/>Kreditupplysning)]
    EngagementsStore[(Engagements Data Store<br/>Skulder)]
    StakeholderStore[(Stakeholder Data Store<br/>√Örsinkomst)]
    AppDB[(Application DB<br/>PostgreSQL)]
    
    Customer -.->|Triggar via<br/>ans√∂kan| Epic
    Handler -.->|Granskar<br/>beslut| Epic
    
    Epic -->|L√§ser| CreditStore
    Epic -->|L√§ser| EngagementsStore
    Epic -->|L√§ser| StakeholderStore
    Epic -->|L√§ser/Sparar<br/>ans√∂kningsdata| AppDB
    Epic -->|Sparar<br/>beslut| AppDB
    
    style Epic fill:#1d4ed8,color:#fff
    style CreditStore fill:#10b981,color:#fff
    style EngagementsStore fill:#10b981,color:#fff
    style StakeholderStore fill:#10b981,color:#fff
    style AppDB fill:#10b981,color:#fff
              </div>
              <p class="muted">System Context Diagram visar epic i centrum med interna system (Credit Data Store, Engagements Data Store, Stakeholder Data Store, Application DB) och anv√§ndare (Customer, Handler).</p>
            </details>
            
            <details>
              <summary>Komponentdiagram</summary>
              <div class="mermaid">
graph TB
    BPMN[BPMN Engine<br/>Camunda]
    DecisionService[Decision Service<br/>Assess Stakeholder]
    DMNEngine[DMN Decision Engine<br/>Borrower Capacity]
    CreditStore[Credit Data Store<br/>Kreditupplysning]
    EngagementsStore[Engagements Data Store<br/>Skulder]
    StakeholderStore[Stakeholder Data Store<br/>√Örsinkomst]
    
    BPMN -->|Orkestrerar| DecisionService
    DecisionService -->|Anv√§nder| DMNEngine
    DecisionService -->|L√§ser| CreditStore
    DecisionService -->|L√§ser| EngagementsStore
    DecisionService -->|L√§ser| StakeholderStore
    DecisionService -->|Sparar beslut| AppDB[(Application DB)]
    
    DMNEngine -->|Utv√§rderar| DecisionService
    
    style BPMN fill:#1d4ed8,color:#fff
    style DecisionService fill:#3b82f6,color:#fff
    style DMNEngine fill:#8b5cf6,color:#fff
    style CreditStore fill:#10b981,color:#fff
    style EngagementsStore fill:#10b981,color:#fff
    style StakeholderStore fill:#10b981,color:#fff
              </div>
              <p class="muted">Komponentdiagram visar huvudkomponenter: BPMN Engine orkestrerar Decision Service, som anv√§nder DMN Decision Engine f√∂r beslutslogik, l√§ser data fr√•n flera Data Stores, och sparar beslut i Application DB.</p>
            </details>
          </li>
          
        </ul>
      </div>
    </section>
    

    

    <section class="doc-section">
      <h2>Aff√§rsregler & Beroenden</h2>
      <p class="muted">Beskrivning av aff√§rsregler, kreditregler och beroenden.</p>
      <div class="card">
        <h3>Aff√§rsregler</h3>
        <ul>
          <li><strong>DMN-beslutslogik:</strong> Regeln implementeras som DMN (Decision Model and Notation) beslutsregel med beslutslogik baserad p√• √•rsinkomst, DTI-ratio, och kredithistorik. Beslutslogiken kan uppdateras utan kod√§ndringar.</li>
          <li><strong>Borrower capacity-kriterier:</strong> Grundl√§ggande kriterier f√∂r godk√§nnande: √•rsinkomst (t.ex. minimum 200k SEK), DTI-ratio (t.ex. maximum 50%), kreditscore (t.ex. minimum 600), inga betalningsanm√§rkningar, och stabil kredithistorik.</li>
          <li><strong>Riskkategorisering:</strong> Kunder kategoriseras i riskkategorier (LOW, MEDIUM, HIGH) baserat p√• DTI-ratio, kreditscore, och kredithistorik. Riskkategorin anv√§nds f√∂r att bed√∂ma kundens riskprofil och kan p√•verka l√•nevillkor.</li>
          <li><strong>DTI-ratio ber√§kning:</strong> DTI-ratio ber√§knas som totala skulder / √•rsinkomst. Kunder med h√∂g DTI-ratio (> 50%) bed√∂ms ha h√∂gre risk och kan avvisas eller kr√§va manuell granskning.</li>
          <li><strong>Policykrav:</strong> Policykrav f√∂r risk, skulds√§ttning och produktvillkor ska vara sp√•rbara via kopplade regler. Regeln omfattar grundl√§ggande borrower capacity evaluation, inte fullst√§ndig kreditbed√∂mning.</li>
        </ul>
        
        <h3>DMN Decision Table</h3>
        <p class="muted">Beslutslogik f√∂r borrower capacity evaluation baserat p√• √•rsinkomst, DTI-ratio, kreditscore, och betalningsanm√§rkningar.</p>
        <table class="dmn-table">
          <tr>
            <th colspan="4" class="dmn-input">Input</th>
            <th colspan="3" class="dmn-output">Output</th>
          </tr>
          <tr>
            <th>√Örsinkomst<br/>(SEK)</th>
            <th>DTI-ratio<br/>(%)</th>
            <th>Kreditscore</th>
            <th>Betalnings-<br/>anm√§rkningar</th>
            <th>Beslut</th>
            <th>Riskkategori</th>
            <th>Motivering</th>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>‚â§ 50%</td>
            <td>‚â• 600</td>
            <td>Inga</td>
            <td><strong>APPROVED</strong></td>
            <td>LOW</td>
            <td>Alla kriterier uppfyllda. God √•terbetalningsf√∂rm√•ga.</td>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>‚â§ 50%</td>
            <td>‚â• 600</td>
            <td>Ja</td>
            <td><strong>REJECTED</strong></td>
            <td>HIGH</td>
            <td>Betalningsanm√§rkningar indikerar h√∂g risk.</td>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>40-50%</td>
            <td>550-600</td>
            <td>Inga</td>
            <td><strong>APPROVED</strong></td>
            <td>MEDIUM</td>
            <td>Gr√§nsv√§rden men acceptabel risk. Kr√§ver manuell granskning.</td>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>> 50%</td>
            <td>‚â• 600</td>
            <td>Inga</td>
            <td><strong>REJECTED</strong></td>
            <td>HIGH</td>
            <td>DTI-ratio f√∂r h√∂g. Otillr√§cklig √•terbetalningsf√∂rm√•ga.</td>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>‚â§ 50%</td>
            <td>&lt; 600</td>
            <td>Inga</td>
            <td><strong>REJECTED</strong></td>
            <td>MEDIUM</td>
            <td>Kreditscore f√∂r l√•g. Os√§ker kredithistorik.</td>
          </tr>
          <tr>
            <td>&lt; 200k</td>
            <td>‚â§ 50%</td>
            <td>‚â• 600</td>
            <td>Inga</td>
            <td><strong>REJECTED</strong></td>
            <td>MEDIUM</td>
            <td>√Örsinkomst f√∂r l√•g. Otillr√§cklig √•terbetalningsf√∂rm√•ga.</td>
          </tr>
          <tr>
            <td>‚â• 200k</td>
            <td>45-50%</td>
            <td>600-650</td>
            <td>Inga</td>
            <td><strong>APPROVED</strong></td>
            <td>MEDIUM</td>
            <td>Acceptabel risk. Kr√§ver manuell granskning.</td>
          </tr>
        </table>
        <p class="muted"><strong>Hit Policy:</strong> FIRST (f√∂rsta matchande regel anv√§nds)</p>
        
        <h3>Tr√∂skelv√§rden och Prioritering</h3>
        <table>
          <tr>
            <th>Kriterium</th>
            <th>Tr√∂skelv√§rde</th>
            <th>Prioritering</th>
            <th>Beskrivning</th>
          </tr>
          <tr>
            <td>√Örsinkomst</td>
            <td>Minimum 200k SEK</td>
            <td>H√∂g</td>
            <td>Kunder med √•rsinkomst under 200k SEK avvisas automatiskt</td>
          </tr>
          <tr>
            <td>DTI-ratio</td>
            <td>Maximum 50%</td>
            <td>H√∂g</td>
            <td>Kunder med DTI-ratio √∂ver 50% avvisas automatiskt</td>
          </tr>
          <tr>
            <td>Kreditscore</td>
            <td>Minimum 600</td>
            <td>H√∂g</td>
            <td>Kunder med kreditscore under 600 avvisas automatiskt</td>
          </tr>
          <tr>
            <td>Betalningsanm√§rkningar</td>
            <td>Inga</td>
            <td>Kritisk</td>
            <td>Kunder med betalningsanm√§rkningar avvisas automatiskt oavsett andra kriterier</td>
          </tr>
          <tr>
            <td>DTI-ratio (gr√§nsv√§rden)</td>
            <td>40-50%</td>
            <td>Medium</td>
            <td>Kunder med DTI-ratio 40-50% kan godk√§nnas men kr√§ver manuell granskning</td>
          </tr>
          <tr>
            <td>Kreditscore (gr√§nsv√§rden)</td>
            <td>550-600</td>
            <td>Medium</td>
            <td>Kunder med kreditscore 550-600 kan godk√§nnas men kr√§ver manuell granskning</td>
          </tr>
        </table>
        
        <details>
          <summary>Regeltr√§d / Decision Tree</summary>
          <div class="mermaid">
flowchart TD
    Start[Assess Stakeholder<br/>Borrower Capacity]
    
    CheckIncome{√Örsinkomst<br/>‚â• 200k SEK?}
    CheckDTI{DTI-ratio<br/>‚â§ 50%?}
    CheckScore{Kreditscore<br/>‚â• 600?}
    CheckPayment{Betalnings-<br/>anm√§rkningar?}
    
    Rejected1[REJECTED<br/>Risk: HIGH<br/>√Örsinkomst f√∂r l√•g]
    Rejected2[REJECTED<br/>Risk: HIGH<br/>DTI-ratio f√∂r h√∂g]
    Rejected3[REJECTED<br/>Risk: MEDIUM<br/>Kreditscore f√∂r l√•g]
    Rejected4[REJECTED<br/>Risk: HIGH<br/>Betalningsanm√§rkningar]
    
    Approved1[APPROVED<br/>Risk: LOW<br/>Alla kriterier uppfyllda]
    Approved2[APPROVED<br/>Risk: MEDIUM<br/>Gr√§nsv√§rden, kr√§ver granskning]
    
    Start --> CheckIncome
    CheckIncome -->|Nej| Rejected1
    CheckIncome -->|Ja| CheckDTI
    CheckDTI -->|Nej| Rejected2
    CheckDTI -->|Ja| CheckPayment
    CheckPayment -->|Ja| Rejected4
    CheckPayment -->|Nej| CheckScore
    CheckScore -->|Nej| Rejected3
    CheckScore -->|Ja| Approved1
    
    CheckDTI -->|40-50%| Approved2
    CheckScore -->|550-600| Approved2
    
    style Start fill:#1d4ed8,color:#fff
    style CheckIncome fill:#fbbf24,color:#000
    style CheckDTI fill:#fbbf24,color:#000
    style CheckScore fill:#fbbf24,color:#000
    style CheckPayment fill:#fbbf24,color:#000
    style Rejected1 fill:#ef4444,color:#fff
    style Rejected2 fill:#ef4444,color:#fff
    style Rejected3 fill:#ef4444,color:#fff
    style Rejected4 fill:#ef4444,color:#fff
    style Approved1 fill:#10b981,color:#fff
    style Approved2 fill:#f59e0b,color:#fff
          </div>
          <p class="muted">Regeltr√§d visar beslutslogik: F√∂rst kontrolleras √•rsinkomst, sedan DTI-ratio, betalningsanm√§rkningar, och slutligen kreditscore. Varje steg kan leda till APPROVED eller REJECTED med olika riskkategorier.</p>
        </details>
      </div>
    </section>

    <section class="doc-section">
      <h2>Test Information</h2>
      <p class="muted">Beskrivning av testscenarier, testdata och testmilj√∂er.</p>
      <div class="card">
        <h3>Testscenarier</h3>
        <ul>
          <li><strong>EPIC-S1: Normalfl√∂de - Alla kriterier uppfyllda (APPROVED, LOW risk):</strong> Kunden har √•rsinkomst ‚â• 200k SEK, DTI-ratio ‚â§ 50%, kreditscore ‚â• 600, och inga betalningsanm√§rkningar. DMN-regeln returnerar APPROVED med riskkategori LOW. Processen forts√§tter till register-personal-economy-information.</li>
          <li><strong>EPIC-S2: Betalningsanm√§rkningar - Automatisk avvisning (REJECTED, HIGH risk):</strong> Kunden har √•rsinkomst ‚â• 200k SEK, DTI-ratio ‚â§ 50%, kreditscore ‚â• 600, men har betalningsanm√§rkningar. DMN-regeln returnerar REJECTED med riskkategori HIGH oavsett andra kriterier. Processen stoppas via gateway "is-stakeholder-rejected".</li>
          <li><strong>EPIC-S3: Gr√§nsfall - Acceptabel risk med manuell granskning (APPROVED, MEDIUM risk):</strong> Kunden har √•rsinkomst ‚â• 200k SEK, DTI-ratio 40-50%, kreditscore 550-600, och inga betalningsanm√§rkningar. DMN-regeln returnerar APPROVED med riskkategori MEDIUM. Processen forts√§tter men flaggas f√∂r manuell granskning.</li>
          <li><strong>EPIC-S4: H√∂g DTI-ratio - Otillr√§cklig √•terbetalningsf√∂rm√•ga (REJECTED, HIGH risk):</strong> Kunden har √•rsinkomst ‚â• 200k SEK, DTI-ratio > 50%, kreditscore ‚â• 600, och inga betalningsanm√§rkningar. DMN-regeln returnerar REJECTED med riskkategori HIGH. Processen stoppas.</li>
          <li><strong>EPIC-S5: L√•g kreditscore - Os√§ker kredithistorik (REJECTED, MEDIUM risk):</strong> Kunden har √•rsinkomst ‚â• 200k SEK, DTI-ratio ‚â§ 50%, kreditscore < 600, och inga betalningsanm√§rkningar. DMN-regeln returnerar REJECTED med riskkategori MEDIUM. Processen stoppas.</li>
          <li><strong>EPIC-S6: L√•g √•rsinkomst - Otillr√§cklig √•terbetalningsf√∂rm√•ga (REJECTED, MEDIUM risk):</strong> Kunden har √•rsinkomst < 200k SEK, DTI-ratio ‚â§ 50%, kreditscore ‚â• 600, och inga betalningsanm√§rkningar. DMN-regeln returnerar REJECTED med riskkategori MEDIUM. Processen stoppas.</li>
          <li><strong>EPIC-S7: Tekniskt fel - DMN Engine timeout eller fel:</strong> DMN-motorn svarar inte, returnerar timeout, eller ger 500 Server Error. Systemet loggar felet, implementerar retry med exponentiell backoff, och anv√§nder fallback-beslut (REVIEW) om alla retries misslyckas. Processen flaggas f√∂r manuell granskning.</li>
          <li><strong>Edge case: Gr√§nsfall - DTI-ratio precis p√• gr√§nsen:</strong> Kunden har DTI-ratio 49.5% (precis under gr√§nsen) eller 50.5% (precis √∂ver gr√§nsen). Systemet ska hantera gr√§nsv√§rden korrekt och returnera APPROVED (MEDIUM risk) eller REJECTED (HIGH risk) baserat p√• exakt v√§rde.</li>
          <li><strong>Edge case: Gr√§nsfall - Kreditscore precis p√• gr√§nsen:</strong> Kunden har kreditscore 599 (precis under gr√§nsen) eller 600 (precis p√• gr√§nsen). Systemet ska hantera gr√§nsv√§rden korrekt och returnera REJECTED eller APPROVED baserat p√• exakt v√§rde.</li>
          <li><strong>Edge case: Delade engagemang:</strong> Kunden har delade engagemang (gemensamma l√•n med meds√∂kande). Systemet ska aggregera delade engagemang korrekt f√∂r DTI-ratio ber√§kning. Om aggregering misslyckas ska processen flaggas f√∂r manuell granskning.</li>
          <li><strong>Edge case: Ofullst√§ndig databild:</strong> Obligatoriska indata saknas (t.ex. √•rsinkomst saknas, kreditupplysning saknas, engagemang saknas). Systemet ska logga felet och flagga processen f√∂r manuell granskning (REVIEW). Processen kan inte forts√§tta utan dessa data.</li>
          <li><strong>Edge case: Inkonsistent data:</strong> Data fr√•n olika k√§llor √§r inkonsistenta (t.ex. olika √•rsinkomst i olika system, olika DTI-ratio ber√§kningar). Systemet ska identifiera inkonsistenser och flagga f√∂r manuell verifiering.</li>
        </ul>

        <h3>Testdata</h3>
        <ul>
          <li><strong>EPIC-S1 - Godk√§nd kund (APPROVED, LOW):</strong>
            <ul>
              <li>√Örsinkomst: 500k SEK</li>
              <li>DTI-ratio: 30%</li>
              <li>Kreditscore: 750</li>
              <li>Betalningsanm√§rkningar: Inga</li>
              <li>F√∂rv√§ntat resultat: APPROVED, LOW risk</li>
            </ul>
          </li>
          <li><strong>EPIC-S2 - Betalningsanm√§rkningar (REJECTED, HIGH):</strong>
            <ul>
              <li>√Örsinkomst: 500k SEK</li>
              <li>DTI-ratio: 30%</li>
              <li>Kreditscore: 750</li>
              <li>Betalningsanm√§rkningar: Ja (1 anm√§rkning fr√•n 2023)</li>
              <li>F√∂rv√§ntat resultat: REJECTED, HIGH risk</li>
            </ul>
          </li>
          <li><strong>EPIC-S3 - Gr√§nsfall (APPROVED, MEDIUM):</strong>
            <ul>
              <li>√Örsinkomst: 250k SEK</li>
              <li>DTI-ratio: 45%</li>
              <li>Kreditscore: 580</li>
              <li>Betalningsanm√§rkningar: Inga</li>
              <li>F√∂rv√§ntat resultat: APPROVED, MEDIUM risk</li>
            </ul>
          </li>
          <li><strong>EPIC-S4 - H√∂g DTI-ratio (REJECTED, HIGH):</strong>
            <ul>
              <li>√Örsinkomst: 300k SEK</li>
              <li>DTI-ratio: 55%</li>
              <li>Kreditscore: 700</li>
              <li>Betalningsanm√§rkningar: Inga</li>
              <li>F√∂rv√§ntat resultat: REJECTED, HIGH risk</li>
            </ul>
          </li>
          <li><strong>EPIC-S5 - L√•g kreditscore (REJECTED, MEDIUM):</strong>
            <ul>
              <li>√Örsinkomst: 400k SEK</li>
              <li>DTI-ratio: 35%</li>
              <li>Kreditscore: 550</li>
              <li>Betalningsanm√§rkningar: Inga</li>
              <li>F√∂rv√§ntat resultat: REJECTED, MEDIUM risk</li>
            </ul>
          </li>
          <li><strong>EPIC-S6 - L√•g √•rsinkomst (REJECTED, MEDIUM):</strong>
            <ul>
              <li>√Örsinkomst: 180k SEK</li>
              <li>DTI-ratio: 30%</li>
              <li>Kreditscore: 700</li>
              <li>Betalningsanm√§rkningar: Inga</li>
              <li>F√∂rv√§ntat resultat: REJECTED, MEDIUM risk</li>
            </ul>
          </li>
          <li><strong>Gr√§nsfall - DTI-ratio:</strong>
            <ul>
              <li>Testdata 1: DTI-ratio 49.5% ‚Üí F√∂rv√§ntat: APPROVED, MEDIUM risk</li>
              <li>Testdata 2: DTI-ratio 50.0% ‚Üí F√∂rv√§ntat: APPROVED, MEDIUM risk (gr√§nsv√§rde)</li>
              <li>Testdata 3: DTI-ratio 50.1% ‚Üí F√∂rv√§ntat: REJECTED, HIGH risk</li>
            </ul>
          </li>
          <li><strong>Gr√§nsfall - Kreditscore:</strong>
            <ul>
              <li>Testdata 1: Kreditscore 599 ‚Üí F√∂rv√§ntat: REJECTED, MEDIUM risk</li>
              <li>Testdata 2: Kreditscore 600 ‚Üí F√∂rv√§ntat: APPROVED, LOW risk (gr√§nsv√§rde)</li>
              <li>Testdata 3: Kreditscore 550 ‚Üí F√∂rv√§ntat: REJECTED eller APPROVED (MEDIUM risk) beroende p√• andra kriterier</li>
            </ul>
          </li>
          <li><strong>Gr√§nsfall - √Örsinkomst:</strong>
            <ul>
              <li>Testdata 1: √Örsinkomst 199k SEK ‚Üí F√∂rv√§ntat: REJECTED, MEDIUM risk</li>
              <li>Testdata 2: √Örsinkomst 200k SEK ‚Üí F√∂rv√§ntat: APPROVED eller REJECTED beroende p√• andra kriterier</li>
              <li>Testdata 3: √Örsinkomst 201k SEK ‚Üí F√∂rv√§ntat: APPROVED eller REJECTED beroende p√• andra kriterier</li>
            </ul>
          </li>
          <li><strong>Delade engagemang:</strong>
            <ul>
              <li>Kund med delade engagemang: 2 bol√•n (50% ansvar vardera), 1 personl√•n (100% ansvar)</li>
              <li>Totala skulder: 1.5M SEK (bol√•n) + 200k SEK (personl√•n) = 1.7M SEK</li>
              <li>√Örsinkomst: 500k SEK</li>
              <li>DTI-ratio: 340% (felaktig om delade engagemang inte aggregeras korrekt)</li>
              <li>Korrekt DTI-ratio: 170% (om delade engagemang aggregeras korrekt)</li>
            </ul>
          </li>
          <li><strong>Ofullst√§ndig databild:</strong>
            <ul>
              <li>Testdata 1: √Örsinkomst saknas ‚Üí F√∂rv√§ntat: REVIEW (manuell granskning)</li>
              <li>Testdata 2: Kreditupplysning saknas ‚Üí F√∂rv√§ntat: REVIEW (manuell granskning)</li>
              <li>Testdata 3: Engagemang saknas ‚Üí F√∂rv√§ntat: REVIEW (manuell granskning, DTI-ratio kan inte ber√§knas)</li>
            </ul>
          </li>
          <li><strong>Mock DMN-responser:</strong>
            <ul>
              <li>Success response: {"decision": "APPROVED", "riskCategory": "LOW", "reasoning": "Alla kriterier uppfyllda"}</li>
              <li>Rejection response: {"decision": "REJECTED", "riskCategory": "HIGH", "reasoning": "Betalningsanm√§rkningar indikerar h√∂g risk"}</li>
              <li>Review response: {"decision": "REVIEW", "riskCategory": "MEDIUM", "reasoning": "Ofullst√§ndig databild"}</li>
              <li>Error response: 500 Server Error, 503 Service Unavailable, timeout</li>
            </ul>
          </li>
        </ul>

        <h3>Testmilj√∂er</h3>
        <ul>
          <li><strong>Local development:</strong> Mock DMN-engine med lokala testdata. Mock-responser f√∂r alla scenarion (EPIC-S1 till EPIC-S7) och edge cases. Mock kreditupplysning och engagemang fr√•n fetch-credit-information och fetch-engagements.</li>
          <li><strong>Staging:</strong> Anslutning till staging-instans av DMN-engine. Realistiska testdata fr√•n staging-databas. Integration med staging-instanser av fetch-credit-information och fetch-engagements.</li>
          <li><strong>Integration test:</strong> Test mot isolerad testmilj√∂ med kontrollerade testdata. Fullst√§ndig integration med alla beroenden (kreditupplysning, engagemang, stakeholder-data). Verifiering av hela beslutsfl√∂det fr√•n indata till output.</li>
        </ul>

        <h3>Automatiska tester</h3>
        <p>Aff√§rs-scenarierna EPIC-S1‚ÄìEPIC-S7 ska mappas mot automatiska tester d√§r scenario-ID och namn anv√§nds i testfallens ben√§mningar. Testerna b√∂r t√§cka:</p>
        <ul>
          <li><strong>Normalfl√∂de (EPIC-S1):</strong> Verifiera att DMN-regeln returnerar APPROVED (LOW risk) n√§r alla kriterier √§r uppfyllda. Verifiera att beslutet p√•verkar gateway "is-stakeholder-rejected" korrekt (No ‚Üí processen forts√§tter).</li>
          <li><strong>Automatisk avvisning (EPIC-S2, S4, S5, S6):</strong> Verifiera att DMN-regeln returnerar REJECTED med korrekt riskkategori n√§r kriterier inte √§r uppfyllda. Verifiera att beslutet p√•verkar gateway "is-stakeholder-rejected" korrekt (Yes ‚Üí processen stoppas).</li>
          <li><strong>Gr√§nsfall (EPIC-S3):</strong> Verifiera att DMN-regeln returnerar APPROVED (MEDIUM risk) f√∂r gr√§nsv√§rden och att processen flaggas f√∂r manuell granskning. Verifiera att beslutet p√•verkar processfl√∂det korrekt.</li>
          <li><strong>Tekniska fel (EPIC-S7):</strong> Verifiera att systemet hanterar DMN Engine-fel korrekt (retry med exponentiell backoff, fallback-beslut REVIEW). Verifiera att processen flaggas f√∂r manuell granskning vid tekniska fel.</li>
          <li><strong>Edge cases:</strong> Verifiera gr√§nsv√§rden (DTI-ratio 49.5%, 50.0%, 50.1%, kreditscore 599, 600, 550, √•rsinkomst 199k, 200k, 201k SEK). Verifiera hantering av delade engagemang (korrekt aggregering f√∂r DTI-ratio ber√§kning). Verifiera hantering av ofullst√§ndig databild (REVIEW vid saknade indata).</li>
          <li><strong>Validering:</strong> Verifiera att indata valideras korrekt (√•rsinkomst ‚â• 0, DTI-ratio 0-100%, kreditscore 0-850, betalningsanm√§rkningar boolean). Verifiera att ogiltiga indata flaggas f√∂r manuell verifiering.</li>
          <li><strong>Sp√•rbarhet:</strong> Verifiera att alla beslut loggas med timestamp, indata, output, riskkategori, och motivering. Verifiera att beslut √§r sp√•rbara f√∂r compliance och efterkontroll.</li>
        </ul>
        <p><strong>Teststruktur:</strong> Varje testscenario (EPIC-S1 till EPIC-S7) ska ha separata testfall som verifierar b√•de DMN-beslutet och processfl√∂det. Edge cases ska ha dedikerade testfall. Tekniska fel ska testas med mock DMN-engine som simulerar olika felscenarion.</p>
        
      </div>
    </section>

    <section class="doc-section">
      <h2>Felhantering & Edge Cases</h2>
      <p class="muted">Beskrivning av felhantering och edge cases.</p>
      
      <h3>Tekniska fel</h3>
      <div class="card">
        <ul>
          <li><strong>DMN Engine-fel:</strong> Om DMN-motorn inte kan k√∂ras (500 Server Error, timeout) ska systemet logga felet och flagga processen f√∂r manuell granskning. √ñverv√§g fallback-beslut (t.ex. REVIEW) vid tekniska fel f√∂r att undvika att processen stoppas helt.</li>
          <li><strong>DMN-modell saknas:</strong> Om DMN-modellen inte hittas (404 Not Found) ska systemet logga felet och flagga processen f√∂r manuell granskning. Detta kan h√§nda vid deployment eller modelluppdateringar.</li>
          <li><strong>Databasfel:</strong> Vid databasfel (connection timeout, deadlock) n√§r indata h√§mtas (kreditupplysning, engagemang) ska processen flaggas f√∂r manuell hantering och felet loggas med detaljerad information.</li>
          <li><strong>DTI-ratio ber√§kning:</strong> Om DTI-ratio inte kan ber√§knas (t.ex. √•rsinkomst saknas eller √§r 0) ska systemet logga felet och flagga processen f√∂r manuell granskning. Processen kan inte forts√§tta utan korrekt DTI-ratio.</li>
        </ul>
      </div>
      
      <h3>Aff√§rsrelaterade fel</h3>
      <div class="card">
        <ul>
          <li><strong>Obligatoriska indata saknas:</strong> Om obligatoriska indata saknas (t.ex. √•rsinkomst, DTI-ratio, kreditscore, kredithistorik) ska systemet logga felet och flagga processen f√∂r manuell granskning. Processen kan inte forts√§tta utan dessa data.</li>
          <li><strong>Ogiltiga indata:</strong> Om indata √§r ogiltiga (t.ex. negativ √•rsinkomst, DTI-ratio > 100%, kreditscore > 850) ska systemet validera och flagga f√∂r manuell verifiering med tydligt felmeddelande.</li>
          <li><strong>Ofullst√§ndig databild:</strong> Om centrala uppgifter saknas (t.ex. kreditupplysning eller engagemang saknas) ska systemet logga avvikelsen och skicka √§rendet till manuell utredning (REVIEW) innan processen f√•r forts√§tta.</li>
        </ul>
      </div>
      
      <h3>Edge cases</h3>
      <div class="card">
        <ul>
          <li><strong>Gr√§nsfall:</strong> Kunder som ligger precis p√• gr√§nsen f√∂r eligibility-kriterier (t.ex. DTI-ratio 40-45%, kreditscore 595-605) kan returnera REVIEW f√∂r manuell bed√∂mning. Systemet ska hantera dessa gr√§nsfall korrekt.</li>
          <li><strong>H√∂ga skulder:</strong> Kunder med mycket h√∂ga skulder (DTI-ratio > 50%) kan kr√§va manuell bed√∂mning √§ven om andra kriterier √§r uppfyllda. Systemet ska identifiera detta scenario och returnera REVIEW.</li>
          <li><strong>Historiska data:</strong> Data fr√•n olika k√§llor (kreditupplysning vs engagemang) kan vara inkonsistenta och kr√§va manuell granskning. Systemet ska identifiera inkonsistenser och flagga f√∂r manuell verifiering.</li>
          <li><strong>Delade engagemang:</strong> Kunder med delade engagemang (gemensamma l√•n med meds√∂kande) kan kr√§va s√§rskild hantering. Systemet ska identifiera och aggregera delade engagemang korrekt f√∂r DTI-ratio ber√§kning.</li>
        </ul>
      </div>
      
      <h3>Retry-strategier</h3>
      <div class="card">
        <ul>
          <li><strong>DMN Engine:</strong> Retry med exponentiell backoff (1s, 2s, 4s) f√∂r tillf√§lliga fel (timeout, 503 Service Unavailable). Max 2 f√∂rs√∂k innan fallback-beslut (REVIEW) anv√§nds.</li>
          <li><strong>Fallback-beslut:</strong> Vid tekniska fel kan systemet anv√§nda fallback-beslut (REVIEW) f√∂r att undvika att processen stoppas helt. Detta ger manuell granskning m√∂jlighet att bed√∂ma kunden.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Implementation Notes</h2>
      <p class="muted">Tekniska noteringar, k√§nda begr√§nsningar och framtida f√∂rb√§ttringar.</p>
      <div class="card">
        <ul>
          <li><strong>DMN-implementation:</strong> Prim√§ra API:er/tj√§nster: POST /api/dmn/assess-stakeholder f√∂r exekvering. DMN-beslutslogik lagras i DMN-modell och kan uppdateras utan kod√§ndringar. √ñverv√§g versionering av DMN-modeller f√∂r sp√•rbarhet.</li>
          <li><strong>Loggning:</strong> Viktiga f√§lt och beslut b√∂r loggas f√∂r att m√∂jligg√∂ra fels√∂kning och efterkontroll. Logga: indata (√•rsinkomst, DTI-ratio, kreditscore, kredithistorik), beslut (APPROVED/REJECTED), riskkategori, motivering, och eventuella flaggor. Alla beslut ska vara sp√•rbara f√∂r compliance och efterkontroll.</li>
          <li><strong>Prestanda:</strong> DMN-beslut b√∂r vara snabba (< 1 sekund). Prestanda- och tillg√§nglighetskrav hanteras p√• plattformsniv√• men b√∂r beaktas i designen. √ñverv√§g caching av DMN-beslut om samma kund bed√∂ms flera g√•nger.</li>
          <li><strong>Datavalidering:</strong> Validera att indata matchar f√∂rv√§ntat format innan DMN-anrop. Verifiera att obligatoriska f√§lt finns med och att datatyper √§r korrekta. Validera √•rsinkomst (positivt tal), DTI-ratio (0-100%), kreditscore (0-850).</li>
          <li><strong>DTI-ratio ber√§kning:</strong> DTI-ratio ber√§knas som (totala skulder / √•rsinkomst) * 100. √ñverv√§g att inkludera b√•de befintliga skulder och det efterfr√•gade l√•net i ber√§kningen f√∂r mer exakt bed√∂mning.</li>
          <li><strong>Framtida f√∂rb√§ttringar:</strong> √ñverv√§g att inkludera fler faktorer i bed√∂mningen (t.ex. boendesituation, anst√§llningsstabilitet) f√∂r mer exakt bed√∂mning. St√∂d f√∂r olika produkter med olika kriterier. Integration med machine learning f√∂r mer sofistikerad riskbed√∂mning.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Relaterade noder</h2>
      <p class="muted">L√§nkar till relaterade epics, feature goals och business rules.</p>
      
      <details>
        <summary>Beroendediagram</summary>
        <div class="mermaid">
flowchart LR
    Previous1[fetch-credit-information<br/>serviceTask]
    Previous2[fetch-engagements<br/>serviceTask]
    Current[assess-stakeholder<br/>businessRuleTask]
    Gateway{is-stakeholder-<br/>rejected?}
    Next[register-personal-economy-<br/>information<br/>userTask]
    Rejected[Rejected stakeholder<br/>evaluation]
    
    Previous1 -->|Input till| Current
    Previous2 -->|Input till| Current
    Current --> Gateway
    Gateway -->|No| Next
    Gateway -->|Yes| Rejected
    
    style Current fill:#f59e0b,color:#fff
    style Previous1 fill:#3b82f6,color:#fff
    style Previous2 fill:#3b82f6,color:#fff
    style Next fill:#3b82f6,color:#fff
    style Gateway fill:#fbbf24,color:#000
    style Rejected fill:#ef4444,color:#fff
        </div>
        <p class="muted">Beroendediagram visar: fetch-credit-information + fetch-engagements ‚Üí assess-stakeholder ‚Üí gateway ‚Üí register-personal-economy-information (om approved) eller rejected (om rejected).</p>
      </details>
      
      <h3>F√∂reg√•ende steg</h3>
      <ul>
        <li><strong>fetch-credit-information:</strong> M√•ste vara slutf√∂rd f√∂r att kreditupplysning ska vara tillg√§nglig</li>
        <li><strong>fetch-engagements:</strong> M√•ste vara slutf√∂rd (fr√•n internal-data-gathering) f√∂r att totala skulder ska kunna ber√§knas f√∂r DTI-ratio</li>
      </ul>
      
      <h3>Efterf√∂ljande steg</h3>
      <ul>
        <li><strong>Gateway "is-stakeholder-rejected":</strong> Anv√§nder resultatet fr√•n assess-stakeholder f√∂r att avg√∂ra om processen ska forts√§tta</li>
        <li><strong>register-personal-economy-information:</strong> K√∂rs om gateway returnerar "No" (approved)</li>
        <li><strong>Rejected stakeholder evaluation:</strong> Processen avslutas om gateway returnerar "Yes" (rejected)</li>
      </ul>
      
      <h3>Parallella steg</h3>
      <ul>
        <li><strong>register-household-economy-information:</strong> K√∂rs parallellt i household subprocessen (anv√§nder samma kreditbed√∂mning)</li>
      </ul>
      
      <h3>Business Rules</h3>
      <ul>
        <li><strong>DMN-modell:</strong> assess-stakeholder.dmn inneh√•ller beslutslogik och aff√§rsregler. Regeln kan uppdateras utan kod√§ndringar genom att uppdatera DMN-modellen</li>
        <li><strong>Kreditpolicy:</strong> Bankens kreditpolicy definierar kriterier f√∂r √•rsinkomst, DTI-ratio, och kredithistorik</li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>BPMN ‚Äì Process (Bild)</h2>
      <p class="muted">Bild av BPMN-processen som epiken refererar till.</p>
      <div class="card">
        <p><strong>BPMN-diagram:</strong></p>
        <p><a href="#/bpmn/mortgage-se-stakeholder.bpmn">Visa BPMN-processen</a></p>
        <p class="muted">[Beskrivning av BPMN-processen eller l√§nk till BPMN-viewer. Bilden ska visa noden och dess kontext i processen.]</p>
      </div>
    </section>

    <section class="doc-section">
      <h2>API Dokumentation</h2>
      <p class="muted">Beskrivning av API-endpoints som anv√§nds eller exponeras.</p>
      
      <h3>API-endpoints (exponerade)</h3>
      <table>
        <tr>
          <th>Endpoint</th>
          <th>Metod</th>
          <th>Request</th>
          <th>Response</th>
          <th>Felkoder</th>
        </tr>
        <tr>
          <td><code>/api/assess-stakeholder</code></td>
          <td>POST</td>
          <td><code>{ "creditInformation": {...}, "engagements": [...], "√•rsinkomst": "number", "DTI": "number", "kredithistorik": {...}, "applicationId": "uuid" }</code></td>
          <td><code>{ "beslut": "APPROVED" | "REJECTED", "riskkategori": "string", "motivering": "string", "status": "success" }</code></td>
          <td>400 (Bad Request), 500 (Server Error)</td>
        </tr>
      </table>
      
      <h3>DMN Decision Table</h3>
      <div class="card">
        <ul>
          <li><strong>DMN-fil:</strong> assess-stakeholder.dmn</li>
          <li><strong>Besluts-ID:</strong> assess-stakeholder</li>
          <li><strong>Hit Policy:</strong> FIRST (f√∂rsta matchande regel anv√§nds)</li>
          <li><strong>Inputs:</strong> √•rsinkomst, DTI-ratio (debt-to-income), kreditscore, kredithistorik</li>
          <li><strong>Outputs:</strong> beslut (APPROVED/REJECTED), riskkategori, motivering</li>
        </ul>
      </div>
      
      <h3>Autentisering</h3>
      <div class="card">
        <ul>
          <li><strong>Exponerad endpoint:</strong> Kr√§ver OAuth 2.0 Bearer token i Authorization header</li>
          <li><strong>DMN Engine:</strong> Intern autentisering via API Gateway</li>
        </ul>
      </div>
      
      <h3>Felhantering</h3>
      <div class="card">
        <ul>
          <li><strong>400 Bad Request:</strong> Ogiltig input (t.ex. saknade obligatoriska f√§lt eller ogiltiga v√§rden)</li>
          <li><strong>500 Server Error:</strong> Internt serverfel eller DMN Engine-fel</li>
        </ul>
      </div>
    </section>
  
  </div>
</body>
</html>