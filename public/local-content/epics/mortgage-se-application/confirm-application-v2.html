<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Confirm application</title>
  <style>
    :root {
      color-scheme: light;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      --card-bg: #ffffff;
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #475569;
      --border: #e2e8f0;
      --accent: #dbeafe;
    }
    body {
      margin: 0;
      padding: 16px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.7;
    }
    .doc-shell {
      max-width: 960px;
      margin: 0 auto;
    }
    h1 {
      font-size: 1.5rem;
      margin: 0 0 24px;
      border-bottom: 1px solid var(--border);
      padding-bottom: 8px;
    }
    h2 {
      color: var(--primary);
      margin: 24px 0 12px;
      font-size: 1.1rem;
    }
    p { margin: 0 0 12px; }
    ul { padding-left: 20px; margin: 0 0 12px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 12px 0;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 8px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted { color: var(--text-muted); font-size: 0.9rem; }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
    .doc-section {
      margin-bottom: 24px;
      padding: 16px;
      background: var(--card-bg);
      border: 1px solid var(--border);
    }
    .doc-section + .doc-section { margin-top: 16px; }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    .mermaid {
      margin: 16px 0;
      text-align: center;
    }
    details {
      margin: 12px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 8px;
      background: var(--accent);
      border-radius: 4px;
    }
    details summary:hover {
      background: #bfdbfe;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <script>
    mermaid.initialize({ startOnLoad: true, theme: 'default' });
  </script>
</head>
<body>
  <div class="doc-shell">
    
    
    
    <div class="doc-badge">üìÑ Lokal version ‚Äì F√∂rb√§ttrat inneh√•ll</div>

    <section class="doc-section">
      <h1>Epic ‚Äì Confirm application</h1>
      <ul>
        <li><strong>Epic-namn:</strong> Confirm application</li>
        <li><strong>BPMN-fil:</strong> mortgage-se-application.bpmn</li>
        <li><strong>Element ID:</strong> confirm-application</li>
        <li><strong>Nodtyp:</strong> userTask</li>
        <li><strong>Version:</strong> 1.0 (exempel) ‚Äì uppdateras vid √§ndring</li>
        <li><strong>√Ñgare:</strong> Produktteam Kredit / Arkitektur</li>
        <li><strong>Confluence:</strong> <a href="#confluence-link">#confluence-link</a></li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>Syfte & V√§rde</h2>
      <p class="muted">Beskrivning av epikens syfte och aff√§rsv√§rde.</p>
      <div class="card">
        <p>Epiken ger kunden eller handl√§ggaren m√∂jlighet att granska och bekr√§fta hela ans√∂kan innan den skickas vidare f√∂r kreditbed√∂mning. Detta √§r det sista steget i ans√∂kningsinsamlingen och s√§kerst√§ller att all n√∂dv√§ndig information √§r korrekt och komplett. Kunden kan se en sammanfattning av alla insamlade data (stakeholder, household, object) och bekr√§fta att allt √§r korrekt innan ans√∂kan skickas vidare. Epiken validerar att alla obligatoriska f√§lt √§r ifyllda och att ans√∂kan uppfyller grundl√§ggande krav innan den kan bekr√§ftas.</p>
      </div>
    </section>

    <section class="doc-section">
      <h2>Processkontext</h2>
      <p class="muted">Var epicen befinner sig i Application-processen.</p>
      <div class="card">
        <p>Epiken <strong>confirm-application</strong> √§r en direkt del av <strong>mortgage-se-application</strong> processen (inte en subprocess). Den k√∂rs efter att alla subprocesser (household, stakeholders, object) har slutf√∂rts via Parallel Gateway "Gateway_1960pk9". Efter att ans√∂kan har bekr√§ftats slutf√∂rs Application-processen.</p>
        
        <details>
          <summary>Application Process Flow</summary>
          <div class="mermaid">
flowchart TD
    Start[Application Start]
    InternalData[internal-data-gathering<br/>subprocess]
    Gateway1[Parallel Gateway]
    Household[household<br/>subprocess]
    Stakeholders[stakeholders<br/>subprocess]
    Object[object<br/>subprocess]
    Gateway2[Parallel Gateway]
    Confirm[confirm-application<br/>userTask]
    End[Application End]
    
    Start --> InternalData
    InternalData --> Gateway1
    Gateway1 -->|Parallel| Household
    Gateway1 -->|Parallel| Stakeholders
    Stakeholders --> Object
    Household --> Gateway2
    Stakeholders --> Gateway2
    Object --> Gateway2
    Gateway2 -->|All complete| Confirm
    Confirm --> End
    
    style Confirm fill:#3b82f6,color:#fff
    style Gateway2 fill:#fbbf24,color:#000
          </div>
          <p class="muted">Application Process Flow visar √∂vergripande fl√∂de: Application startar ‚Üí internal-data-gathering ‚Üí parallellt household och stakeholders ‚Üí object ‚Üí confirm-application ‚Üí End.</p>
        </details>
        
        <h3>F√∂reg√•ende steg</h3>
        <ul>
          <li><strong>household subprocess:</strong> M√•ste vara slutf√∂rd (register-household-economy-information)</li>
          <li><strong>stakeholders subprocess:</strong> M√•ste vara slutf√∂rd (register-personal-economy-information)</li>
          <li><strong>object subprocess:</strong> M√•ste vara slutf√∂rd (valuate-property eller object-information)</li>
          <li><strong>Gateway "Gateway_1960pk9":</strong> Parallel Gateway som v√§ntar p√• att alla subprocesser ska slutf√∂ras innan confirm-application k√∂rs</li>
        </ul>
        
        <h3>Efterf√∂ljande steg</h3>
        <ul>
          <li><strong>Application End:</strong> N√§r confirm-application √§r klar slutf√∂rs Application-processen</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Anv√§ndarupplevelse</h2>
      <p class="muted">Beskrivning av anv√§ndarupplevelsen f√∂r b√•de s√∂kande (kund) och anst√§lld (r√•dgivare/admin).</p>
      
      <h3>S√∂kande (Kund)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Kunden ser en sammanfattningsvy med alla insamlade uppgifter fr√•n ans√∂kningsprocessen: stakeholder-information, household-ekonomi, objektinformation, och l√•neuppl√§gg. Varje sektion kan expanderas f√∂r detaljerad granskning.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Kunden √∂ppnar bekr√§ftelsesidan och ser en √∂versiktlig sammanfattning av hela ans√∂kan</li><li>Kunden kan expandera varje sektion f√∂r att granska detaljerad information</li><li>Systemet visar eventuella varningar eller ofullst√§ndig information som beh√∂ver √•tg√§rdas</li><li>Kunden bekr√§ftar att all information √§r korrekt genom att klicka p√• "Bekr√§fta ans√∂kan"</li><li>Efter bekr√§ftelse skickas ans√∂kan vidare f√∂r kreditbed√∂mning</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Granska sammanfattning, Expandera/kollapsa sektioner, Redigera information (navigera tillbaka), Bekr√§fta ans√∂kan, Avbryt ans√∂kan</li>
          <li><strong>Design:</strong> <a href="#figma-link">[L√§nk till Figma-design]</a></li>
          
        </ul>
        
        <details>
          <summary>User Journey Map</summary>
          <div class="mermaid">
flowchart LR
    Start[Start<br/>√ñppna bekr√§ftelsesida]
    Review[Granska<br/>sammanfattning]
    Expand[Expandera<br/>sektioner]
    Validate{Validering<br/>OK?}
    Confirm[Bekr√§fta<br/>ans√∂kan]
    Complete[Klart<br/>Skickas f√∂r bed√∂mning]
    Edit[Redigera<br/>information]
    
    Start -->|Laddar sammanfattning| Review
    Review -->|Expandera| Expand
    Expand -->|Granska| Validate
    Validate -->|Nej| Edit
    Edit -->|Navigera tillbaka| Review
    Validate -->|Ja| Confirm
    Confirm -->|Bekr√§ftar| Complete
    
    style Start fill:#dbeafe,color:#000
    style Review fill:#bfdbfe,color:#000
    style Expand fill:#93c5fd,color:#000
    style Validate fill:#fbbf24,color:#000
    style Confirm fill:#10b981,color:#fff
    style Complete fill:#059669,color:#fff
    style Edit fill:#f59e0b,color:#fff
          </div>
          <p class="muted">User Journey Map visar kundens resa fr√•n start till bekr√§ftelse, inklusive touchpoints och tidslinje.</p>
        </details>
        
        <details>
          <summary>Interaktionsfl√∂de</summary>
          <div class="mermaid">
sequenceDiagram
    participant User as Kund/Handl√§ggare
    participant UI as UI Bekr√§ftelsesida
    participant API as API Service
    participant Validator as Validation Service
    participant Store as Application Store
    
    User->>UI: √ñppna bekr√§ftelsesida
    UI->>API: H√§mta all ans√∂kningsdata
    API-->>UI: Sammanfattning (stakeholder, household, object)
    UI-->>User: Visar sammanfattningsvy
    
    User->>UI: Expandera/kollapsa sektioner
    UI-->>User: Visar/d√∂ljer detaljer
    
    User->>UI: Klickar "Bekr√§fta ans√∂kan"
    UI->>Validator: Validera alla obligatoriska f√§lt
    Validator-->>UI: Valideringsresultat
    
    alt Validering OK
        UI->>API: Bekr√§fta ans√∂kan
        API->>Store: Markera ans√∂kan som komplett
        Store-->>API: Bekr√§ftelse
        API-->>UI: Success
        UI-->>User: Bekr√§ftelse + skickas f√∂r kreditbed√∂mning
    else Validering misslyckas
        UI-->>User: Felmeddelanden (vilka f√§lt beh√∂ver √•tg√§rdas)
        User->>UI: Navigera tillbaka f√∂r att redigera
    end
          </div>
          <p class="muted">Interaktionsfl√∂de visar UI-sk√§rmar/steg, anv√§ndarinteraktioner, systemresponser, valideringar och felhantering.</p>
        </details>
      </div>
      
      <h3>Anst√§lld (R√•dgivare/Admin)</h3>
      <div class="card">
        <ul>
          <li><strong>Vad ser anv√§ndaren:</strong> Handl√§ggare ser samma sammanfattningsvy som kunden, men med ytterligare administrativa funktioner och m√∂jlighet att se valideringsstatus och flaggor fr√•n systemet.</li>
          <li><strong>Steg:</strong> 
            <ul>
              <li>Handl√§ggare √∂ppnar ans√∂kan i systemet och ser sammanfattningsvyn</li><li>Handl√§ggare granskar alla sektioner och verifierar att informationen √§r korrekt och komplett</li><li>Systemet visar valideringsstatus och eventuella varningar eller fel</li><li>Handl√§ggare kan bekr√§fta ans√∂kan √• kundens v√§gnar eller flagga f√∂r komplettering</li><li>Efter bekr√§ftelse skickas ans√∂kan vidare f√∂r kreditbed√∂mning</li>
            </ul>
          </li>
          <li><strong>Interaktioner:</strong> Granska sammanfattning, Verifiera information, Bekr√§fta ans√∂kan, Flagga f√∂r komplettering, Avvisa ans√∂kan, Se valideringsstatus</li>
          <li><strong>Design:</strong> <a href="#figma-link">[L√§nk till Figma-design]</a></li>
          
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Funktionellt fl√∂de</h2>
      <p class="muted">Steg-f√∂r-steg beskrivning av processen.</p>
      <div class="card">
        <ol>
          <li>Epiken triggas n√§r alla f√∂reg√•ende steg i ans√∂kningsprocessen √§r slutf√∂rda (stakeholder, household, object).</li><li>Systemet samlar in all insamlad data fr√•n f√∂reg√•ende steg och skapar en sammanfattningsvy.</li><li>Systemet validerar att alla obligatoriska f√§lt √§r ifyllda och att ans√∂kan uppfyller grundl√§ggande krav.</li><li>Kunden eller handl√§ggaren granskar sammanfattningen och kan expandera sektioner f√∂r detaljerad granskning.</li><li>Systemet visar eventuella varningar, ofullst√§ndig information, eller valideringsfel som beh√∂ver √•tg√§rdas.</li><li>Kunden eller handl√§ggaren bekr√§ftar ans√∂kan genom att klicka p√• "Bekr√§fta ans√∂kan".</li><li>Efter bekr√§ftelse markeras ans√∂kan som komplett och skickas vidare f√∂r kreditbed√∂mning. Ans√∂kningsstatus uppdateras och processen forts√§tter till n√§sta steg i bol√•nefl√∂det.</li>
        </ol>
        <p><strong>Beslutslogik:</strong> Epiken √§r en userTask d√§r anv√§ndaren m√•ste bekr√§fta ans√∂kan. Om obligatoriska f√§lt saknas eller validering misslyckas kan anv√§ndaren inte bekr√§fta och m√•ste navigera tillbaka f√∂r att komplettera informationen. Efter bekr√§ftelse forts√§tter processen automatiskt till n√§sta steg.</p>
        <p><strong>Felhantering:</strong> Om validering misslyckas visas tydliga felmeddelanden som indikerar vilka f√§lt som beh√∂ver √•tg√§rdas. Anv√§ndaren kan navigera tillbaka till relevanta sektioner f√∂r att korrigera information. Om systemfel uppst√•r vid bekr√§ftelse loggas felet och anv√§ndaren informeras. Ans√∂kan kan sparas som draft om anv√§ndaren avbryter.</p>
        <p><strong>Edge cases:</strong> Ans√∂kan med delvis ofullst√§ndig information (anv√§ndaren kan bekr√§fta med varningar), ans√∂kan som √§ndras efter bekr√§ftelse (kan kr√§va ombekr√§ftelse), samtidiga bekr√§ftelser fr√•n flera anv√§ndare (f√∂rhindras via l√•sning), timeout under bekr√§ftelse (ans√∂kan sparas som draft), avbruten bekr√§ftelse (ans√∂kan f√∂rblir i draft-l√§ge).</p>
      </div>
      
      <details>
        <summary>Process Flow Diagram</summary>
        <div class="mermaid">
flowchart TD
    Start[Start<br/>Epik triggas]
    Collect[Samla in all data<br/>fr√•n f√∂reg√•ende steg]
    CreateSummary[Skapa<br/>sammanfattningsvy]
    Validate{Validering<br/>OK?}
    Review[Granska<br/>sammanfattning]
    Confirm[Bekr√§fta<br/>ans√∂kan]
    MarkComplete[Markera som komplett<br/>+ skicka f√∂r bed√∂mning]
    Complete[Klart<br/>Forts√§tt process]
    Edit[Redigera<br/>information]
    
    Start --> Collect
    Collect --> CreateSummary
    CreateSummary --> Validate
    Validate -->|Nej| Edit
    Edit -->|Navigera tillbaka| Review
    Validate -->|Ja| Review
    Review --> Confirm
    Confirm --> MarkComplete
    MarkComplete --> Complete
    
    style Start fill:#1d4ed8,color:#fff
    style Collect fill:#3b82f6,color:#fff
    style CreateSummary fill:#60a5fa,color:#fff
    style Validate fill:#fbbf24,color:#000
    style Review fill:#93c5fd,color:#000
    style Confirm fill:#10b981,color:#fff
    style MarkComplete fill:#10b981,color:#fff
    style Complete fill:#059669,color:#fff
    style Edit fill:#f59e0b,color:#fff
        </div>
        <p class="muted">Process Flow Diagram visar steg-f√∂r-steg fl√∂de: samla data, skapa sammanfattning, validering, granskning, bekr√§ftelse, och markera som komplett.</p>
      </details>
    </section>

    <section class="doc-section">
      <h2>Inputs & Datak√§llor</h2>
      <p class="muted">Beskrivning av inputs och datak√§llor (interna och externa).</p>
      
      <h3>Inputs</h3>
      <p class="muted">Data som epiken tar emot fr√•n f√∂reg√•ende steg eller anv√§ndaren.</p>
      <table>
        <tr>
          <th>Input</th>
          <th>K√§lla</th>
          <th>Typ</th>
          <th>Obligatoriskt</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Samlad ans√∂kningsdata fr√•n alla f√∂reg√•ende steg</td>
          <td>F√∂reg√•ende steg (stakeholder, household, object)</td>
          <td>ApplicationData</td>
          <td>Ja</td>
          <td>Komplett ans√∂kningsdata inklusive stakeholder-information, household-ekonomi, objektinformation, och l√•neuppl√§gg</td>
        </tr>
        <tr>
          <td>Valideringsstatus och flaggor</td>
          <td>Systemvalidering</td>
          <td>ValidationStatus</td>
          <td>Ja</td>
          <td>Status f√∂r validering av obligatoriska f√§lt, varningar, och eventuella fel som beh√∂ver √•tg√§rdas</td>
        </tr>
        <tr>
          <td>Anv√§ndar-ID och session</td>
          <td>Autentiseringskontext</td>
          <td>String</td>
          <td>Ja</td>
          <td>F√∂r att identifiera vem som bekr√§ftar ans√∂kan och sp√•ra √§ndringar</td>
        </tr>
      </table>

      <h3>Datak√§llor</h3>
      <p class="muted">System och k√§llor som epiken h√§mtar data fr√•n.</p>
      
      
      <h4>Interna datak√§llor (bankens system)</h4>
      <ul>
        <li><strong>Application DB:</strong> Ans√∂kningsdata fr√•n alla f√∂reg√•ende steg (stakeholder, household, object)</li>
        <li><strong>Validation Service:</strong> Valideringsregler och status f√∂r ans√∂kningsdata</li>
      </ul>
      

      
      <h4>Externa APIs</h4>
      <ul>
        <li>Inga externa APIs ‚Äì all data h√§mtas fr√•n interna system</li>
      </ul>
      

      
      <h4>Databaser</h4>
      <ul>
        <li><strong>Application DB:</strong> PostgreSQL-databas f√∂r ans√∂kningsdata och processkontext</li>
      </ul>
      

      
    </section>

    

    <section class="doc-section">
      <h2>Outputs</h2>
      <p class="muted">Data som skapas, uppdateras eller skickas vidare.</p>
      <table>
        <tr>
          <th>Output</th>
          <th>Mottagare</th>
          <th>Typ</th>
          <th>Beskrivning</th>
        </tr>
        
        <tr>
          <td>Bekr√§ftad ans√∂kan med status "CONFIRMED"</td>
          <td>Application DB, efterf√∂ljande steg (kreditbed√∂mning)</td>
          <td>ConfirmedApplication</td>
          <td>Ans√∂kan som √§r bekr√§ftad och redo f√∂r kreditbed√∂mning, inklusive timestamp f√∂r bekr√§ftelse och anv√§ndar-ID</td>
        </tr>
        <tr>
          <td>Bekr√§ftelsemetadata</td>
          <td>Processkontext, loggsystem</td>
          <td>ConfirmationMetadata</td>
          <td>Information om vem som bekr√§ftade ans√∂kan, n√§r bekr√§ftelsen skedde, och eventuella kommentarer eller flaggor</td>
        </tr>
        <tr>
          <td>Valideringsresultat</td>
          <td>Efterf√∂ljande steg</td>
          <td>ValidationResult</td>
          <td>Resultat fr√•n validering av ans√∂kningsdata, inklusive eventuella varningar eller fel som beh√∂ver √•tg√§rdas</td>
        </tr>
      </table>
    </section>

    
    <section class="doc-section">
      <h2>Arkitektur & Systeminteraktioner</h2>
      <p class="muted">Beskrivning av systemarkitektur, integrationer och teknisk stack.</p>
      <div class="card">
        <ul>
          
          
          
          <li><strong>System som interagerar:</strong>
            <ul>
              <li><strong>Application DB:</strong> PostgreSQL-databas f√∂r ans√∂kningsdata och processkontext</li>
              <li><strong>Validation Service:</strong> Tj√§nst f√∂r validering av ans√∂kningsdata</li>
              <li><strong>Notification Service:</strong> Tj√§nst f√∂r att skicka bekr√§ftelsemeddelanden till kund</li>
            </ul>
          </li>
          
          <li><strong>Integrationer:</strong>
            <ul>
              <li><strong>API-integrationer:</strong> REST API f√∂r att h√§mta ans√∂kningsdata, validera ans√∂kan, och uppdatera status. API:et exponerar endpoints f√∂r att bekr√§fta ans√∂kan och h√§mta sammanfattningsdata.</li>
              <li><strong>Event-integrationer:</strong> Processen triggas n√§r alla f√∂reg√•ende steg √§r slutf√∂rda. Vid bekr√§ftelse publiceras event f√∂r att trigga n√§sta steg i processen (kreditbed√∂mning).</li>
              <li><strong>Databas-integrationer:</strong> PostgreSQL f√∂r ans√∂kningsdata. Bekr√§ftad ans√∂kan uppdateras i databasen med status och metadata.</li>
            </ul>
          </li>
          
          <li><strong>Teknisk stack:</strong>
            <ul>
              <li>BPMN-processmotor (Camunda) f√∂r orkestrering</li>
              <li>REST API f√∂r anv√§ndarinteraktion</li>
              <li>PostgreSQL f√∂r datalagring</li>
              <li>Frontend-komponenter f√∂r sammanfattningsvy och bekr√§ftelse</li>
            </ul>
          </li>
          
          
          
        </ul>
      </div>
    </section>
    

    

    <section class="doc-section">
      <h2>Aff√§rsregler & Beroenden</h2>
      <p class="muted">Beskrivning av aff√§rsregler, kreditregler och beroenden.</p>
      <div class="card">
        <h3>Aff√§rsregler</h3>
        <ul>
          <li>Epiken f√∂ruts√§tter att relevanta aff√§rsregler och policypunkter finns dokumenterade i separata Business Rules eller DMN.</li><li>Beslut och val inom epiken ska st√∂dja bankens kreditpolicy och riskmandat f√∂r ber√∂rda produkter.</li><li>Eventuella avvikelser eller undantag ska identifieras och kunna sp√•ras till bakomliggande regel- eller policyst√∂d.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Test Information</h2>
      <p class="muted">Beskrivning av testscenarier, testdata och testmilj√∂er.</p>
      <div class="card">
        <h3>Testscenarier</h3>
        <ul>
          <li><strong>EPIC-S1: Normalfl√∂de med komplett underlag:</strong> Kunden eller handl√§ggaren granskar sammanfattningen, all information √§r korrekt och komplett, validering lyckas, och ans√∂kan bekr√§ftas framg√•ngsrikt. Ans√∂kan skickas vidare f√∂r kreditbed√∂mning.</li>
          <li><strong>EPIC-S2: Delvis ofullst√§ndigt eller oklart underlag:</strong> Sammanfattningen visar varningar eller ofullst√§ndig information. Anv√§ndaren kan v√§lja att bekr√§fta √§nd√• (med varningar) eller navigera tillbaka f√∂r att komplettera informationen innan bekr√§ftelse.</li>
          <li><strong>EPIC-S3: Tekniskt fel eller kritisk avvikelse:</strong> Systemfel uppst√•r vid bekr√§ftelse (t.ex. databasfel, timeout). Ans√∂kan sparas som draft, felet loggas, och anv√§ndaren informeras. Ans√∂kan kan bekr√§ftas igen n√§r felet √§r √•tg√§rdat.</li>
          <li><strong>Edge case: Valideringsfel:</strong> Obligatoriska f√§lt saknas eller validering misslyckas. Anv√§ndaren kan inte bekr√§fta ans√∂kan och m√•ste navigera tillbaka f√∂r att korrigera informationen.</li>
          <li><strong>Edge case: Avbruten bekr√§ftelse:</strong> Anv√§ndaren avbryter bekr√§ftelseprocessen. Ans√∂kan f√∂rblir i draft-l√§ge och kan bekr√§ftas senare.</li>
        </ul>

        <h3>Testdata</h3>
        <ul>
          <li>Kompletta ans√∂kningar med alla sektioner ifyllda korrekt</li>
          <li>Ans√∂kningar med delvis ofullst√§ndig information (varningar men kan bekr√§ftas)</li>
          <li>Ans√∂kningar med valideringsfel (obligatoriska f√§lt saknas)</li>
          <li>Ans√∂kningar med olika kombinationer av stakeholder, household, och object-data</li>
        </ul>

        <h3>Testmilj√∂er</h3>
        <ul>
          <li><strong>Local development:</strong> Lokal databas med testdata</li>
          <li><strong>Staging:</strong> Staging-milj√∂ med realistiska testdata</li>
          <li><strong>Integration test:</strong> Test mot isolerad testmilj√∂ med kontrollerade testdata</li>
        </ul>

        <h3>Automatiska tester</h3>
        <p>Aff√§rs-scenarierna EPIC-S1‚ÄìEPIC-S3 ska mappas mot automatiska tester d√§r scenario-ID och namn anv√§nds i testfallens ben√§mningar. Testerna b√∂r t√§cka normalfl√∂de (bekr√§fta komplett ans√∂kan), edge case (bekr√§fta med varningar), samt tekniska fel (databasfel, timeout). Tester ska verifiera att sammanfattningen visas korrekt, validering fungerar, och bekr√§ftelse uppdaterar status korrekt.</p>
        
      </div>
    </section>

    <section class="doc-section">
      <h2>Felhantering & Edge Cases</h2>
      <p class="muted">Beskrivning av felhantering och edge cases.</p>
      
      <h3>Tekniska fel</h3>
      <div class="card">
        <ul>
          <li><strong>Databasfel:</strong> Vid databasfel n√§r bekr√§ftelse sparas (connection timeout, deadlock) ska systemet logga felet och flagga processen f√∂r manuell hantering. √ñverv√§g retry f√∂r tillf√§lliga databasfel. Anv√§ndaren b√∂r informeras om att bekr√§ftelse inte kunde sparas och att de kan f√∂rs√∂ka igen.</li>
          <li><strong>Session timeout:</strong> Om anv√§ndarens session g√•r ut innan bekr√§ftelse sparas ska systemet logga felet och informera anv√§ndaren. √ñverv√§g att spara bekr√§ftelse automatiskt n√§r anv√§ndaren klickar p√• bekr√§ftelseknappen f√∂r att undvika dataf√∂rlust.</li>
          <li><strong>N√§tverksfel:</strong> Vid n√§tverksfel (connection refused, DNS failure) n√§r bekr√§ftelse sparas ska systemet logga felet och informera anv√§ndaren. √ñverv√§g retry f√∂r tillf√§lliga n√§tverksfel.</li>
        </ul>
      </div>
      
      <h3>Aff√§rsrelaterade fel</h3>
      <div class="card">
        <ul>
          <li><strong>Valideringsfel:</strong> Om validering misslyckas (t.ex. ofullst√§ndig information, kritiska fel) ska systemet visa tydliga felmeddelanden och f√∂rhindra bekr√§ftelse. Anv√§ndaren b√∂r informeras om vilka f√§lt som saknas eller vilka fel som finns. Validering ska ske b√•de p√• klientsidan (f√∂r snabb feedback) och serversidan (f√∂r s√§kerhet).</li>
          <li><strong>Ofullst√§ndig information:</strong> Om obligatoriska f√§lt saknas eller subprocesser inte √§r slutf√∂rda ska systemet f√∂rhindra bekr√§ftelse och visa tydliga felmeddelanden. Anv√§ndaren b√∂r informeras om vilka subprocesser som saknas eller vilka f√§lt som saknas.</li>
          <li><strong>Varningar:</strong> Om varningar finns (t.ex. icke-kritiska fel) ska systemet visa dessa tydligt men till√•ta bekr√§ftelse. Anv√§ndaren b√∂r informeras om konsekvenserna av att bekr√§fta med varningar.</li>
        </ul>
      </div>
      
      <h3>Edge cases</h3>
      <div class="card">
        <ul>
          <li><strong>Parallella subprocesser:</strong> Om subprocesser (stakeholder, household, object) inte √§r slutf√∂rda samtidigt kan bekr√§ftelse f√∂rhindras. Systemet ska hantera detta gracefully och informera anv√§ndaren om vilka subprocesser som saknas.</li>
          <li><strong>Stora datam√§ngder:</strong> Om sammanfattningen inneh√•ller stora datam√§ngder kan laddningstiden bli l√•ng. √ñverv√§g lazy loading eller paginering f√∂r b√§ttre prestanda.</li>
          <li><strong>Historiska data:</strong> Om data √§ndras under bekr√§ftelseprocessen ska systemet sp√•ra √§ndringar och logga dem f√∂r sp√•rbarhet. √ñverv√§g att kr√§va manuell granskning f√∂r stora √§ndringar.</li>
          <li><strong>Dubbel bekr√§ftelse:</strong> Om anv√§ndaren f√∂rs√∂ker bekr√§fta flera g√•nger ska systemet identifiera detta och anv√§nda den f√∂rsta giltiga bekr√§ftelsen. √ñverv√§g att logga alla f√∂rs√∂k f√∂r sp√•rbarhet.</li>
        </ul>
      </div>
      
      <h3>Retry-strategier</h3>
      <div class="card">
        <ul>
          <li><strong>Databas:</strong> Retry med exponentiell backoff (1s, 2s, 4s) f√∂r tillf√§lliga databasfel. Max 3 f√∂rs√∂k innan processen flaggas f√∂r manuell hantering.</li>
          <li><strong>Session:</strong> Om session g√•r ut ska systemet informera anv√§ndaren och ge m√∂jlighet att logga in igen. √ñverv√§g att spara bekr√§ftelse automatiskt f√∂r att undvika dataf√∂rlust.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Implementation Notes</h2>
      <p class="muted">Tekniska noteringar, k√§nda begr√§nsningar och framtida f√∂rb√§ttringar.</p>
      <div class="card">
        <ul>
          <li><strong>UI/UX:</strong> Sammanfattningsvyn b√∂r vara tydlig och l√§ttl√§st med m√∂jlighet att expandera/kollapsa sektioner. Varningar och fel b√∂r markeras tydligt. Bekr√§ftelseknappen b√∂r vara tydlig och endast aktiverad n√§r validering lyckas.</li>
          <li><strong>Loggning:</strong> Loggning ska omfatta: n√§r bekr√§ftelse sker, vem som bekr√§ftade (kund/handl√§ggare), valideringsstatus, eventuella varningar eller fel, och timestamp. Alla bekr√§ftelser ska loggas f√∂r sp√•rbarhet.</li>
          <li><strong>Prestanda:</strong> Sammanfattningsvyn b√∂r laddas snabbt (< 2 sekunder). √ñverv√§g lazy loading f√∂r stora datam√§ngder. Cache kan anv√§ndas f√∂r att undvika on√∂diga databasanrop.</li>
          <li><strong>Datavalidering:</strong> Validera att alla obligatoriska f√§lt √§r ifyllda innan bekr√§ftelse till√•ts. Verifiera att data √§r konsistent och att inga kritiska fel finns. Validering b√∂r ske b√•de p√• klientsidan (f√∂r snabb feedback) och serversidan (f√∂r s√§kerhet).</li>
          <li><strong>Framtida f√∂rb√§ttringar:</strong> √ñverv√§g m√∂jlighet att spara ans√∂kan som PDF f√∂r kundens referens. St√∂d f√∂r delad bekr√§ftelse d√§r flera parter (t.ex. meds√∂kande) m√•ste bekr√§fta. Integration med e-signatur f√∂r digital bekr√§ftelse.</li>
        </ul>
      </div>
    </section>

    <section class="doc-section">
      <h2>Relaterade noder</h2>
      <p class="muted">L√§nkar till relaterade epics, feature goals och business rules.</p>
      
      <details>
        <summary>Beroendediagram</summary>
        <div class="mermaid">
flowchart LR
    Stakeholder[stakeholder<br/>subprocess]
    Household[household<br/>subprocess]
    Object[object<br/>subprocess]
    Gateway[Parallel Gateway<br/>Merge]
    Current[confirm-application<br/>userTask]
    End[Application Process<br/>End]
    CreditDecision[Kreditbed√∂mning]
    
    Stakeholder --> Gateway
    Household --> Gateway
    Object --> Gateway
    Gateway --> Current
    Current --> End
    End --> CreditDecision
    
    style Current fill:#3b82f6,color:#fff
    style Gateway fill:#fbbf24,color:#000
    style Stakeholder fill:#1d4ed8,color:#fff
    style Household fill:#1d4ed8,color:#fff
    style Object fill:#1d4ed8,color:#fff
    style CreditDecision fill:#10b981,color:#fff
        </div>
        <p class="muted">Beroendediagram visar: stakeholder + household + object subprocesser ‚Üí Parallel Gateway Merge ‚Üí confirm-application ‚Üí Application Process End ‚Üí Kreditbed√∂mning.</p>
      </details>
      
      <h3>F√∂reg√•ende steg</h3>
      <ul>
        <li><strong>stakeholder subprocess:</strong> M√•ste vara slutf√∂rd (register-personal-economy-information)</li>
        <li><strong>household subprocess:</strong> M√•ste vara slutf√∂rd (register-household-economy-information)</li>
        <li><strong>object subprocess:</strong> M√•ste vara slutf√∂rd (valuate-property eller objects-valid)</li>
        <li><strong>Parallel Gateway Merge:</strong> Samlar alla tre subprocesser innan confirm-application k√∂rs</li>
      </ul>
      
      <h3>Efterf√∂ljande steg</h3>
      <ul>
        <li><strong>Application Process End:</strong> N√§r confirm-application √§r klar slutf√∂rs Application-processen</li>
        <li><strong>Kreditbed√∂mning:</strong> Bekr√§ftad ans√∂kan skickas vidare f√∂r kreditbed√∂mning och riskanalys</li>
      </ul>
      
      <h3>Parallella steg</h3>
      <ul>
        <li><strong>Alla epics i stakeholder, household, och object:</strong> Samlar in data som visas i sammanfattningen</li>
      </ul>
      
      <h3>Business Rules</h3>
      <ul>
        <li><strong>Valideringsregler:</strong> Ans√∂kan m√•ste vara komplett innan bekr√§ftelse</li>
        <li><strong>Obligatoriska f√§lt:</strong> Regler f√∂r vilka f√§lt som √§r obligatoriska</li>
        <li><strong>Varningar:</strong> Regler f√∂r hantering av varningar vid bekr√§ftelse</li>
      </ul>
    </section>

    <section class="doc-section">
      <h2>BPMN ‚Äì Process (Bild)</h2>
      <p class="muted">Bild av BPMN-processen som epiken refererar till.</p>
      <div class="card">
        <p><strong>BPMN-diagram:</strong></p>
        <p><a href="#/bpmn/mortgage-se-application.bpmn">Visa BPMN-processen</a></p>
        <p class="muted">[Beskrivning av BPMN-processen eller l√§nk till BPMN-viewer. Bilden ska visa noden och dess kontext i processen.]</p>
      </div>
    </section>
  
  </div>
</body>
</html>