<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="bpmn_file" content="mortgage-se-object-control.bpmn">
  <meta name="element_id" content="object-control">
  <meta name="version" content="v2">
  <title>Object control</title>
  <style>
    :root {
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --accent: #e0e7ff;
      --bg-light: #f8f9fa;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 24px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin: 0 0 32px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 12px;
      color: var(--text-strong);
    }
    h2 {
      color: var(--primary);
      margin: 0;
      font-size: 1.5rem;
    }
    h3 {
      color: var(--text-strong);
      margin: 32px 0 12px;
      font-size: 1.2rem;
    }
    p { margin: 0 0 12px; }
    ul {
      padding-left: 24px;
      margin: 0 0 16px;
    }
    li { margin-bottom: 8px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 12px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted {
      color: var(--text-muted);
      font-size: 0.9rem;
      font-style: italic;
    }
    .card {
      background: var(--bg-light);
      padding: 20px;
      border-radius: 8px;
      margin: 16px 0;
      border-left: 4px solid var(--primary);
    }
    .doc-section {
      margin-bottom: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .doc-section details {
      margin: 0;
    }
    .doc-section details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 16px 20px;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border);
      user-select: none;
      font-size: 1.5rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .doc-section details summary::-webkit-details-marker {
      display: none;
    }
    .doc-section details summary::before {
      content: '▶';
      display: inline-block;
      transition: transform 0.2s;
      font-size: 0.8rem;
      color: var(--primary);
    }
    .doc-section details[open] summary::before {
      transform: rotate(90deg);
    }
    .doc-section details summary:hover {
      background: var(--accent);
    }
    .doc-section details .section-content {
      padding: 20px;
    }
    .doc-section details[open] summary {
      border-bottom: 1px solid var(--border);
    }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .local-version-badge {
      background: #e0f2fe;
      color: #0369a1;
      padding: 8px 16px;
      margin: 16px 0;
      border-radius: 6px;
      border-left: 4px solid #0284c7;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    details {
      margin: 16px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 12px;
      background: var(--bg-light);
      border: 1px solid var(--border);
      border-radius: 6px;
      user-select: none;
    }
    details summary:hover {
      background: var(--accent);
    }
    details[open] summary {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
    details .collapsible-content {
      padding: 16px;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 6px 6px;
      margin-top: 0;
    }
    img {
      max-width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin: 12px 0;
    }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
</style>
</head>
<body>
  
    
      
<h1>Object control</h1>
  
  <section class="doc-section">
      <details open>
        <summary>Beskrivning av FGoal</summary>
        <div class="section-content">
      <p>Object control är en process där handläggare kontrollerar och validerar objektinformation, särskilt för bostadsrätter (BRF). Processen anropas från Manual Credit Evaluation när objektkontroll krävs som en del av den manuella kreditevalueringen. Processen syftar till att säkerställa att objektet uppfyller alla krav och att all nödvändig information är korrekt och komplett.</p>
      <p>Processen börjar med att systemet avgör om objektet är en bostadsrätt. Om det är en bostadsrätt, kontrolleras om BRF-information finns tillgänglig. Om information saknas, registrerar handläggaren BRF-information och samlar objektinformation via "Object information" call activity. Om ändringar kräver omvärdering, genomförs automatisk kreditevaluering. BRF-information screenas mot affärsregler, och om screeningen kräver manuell granskning, granskas BRF:en av handläggaren. Om BRF godkänns, kontrolleras lägenhetsutdrag. Om objektet inte är en bostadsrätt eller om bostadsrätten är godkänd, avgörs om objektvärdering behövs. Om värdering krävs, fastställs objektets värde av en värderare. Slutligen kan stakeholdern granska ändringar innan processen avslutas.</p>
        </div>
      </details>
    </section>
<section class="doc-section">
      <details>
        <summary>Processteg - Input</summary>
        <div class="section-content">
      <p>Object Control-processen startar när:</p>
      <ul>
        <li><strong>Objektkontroll krävs:</strong> Processen anropas från Manual Credit Evaluation-processen när "Object control" identifieras som ett krav via "Requirements?" inclusive gateway</li>
        <li><strong>Processkontext:</strong> Object Control anropas från Manual Credit Evaluation via "Object control" call activity. Alla relevanta processvariabler skickas med för att säkerställa fullständig kontext</li>
        <li><strong>Objektinformation är tillgänglig:</strong> Grundläggande objektinformation, inklusive objekttyp och identifierad information, är tillgänglig för att påbörja kontrollen</li>
        <li><strong>Ansökningsdata är tillgänglig:</strong> All befintlig ansökningsdata, inklusive kundinformation och tidigare kreditevalueringsresultat, är tillgänglig för handläggaren</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Processteg - Output</summary>
        <div class="section-content">
      <p>När Object Control-processen är slutförd har följande resultat uppnåtts:</p>
      <ul>
        <li><strong>Objektet är kontrollerat och godkänt:</strong> All objektinformation har verifierats, BRF-information (om tillämpligt) har screenats och godkänts, lägenhetsutdrag har kontrollerats, och objektet är godkänt för vidare processering</li>
        <li><strong>Objektvärdering är slutförd (om nödvändig):</strong> Om objektvärdering krävdes, har objektets värde fastställts av en värderare</li>
        <li><strong>Processen avslutas normalt:</strong> Om alla kontroller är godkända och stakeholdern (om relevant) har accepterat ändringar, avslutas processen normalt och Manual Credit Evaluation-processen fortsätter med nästa steg</li>
        <li><strong>Felhantering vid avvisning:</strong> Om BRF avvisas via "BRF screening result" gateway "Rejected" eller "BRF approved" gateway "No", triggas "BRF rejected" error event. Om objektet avvisas via "Object approved?" gateway "No", triggas "Object rejected" error event. Dessa signalerar till Manual Credit Evaluation-processen att objektet inte uppfyller kraven</li>
        <li><strong>Loop-mekanismer:</strong> Om ändringar inte accepteras av stakeholdern via "Changes accepted?" gateway "No", loopar processen tillbaka till början för att hantera nya ändringar</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Omfattning</summary>
        <div class="section-content">
      <p>Object Control-processen omfattar följande huvudsteg och aktiviteter:</p>
      
      <h3>1. Objekttyp-kontroll</h3>
      <ul>
        <li><strong>Is bostadsrätt? (gateway):</strong> En beslutspunkt avgör om objektet är en bostadsrätt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till BRF-kontroll</li>
            <li><strong>No:</strong> Processen hoppar över BRF-kontroll och går direkt till objektvärdering</li>
          </ul>
        </li>
      </ul>

      <h3>2. BRF-information och screening (för bostadsrätter)</h3>
      <ul>
        <li><strong>Has updated BRF information? (gateway):</strong> En beslutspunkt avgör om BRF-information finns tillgänglig:
          <ul>
            <li><strong>Yes:</strong> Processen hoppar över registrering och går direkt till BRF-screening</li>
            <li><strong>No:</strong> Processen går till "Register BRF information" user task</li>
          </ul>
        </li>
        <li><strong>Register BRF information (user task):</strong> Handläggaren registrerar BRF-information som saknas. Information sparas i "BRF information database" datastore</li>
        <li><strong>Object information (call activity):</strong> Systemet samlar objektinformation via "Object information" call activity</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> En beslutspunkt avgör om ändringar kräver omvärdering:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Automatic Credit Evaluation" call activity för omvärdering</li>
            <li><strong>No:</strong> Processen hoppar över omvärdering och går direkt till BRF-screening</li>
          </ul>
        </li>
        <li><strong>Automatic Credit Evaluation (call activity, om behövs):</strong> Om ändringar kräver omvärdering, genomförs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> En beslutspunkt avgör resultatet av BRF-screening:
          <ul>
            <li><strong>Rejected:</strong> Processen avslutas med "BRF rejected" error event</li>
            <li><strong>Accepted:</strong> Processen fortsätter till lägenhetsutdrag-kontroll</li>
            <li><strong>Review:</strong> Processen går till "Review BRF" user task för manuell granskning</li>
            <li><strong>BRF information missing:</strong> Processen loopar tillbaka till "Has updated BRF information?" gateway</li>
          </ul>
        </li>
        <li><strong>Review BRF (user task):</strong> Handläggaren granskar BRF-information manuellt när screeningen kräver det</li>
        <li><strong>BRF approved? (gateway):</strong> En beslutspunkt avgör om BRF godkänns efter manuell granskning:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till lägenhetsutdrag-kontroll</li>
            <li><strong>No:</strong> Processen avslutas med "BRF rejected" error event</li>
          </ul>
        </li>
      </ul>

      <h3>3. Lägenhetsutdrag-kontroll (för bostadsrätter)</h3>
      <ul>
        <li><strong>Control lägenhets-utdrag (user task):</strong> Handläggaren kontrollerar lägenhetsutdrag. Caseworker kan hämta dokument från Tambur eller begära dokumentation från stakeholder</li>
        <li><strong>Request lägenhetsutdrag (boundary event):</strong> På "Control lägenhets-utdrag" user task kan "Request lägenhetsutdrag" boundary event triggas för att begära dokumentation från stakeholder, vilket triggar "Upload documentation" user task</li>
        <li><strong>Upload documentation (user task):</strong> Stakeholder laddar upp begärd dokumentation</li>
        <li><strong>Object approved? (gateway):</strong> En beslutspunkt avgör om objektet är godkänt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till objektvärdering</li>
            <li><strong>No:</strong> Processen avslutas med "Object rejected" error event</li>
          </ul>
        </li>
      </ul>

      <h3>4. Objektvärdering</h3>
      <ul>
        <li><strong>Needs valuation? (gateway):</strong> En beslutspunkt avgör om objektvärdering behövs:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Determine object value" user task</li>
            <li><strong>No:</strong> Processen hoppar över värdering och går direkt till stakeholder-granskning</li>
          </ul>
        </li>
        <li><strong>Determine object value (user task):</strong> Värderaren fastställer objektets värde. Detta kan vara ett externt system som används av värderingsenheten</li>
        <li><strong>Request mäklarvärdering (boundary event):</strong> På "Determine object value" user task kan "Request mäklarvärdering" boundary event triggas för att begära mäklarvärdering, vilket triggar "Upload object valuation documentation" user task</li>
        <li><strong>Upload object valuation documentation (user task):</strong> Stakeholder laddar upp mäklarvärderingsdokumentation</li>
      </ul>

      <h3>5. Stakeholder-granskning och avslut</h3>
      <ul>
        <li><strong>Stakeholder review? (gateway):</strong> En beslutspunkt avgör om stakeholder ska granska ändringar:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Review changes" user task</li>
            <li><strong>No:</strong> Processen hoppar över granskning och avslutas direkt</li>
          </ul>
        </li>
        <li><strong>Review changes (user task):</strong> Stakeholder granskar ändringar som gjorts under processen</li>
        <li><strong>Changes accepted? (gateway):</strong> En beslutspunkt avgör om ändringar accepteras:
          <ul>
            <li><strong>Yes:</strong> Processen avslutas normalt</li>
            <li><strong>No:</strong> Processen loopar tillbaka till början för att hantera nya ändringar</li>
          </ul>
        </li>
      </ul>

      <h3>6. Loop-mekanismer</h3>
      <ul>
        <li><strong>BRF information missing:</strong> Om "BRF screening result" gateway returnerar "BRF information missing", loopar processen tillbaka till "Has updated BRF information?" gateway</li>
        <li><strong>Ändringar inte accepterade:</strong> Om "Changes accepted?" gateway returnerar "No", loopar processen tillbaka till början via Gateway_0e24xxh för att hantera nya ändringar</li>
      </ul>

      <h3>7. Felhantering</h3>
      <ul>
        <li><strong>BRF rejected (error event):</strong> Om "BRF screening result" gateway returnerar "Rejected" eller "BRF approved" gateway returnerar "No", avslutas processen med "BRF rejected" error event (Event_1pqluun eller Event_0i6cize) med error code "brf-rejected"</li>
        <li><strong>Object rejected (error event):</strong> Om "Object approved?" gateway returnerar "No", avslutas processen med "Object rejected" error event (Event_1yyhlmr) med error code "object-rejected"</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Avgränsning</summary>
        <div class="section-content">
<ul>
        <li>Automatisk kreditevaluering (huvudprocess) ingår inte - den sker efter Object Control</li>
        <li>Dokumentationsbedömning (huvudprocess) ingår inte - den sker parallellt i Manual Credit Evaluation</li>
        <li>Avancerad underwriting (huvudprocess) ingår inte - den sker efter Object Control</li>
        <li>Application-processen ingår inte - den sker tidigare i huvudprocessen</li>
        <li>KYC-processen ingår inte - den sker senare i huvudprocessen</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Beroenden</summary>
        <div class="section-content">
<ul>
        <li><strong>Manual Credit Evaluation huvudprocess:</strong> Object Control anropas från mortgage-se-manual-credit-evaluation.bpmn när "Object control" identifieras som ett krav via "Requirements?" inclusive gateway</li>
        <li><strong>Object information (subprocess):</strong> Samling av objektinformation (storlek, typ, plats, max lånebelopp, energiklass, etc.)</li>
        <li><strong>Automatic Credit Evaluation (subprocess):</strong> Automatisk kreditevaluering för omvärdering när ändringar kräver rescoring</li>
        <li><strong>BRF information database (datastore):</strong> Lagrar BRF-information som registreras av handläggaren</li>
        <li><strong>Caseworker:</strong> Registrerar BRF-information, granskar BRF, kontrollerar lägenhetsutdrag, och hanterar dokumentation</li>
        <li><strong>Valuator:</strong> Fastställer objektets värde och kan begära mäklarvärdering</li>
        <li><strong>Stakeholder:</strong> Laddar upp dokumentation (lägenhetsutdrag, mäklarvärdering) och granskar ändringar</li>
        <li><strong>Tambur:</strong> Externt system där caseworker kan hämta dokument (lägenhetsutdrag)</li>
        <li><strong>Värderingsenhet:</strong> Externt system som används av värderingsenheten för objektvärdering</li>
        <li><strong>Felhantering:</strong> Om BRF eller objekt avvisas, triggas error events som signalerar till Manual Credit Evaluation-processen</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>BPMN - Process</summary>
        <div class="section-content">
      <p><a href="#/bpmn/mortgage-se-object-control.bpmn">Visa BPMN-processen för Object Control</a></p>
      
      <h3>Processflöde - Steg för steg</h3>
      <ol>
        <li><strong>Start:</strong> Processen startar när Manual Credit Evaluation-processen anropar "Object control" call activity när "Object control" identifieras som ett krav</li>
        <li><strong>Is bostadsrätt? (gateway):</strong> En beslutspunkt avgör om objektet är en bostadsrätt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till BRF-kontroll</li>
            <li><strong>No:</strong> Processen hoppar över BRF-kontroll och går direkt till objektvärdering</li>
          </ul>
        </li>
        <li><strong>Has updated BRF information? (gateway, för bostadsrätter):</strong> En beslutspunkt avgör om BRF-information finns tillgänglig. Om "No", registrerar handläggaren BRF-information och samlar objektinformation</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> En beslutspunkt avgör om ändringar kräver omvärdering. Om "Yes", genomförs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> En beslutspunkt avgör resultatet av BRF-screening. Om "Review", granskas BRF:en manuellt</li>
        <li><strong>Control lägenhets-utdrag (user task):</strong> Handläggaren kontrollerar lägenhetsutdrag. Om dokumentation begärs, triggas "Request lägenhetsutdrag" boundary event</li>
        <li><strong>Object approved? (gateway):</strong> En beslutspunkt avgör om objektet är godkänt. Om "No", avslutas processen med error event</li>
        <li><strong>Needs valuation? (gateway):</strong> En beslutspunkt avgör om objektvärdering behövs. Om "Yes", fastställs objektets värde</li>
        <li><strong>Stakeholder review? (gateway):</strong> En beslutspunkt avgör om stakeholder ska granska ändringar. Om "Yes", granskas ändringar</li>
        <li><strong>Changes accepted? (gateway):</strong> En beslutspunkt avgör om ändringar accepteras. Om "No", loopar processen tillbaka</li>
        <li><strong>Avslut:</strong> När alla kontroller är godkända och ändringar accepteras, avslutas processen normalt</li>
      </ol>
      
      <h3>Viktiga beslutspunkter</h3>
      <ul>
        <li><strong>Is bostadsrätt? (gateway):</strong> Avgör om objektet är en bostadsrätt. Om "No", hoppas BRF-kontroll över</li>
        <li><strong>Has updated BRF information? (gateway):</strong> Avgör om BRF-information finns tillgänglig. Om "No", registreras information</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> Avgör om ändringar kräver omvärdering. Om "Yes", krävs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> Avgör resultatet av BRF-screening. Kan resultera i avvisning, godkännande, manuell granskning, eller saknad information</li>
        <li><strong>BRF approved? (gateway):</strong> Avgör om BRF godkänns efter manuell granskning. Om "No", avslutas processen med error event</li>
        <li><strong>Object approved? (gateway):</strong> Avgör om objektet är godkänt. Om "No", avslutas processen med error event</li>
        <li><strong>Needs valuation? (gateway):</strong> Avgör om objektvärdering behövs. Om "Yes", fastställs objektets värde</li>
        <li><strong>Stakeholder review? (gateway):</strong> Avgör om stakeholder ska granska ändringar. Om "Yes", granskas ändringar</li>
        <li><strong>Changes accepted? (gateway):</strong> Avgör om ändringar accepteras. Om "No", loopar processen tillbaka</li>
      </ul>
      
      <h3>Loop-mekanismer</h3>
      <ul>
        <li><strong>BRF information missing:</strong> Om BRF-screening indikerar saknad information, loopar processen tillbaka till "Has updated BRF information?" gateway</li>
        <li><strong>Ändringar inte accepterade:</strong> Om stakeholder inte accepterar ändringar, loopar processen tillbaka till början för att hantera nya ändringar</li>
      </ul>
        </div>
      </details>
    </section>
    <section class="doc-section">
      <details>
        <summary>Effekt</summary>
        <div class="section-content">
<p class="muted">Förväntad affärseffekt som uppnås med feature goalet.</p>
      
      <h3>Strukturerad BRF-kontroll och screening</h3>
      <p>Genom automatisk BRF-screening via "BRF screening result" gateway kan systemet snabbt bedöma om en bostadsrättsförening uppfyller krav. För BRF:er som automatiskt godkänns kan processen fortsätta direkt, vilket kan minska handläggningstid med upp till 40-50% jämfört med manuell granskning av alla BRF:er. Endast BRF:er som kräver manuell granskning dirigeras till "Review BRF" user task.</p>
      
      <h3>Automatiserad omvärdering vid ändringar</h3>
      <p>När BRF-information ändras och "Changes requires rescoring?" gateway identifierar att omvärdering krävs, anropas automatiskt "Automatic Credit Evaluation" call activity. Detta säkerställer att kreditevalueringen alltid är uppdaterad med senaste informationen utan manuell intervention, vilket kan minska risken för felaktiga beslut med upp till 30-40%.</p>
      
      <h3>Effektiv dokumenthantering</h3>
      <p>Genom boundary events ("Request lägenhetsutdrag", "Request mäklarvärdering") kan handläggare och värderare begära dokumentation direkt från stakeholder utan att avbryta processen. Stakeholder kan ladda upp dokumentation via "Upload documentation" och "Upload object valuation documentation" user tasks. Detta kan minska antalet processavbrott med upp till 50-60% och förbättra kommunikationen mellan parter.</p>
      
      <h3>Flexibel loop-hantering</h3>
      <p>Processens loop-mekanismer möjliggör att saknad BRF-information och ändringar som inte accepteras av stakeholder hanteras automatiskt utan att processen behöver startas om. Detta kan minska antalet avbrutna processer med upp till 25-35% och förbättra kundupplevelsen.</p>
      
      <h3>Proaktiv felhantering</h3>
      <p>Genom tydliga error events ("BRF rejected", "Object rejected") signaleras omedelbart till Manual Credit Evaluation-processen när objektet inte uppfyller kraven. Detta förhindrar att processen fortsätter med ogiltiga objekt och kan minska handläggningstid för avvisade ansökningar med upp till 60-70%.</p>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>User stories</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska user stories som kan kopplas till feature goalet.</p>
      
      <h3>Handläggarperspektiv</h3>
      <ul>
        <li><strong>Som handläggare</strong> vill jag att processen startar via start event (start-event) <strong>så att</strong> Object Control-processen kan initieras när den anropas från Manual Credit Evaluation-processen via "object-control" call activity. <em>Acceptanskriterier: Start event (start-event) ska triggas när Object Control-processen anropas från Manual Credit Evaluation-processen via "object-control" call activity. Efter start event, ska flödet gå till Gateway_0e24xxh via Flow_1nc4bwi, och sedan till "Is bostadsrätt?" gateway (is-bostadsratt) via Flow_07176fz.</em></li>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt avgör om objektet är en bostadsrätt via "Is bostadsrätt?" gateway (is-bostadsratt) <strong>så att</strong> BRF-kontroll endast genomförs när det behövs. <em>Acceptanskriterier: "Is bostadsrätt?" gateway (is-bostadsratt) ska automatiskt avgöra om objektet är en bostadsrätt. Om "Yes", ska flödet gå till Gateway_14f9my2 via is-bostadsratt-yes. Om "No", ska flödet gå direkt till Gateway_0qigv85 via is-bostadsratt-no för att hoppa över BRF-kontroll.</em></li>
        <li><strong>Som handläggare</strong> vill jag kunna registrera BRF-information via "Register BRF information" user task (register-brf-information) när information saknas <strong>så att</strong> BRF-kontroll kan genomföras. <em>Acceptanskriterier: "Register BRF information" user task (register-brf-information) ska aktiveras när "Has updated BRF information?" gateway (has-brf-information) avgör "No" via has-brf-information-no. Information ska sparas till BRF information database (DataStoreReference_09sc1vy) via DataOutputAssociation_1wr6nyv. Efter registrering, ska flödet gå till "Object information" call activity (object-information) via Flow_0vgcod9.</em></li>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt screenar BRF-information via "BRF screening result" gateway (brf-screening-result) <strong>så att</strong> jag endast behöver granska BRF:er som kräver manuell bedömning, vilket sparar tid. <em>Acceptanskriterier: "BRF screening result" gateway (brf-screening-result) ska automatiskt screena BRF-information mot affärsregler. Om "Rejected", ska flödet gå till "BRF rejected" error event (Event_1pqluun) via brf-screening-result-rejected. Om "Accepted", ska flödet gå till Gateway_0wgmopw via brf-screening-result-accepted. Om "Review", ska flödet gå till "Review BRF" user task (review-brf) via brf-screening-result-review. Om "BRF information missing", ska processen loopa tillbaka till Gateway_14f9my2 via brf-screening-result-missing-info.</em></li>
        <li><strong>Som handläggare</strong> vill jag kunna granska BRF-information manuellt via "Review BRF" user task (review-brf) när screeningen kräver det <strong>så att</strong> jag kan bedöma BRF:er som kräver manuell granskning. <em>Acceptanskriterier: "Review BRF" user task (review-brf) ska aktiveras när "BRF screening result" gateway avgör "Review" via brf-screening-result-review. Efter granskning, ska flödet gå till "BRF approved?" gateway (brf-approved) via Flow_0g8xk4m. Om "Yes", ska flödet gå till Gateway_0wgmopw via brf-approved-yes. Om "No", ska "BRF rejected" error event (Event_0i6cize) triggas via brf-approved-no.</em></li>
        <li><strong>Som handläggare</strong> vill jag kunna kontrollera lägenhetsutdrag via "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) <strong>så att</strong> jag kan verifiera att dokumentationen är korrekt. <em>Acceptanskriterier: "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) ska aktiveras när BRF är godkänd via Flow_15o3nji från Gateway_0wgmopw. Efter kontroll, ska flödet gå till "Object approved?" gateway (object-approved) via Flow_1t65kyb.</em></li>
        <li><strong>Som handläggare</strong> vill jag kunna begära lägenhetsutdrag direkt från stakeholder via "Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) på "Control lägenhets-utdrag" user task <strong>så att</strong> jag kan få dokumentation utan att avbryta processen. <em>Acceptanskriterier: "Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) ska kunna triggas på "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) som message event. När boundary event triggas, ska flödet gå till "Upload documentation" user task (upload-documentation) via Flow_16bcbti. Efter uppladdning, ska flödet gå till Event_0xm12vg via Flow_0167gxa.</em></li>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt omvärderar kredit när BRF-information ändras via "Changes requires rescoring?" gateway (changes-requires-rescoring) och "Automatic Credit Evaluation" call activity (credit-evaluation-2) <strong>så att</strong> kreditevalueringen alltid är uppdaterad. <em>Acceptanskriterier: "Changes requires rescoring?" gateway (changes-requires-rescoring) ska automatiskt avgöra om ändringar kräver omvärdering. Om "Yes", ska flödet gå till "Automatic Credit Evaluation" call activity (credit-evaluation-2) via changes-requires-rescoring-yes. Efter omvärdering, ska flödet gå till Gateway_00hf2o8 via Flow_10wy0va, och sedan till Gateway_04ut3n0 via Flow_0daa5p5. Om "No", ska flödet gå direkt till Gateway_00hf2o8 via Flow_1vhjojl.</em></li>
      </ul>

      <h3>Värderarperspektiv</h3>
      <ul>
        <li><strong>Som värderare</strong> vill jag att systemet automatiskt avgör om objektvärdering behövs via "Needs valuation?" gateway (needs-valuation) <strong>så att</strong> värdering endast genomförs när det behövs. <em>Acceptanskriterier: "Needs valuation?" gateway (needs-valuation) ska automatiskt avgöra om objektvärdering behövs. Om "Yes", ska flödet gå till "Determine object value" user task (determine-object-value) via needs-valuation-yes. Om "No", ska flödet gå direkt till Gateway_0df2uib via needs-valuation-no.</em></li>
        <li><strong>Som värderare</strong> vill jag kunna fastställa objektets värde via "Determine object value" user task (determine-object-value) <strong>så att</strong> objektet kan värderas korrekt. <em>Acceptanskriterier: "Determine object value" user task (determine-object-value) ska aktiveras när "Needs valuation?" gateway avgör "Yes" via needs-valuation-yes. Efter värdering, ska flödet gå till Gateway_0df2uib via Flow_00qg51q.</em></li>
        <li><strong>Som värderare</strong> vill jag kunna begära mäklarvärdering direkt från stakeholder via "Request mäklarvärdering" boundary event (request-maklarvardering) på "Determine object value" user task <strong>så att</strong> jag kan få kompletterande information för värderingen. <em>Acceptanskriterier: "Request mäklarvärdering" boundary event (request-maklarvardering) ska kunna triggas på "Determine object value" user task (determine-object-value) som message event. När boundary event triggas, ska flödet gå till "Upload object valuation documentation" user task (upload-object-valuation-document) via Flow_0hr7m91. Efter uppladdning, ska flödet gå till Event_0co53lt via Flow_0cguw1v.</em></li>
      </ul>

      <h3>Stakeholder-perspektiv</h3>
      <ul>
        <li><strong>Som stakeholder</strong> vill jag kunna ladda upp begärd dokumentation (lägenhetsutdrag) via "Upload documentation" user task (upload-documentation) <strong>så att</strong> processen kan fortsätta utan avbrott. <em>Acceptanskriterier: "Upload documentation" user task (upload-documentation) ska aktiveras när "Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) triggas via Flow_16bcbti. Efter uppladdning, ska flödet gå till Event_0xm12vg via Flow_0167gxa.</em></li>
        <li><strong>Som stakeholder</strong> vill jag kunna ladda upp mäklarvärderingsdokumentation via "Upload object valuation documentation" user task (upload-object-valuation-document) <strong>så att</strong> värderaren kan få kompletterande information. <em>Acceptanskriterier: "Upload object valuation documentation" user task (upload-object-valuation-document) ska aktiveras när "Request mäklarvärdering" boundary event (request-maklarvardering) triggas via Flow_0hr7m91. Efter uppladdning, ska flödet gå till Event_0co53lt via Flow_0cguw1v.</em></li>
        <li><strong>Som stakeholder</strong> vill jag kunna granska ändringar som gjorts under processen via "Review changes" user task (review-changes) <strong>så att</strong> jag kan bekräfta att all information är korrekt innan processen avslutas. <em>Acceptanskriterier: "Review changes" user task (review-changes) ska aktiveras när "Stakeholder review?" gateway (stakeholder-review) avgör "Yes" via Flow_02a9j2n. Efter granskning, ska flödet gå till "Changes accepted?" gateway (changes-accepted) via Flow_15yi7l9.</em></li>
        <li><strong>Som stakeholder</strong> vill jag att systemet automatiskt avgör om ändringar accepteras via "Changes accepted?" gateway (changes-accepted) <strong>så att</strong> processen fortsätter korrekt efter min granskning. <em>Acceptanskriterier: "Changes accepted?" gateway (changes-accepted) ska automatiskt avgöra om ändringar accepteras efter stakeholder-granskning. Om "Yes", ska flödet gå till Gateway_165hz99 via changes-accepted-yes. Om "No", ska processen loopa tillbaka till Gateway_0e24xxh via Flow_0idwco8 för att hantera nya ändringar.</em></li>
      </ul>

      <h3>Systemperspektiv</h3>
      <ul>
        <li><strong>Som systemadministratör</strong> vill jag att processen startar via start event (start-event) <strong>så att</strong> Object Control-processen kan initieras när den anropas från Manual Credit Evaluation-processen. <em>Acceptanskriterier: Start event (start-event) ska triggas när Object Control-processen anropas från Manual Credit Evaluation-processen via "object-control" call activity. Efter start event, ska flödet gå till Gateway_0e24xxh via Flow_1nc4bwi.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att Gateway_0e24xxh kan samla flöden från olika sökvägar <strong>så att</strong> processen kan hantera både initial start och loopar från avvisade ändringar. <em>Acceptanskriterier: Gateway_0e24xxh ska ta emot flöden från start event via Flow_1nc4bwi eller från "Changes accepted?" gateway "No" via Flow_0idwco8. Efter gateway, ska flödet gå till "Is bostadsrätt?" gateway (is-bostadsratt) via Flow_07176fz.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att Gateway_14f9my2 kan samla flöden från olika sökvägar <strong>så att</strong> processen kan hantera både initial BRF-kontroll och loopar från saknad BRF-information. <em>Acceptanskriterier: Gateway_14f9my2 ska ta emot flöden från "Is bostadsrätt?" gateway "Yes" via is-bostadsratt-yes eller från "BRF screening result" gateway "BRF information missing" via brf-screening-result-missing-info. Efter gateway, ska flödet gå till "Has updated BRF information?" gateway (has-brf-information) via Flow_0p4x73i.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att "Object information" call activity (object-information) automatiskt samlar objektinformation <strong>så att</strong> objektdata är tillgänglig för kontroll. <em>Acceptanskriterier: "Object information" call activity (object-information) ska anropas när BRF-information registreras via Flow_0vgcod9. Efter samling, ska flödet gå till "Changes requires rescoring?" gateway (changes-requires-rescoring) via Flow_0f9er8h.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att Gateway_0qigv85 kan samla flöden från olika sökvägar <strong>så att</strong> processen kan hantera både bostadsrätter och småhus. <em>Acceptanskriterier: Gateway_0qigv85 ska ta emot flöden från "Is bostadsrätt?" gateway "No" via is-bostadsratt-no eller från "Object approved?" gateway "Yes" via object-approved-yes. Efter gateway, ska flödet gå till "Needs valuation?" gateway (needs-valuation) via Flow_1dfs1w2.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att Gateway_0df2uib kan samla flöden från olika sökvägar <strong>så att</strong> processen kan hantera både scenarier med och utan värdering. <em>Acceptanskriterier: Gateway_0df2uib ska ta emot flöden från "Determine object value" user task via Flow_00qg51q eller från "Needs valuation?" gateway "No" via needs-valuation-no. Efter gateway, ska flödet gå till "Stakeholder review?" gateway (stakeholder-review) via Flow_1omyh9m.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att "Stakeholder review?" gateway (stakeholder-review) kan avgöra om stakeholder-granskning behövs <strong>så att</strong> stakeholder-granskning endast används när det behövs. <em>Acceptanskriterier: "Stakeholder review?" gateway (stakeholder-review) ska automatiskt avgöra om stakeholder-granskning behövs. Om "Yes", ska flödet gå till "Review changes" user task (review-changes) via Flow_02a9j2n. Om "No", ska flödet gå direkt till Gateway_165hz99 via Flow_1pqu87h.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att Gateway_165hz99 kan samla flöden från olika sökvägar <strong>så att</strong> processen kan hantera både scenarier med och utan stakeholder-granskning. <em>Acceptanskriterier: Gateway_165hz99 ska ta emot flöden från "Changes accepted?" gateway "Yes" via changes-accepted-yes eller från "Stakeholder review?" gateway "No" via Flow_1pqu87h. Efter gateway, ska flödet gå till process end event (process-end-event) via Flow_1u0wig6.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att processen avslutas normalt via process end event (process-end-event) när alla kontroller är godkända <strong>så att</strong> Manual Credit Evaluation-processen kan fortsätta. <em>Acceptanskriterier: Process end event (process-end-event) ska triggas när Gateway_165hz99 har samlat flöden via Flow_1u0wig6. Processen ska returnera till Manual Credit Evaluation-processen via "object-control" call activity.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att "BRF rejected" error events (Event_1pqluun, Event_0i6cize) automatiskt triggas när BRF avvisas <strong>så att</strong> endast kvalificerade objekt fortsätter i processen. <em>Acceptanskriterier: "BRF rejected" error event (Event_1pqluun) ska triggas när "BRF screening result" gateway avgör "Rejected" via brf-screening-result-rejected med error code "brf-rejected" (Error_1t95jmk). "BRF rejected" error event (Event_0i6cize) ska triggas när "BRF approved?" gateway avgör "No" via brf-approved-no med error code "brf-rejected" (Error_1t95jmk). Error events ska signalera till Manual Credit Evaluation-processen via boundary events.</em></li>
        <li><strong>Som systemadministratör</strong> vill jag att "Object rejected" error event (Event_1yyhlmr) automatiskt triggas när objekt avvisas <strong>så att</strong> endast godkända objekt fortsätter i processen. <em>Acceptanskriterier: "Object rejected" error event (Event_1yyhlmr) ska triggas när "Object approved?" gateway (object-approved) avgör "No" via object-approved-no med error code "object-rejected" (Error_0nouvlm). Error event ska signalera till Manual Credit Evaluation-processen via boundary event.</em></li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Acceptanskriterier</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska acceptanskriterier som kan kopplas till feature goalet.</p>
      
      <h3>Objekttyp-kontroll</h3>
      <ul>
        <li>"Is bostadsrätt?" gateway ska korrekt identifiera om objektet är en bostadsrätt. Om "Yes", ska processen fortsätta till BRF-kontroll. Om "No", ska processen hoppa över BRF-kontroll och gå direkt till objektvärdering</li>
      </ul>
      
      <h3>BRF-information och screening</h3>
      <ul>
        <li>"Has updated BRF information?" gateway ska korrekt identifiera om BRF-information finns tillgänglig. Om "No", ska "Register BRF information" user task aktiveras för handläggaren</li>
        <li>"Register BRF information" user task ska spara information i "BRF information database" datastore</li>
        <li>"Object information" call activity ska samla objektinformation (storlek, typ, plats, max lånebelopp, energiklass, etc.) när BRF-information registreras</li>
        <li>"Changes requires rescoring?" gateway ska korrekt identifiera om ändringar kräver omvärdering. Om "Yes", ska "Automatic Credit Evaluation" call activity anropas automatiskt</li>
        <li>"BRF screening result" gateway ska korrekt avgöra resultatet av BRF-screening. Gateway ska ha fyra utgångar: "Rejected", "Accepted", "Review", och "BRF information missing"</li>
        <li>Om "BRF screening result" gateway returnerar "Rejected", ska "BRF rejected" error event (Event_1pqluun) triggas med error code "brf-rejected"</li>
        <li>Om "BRF screening result" gateway returnerar "Review", ska "Review BRF" user task aktiveras för handläggaren</li>
        <li>"BRF approved?" gateway ska korrekt avgöra om BRF godkänns efter manuell granskning. Om "No", ska "BRF rejected" error event (Event_0i6cize) triggas med error code "brf-rejected"</li>
        <li>Om "BRF screening result" gateway returnerar "BRF information missing", ska processen automatiskt loopa tillbaka till "Has updated BRF information?" gateway</li>
      </ul>
      
      <h3>Lägenhetsutdrag-kontroll</h3>
      <ul>
        <li>"Control lägenhets-utdrag" user task ska aktiveras för handläggaren när BRF är godkänd</li>
        <li>"Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) ska kunna triggas på "Control lägenhets-utdrag" user task för att begära dokumentation från stakeholder</li>
        <li>När "Request lägenhetsutdrag" boundary event triggas, ska "Upload documentation" user task aktiveras för stakeholder</li>
        <li>"Object approved?" gateway ska korrekt avgöra om objektet är godkänt. Om "No", ska "Object rejected" error event (Event_1yyhlmr) triggas med error code "object-rejected"</li>
      </ul>
      
      <h3>Objektvärdering</h3>
      <ul>
        <li>"Needs valuation?" gateway ska korrekt identifiera om objektvärdering behövs. Om "Yes", ska "Determine object value" user task aktiveras för värderaren</li>
        <li>"Request mäklarvärdering" boundary event (request-maklarvardering) ska kunna triggas på "Determine object value" user task för att begära mäklarvärdering från stakeholder</li>
        <li>När "Request mäklarvärdering" boundary event triggas, ska "Upload object valuation documentation" user task aktiveras för stakeholder</li>
      </ul>
      
      <h3>Stakeholder-granskning och avslut</h3>
      <ul>
        <li>"Stakeholder review?" gateway ska korrekt identifiera om stakeholder ska granska ändringar. Om "Yes", ska "Review changes" user task aktiveras för stakeholder</li>
        <li>"Changes accepted?" gateway ska korrekt avgöra om ändringar accepteras. Om "Yes", ska processen avslutas normalt. Om "No", ska processen automatiskt loopa tillbaka till början via Gateway_0e24xxh för att hantera nya ändringar</li>
      </ul>
      
      <h3>Felhantering</h3>
      <ul>
        <li>Om "BRF screening result" gateway returnerar "Rejected", ska "BRF rejected" error event (Event_1pqluun) triggas med error code "brf-rejected", vilket signalerar till Manual Credit Evaluation-processen att BRF har avvisats</li>
        <li>Om "BRF approved?" gateway returnerar "No", ska "BRF rejected" error event (Event_0i6cize) triggas med error code "brf-rejected", vilket signalerar till Manual Credit Evaluation-processen att BRF har avvisats</li>
        <li>Om "Object approved?" gateway returnerar "No", ska "Object rejected" error event (Event_1yyhlmr) triggas med error code "object-rejected", vilket signalerar till Manual Credit Evaluation-processen att objektet har avvisats</li>
        <li>Alla error events ska korrekt trigga motsvarande boundary events i Manual Credit Evaluation-processen för att säkerställa att hela processen avbryts när objektet avvisas</li>
      </ul>
      
      <h3>Processvariabler och data</h3>
      <ul>
        <li>Alla processvariabler ska skickas med när Object Control anropas från Manual Credit Evaluation-processen för att säkerställa fullständig kontext</li>
        <li>BRF-information som registreras via "Register BRF information" user task ska korrekt sparas i "BRF information database" datastore</li>
        <li>Resultat från "Object information" call activity ska korrekt sparas och användas i efterföljande gateways</li>
        <li>Resultat från "Automatic Credit Evaluation" call activity (om anropad) ska korrekt sparas och användas i efterföljande gateways</li>
        <li>Dokumentation som laddas upp via "Upload documentation" och "Upload object valuation documentation" user tasks ska korrekt sparas i systemet</li>
      </ul>

      <h3>Tekniska krav</h3>
      <ul>
        <li><strong>Timeout:</strong> User tasks ska ha timeout på 7 dagar för handläggare, 14 dagar för stakeholder, 5 dagar för värderare. Call activities ("Object information", "Automatic Credit Evaluation") ska ha timeout på 60 sekunder</li>
        <li><strong>Retry:</strong> Call activities ska ha automatisk retry med exponential backoff (max 3 försök) vid tekniska fel</li>
        <li><strong>Error codes:</strong> Systemet ska returnera specifika error codes: BRF_REJECTED (för avvisad BRF), OBJECT_REJECTED (för avvisat objekt), OBJECT_CONTROL_TIMEOUT (för timeout), OBJECT_CONTROL_DATA_MISSING (för saknad data)</li>
        <li><strong>Logging:</strong> Alla gateways, user tasks och error events ska loggas med tidsstämplar, användar-ID och resultat för spårbarhet</li>
      </ul>

      <h3>UI/UX-krav</h3>
      <ul>
        <li><strong>Handläggarvyer:</strong> User tasks ska visa tydlig, strukturerad information om objekt, BRF, lägenhetsutdrag och värdering med separata sektioner för varje typ av information</li>
        <li><strong>Boundary events:</strong> Boundary events ("Request lägenhetsutdrag", "Request mäklarvärdering") ska vara tydligt synliga och lättåtkomliga för handläggare och värderare</li>
        <li><strong>Statusindikatorer:</strong> Systemet ska visa tydlig status för varje steg i processen (BRF-kontroll, lägenhetsutdrag, objektvärdering, stakeholder-granskning) med visuella indikatorer</li>
        <li><strong>Loop-indikatorer:</strong> När processen loopar tillbaka via Gateway_0e24xxh, ska systemet visa tydligt varför loopen skedde och vilka ändringar som gjorts</li>
      </ul>

      <h3>Skalbarhet och prestanda</h3>
      <ul>
        <li><strong>Parallellisering:</strong> Systemet ska kunna hantera flera Object Control-processer parallellt utan prestandaförsämring</li>
        <li><strong>Load balancing:</strong> Call activities ska kunna hantera minst 30 anrop per minut med genomsnittlig svarstid under 5 sekunder</li>
        <li><strong>Databasoptimering:</strong> Alla databasfrågor för BRF-information och objektdata ska vara optimerade med indexering</li>
      </ul>

      <h3>Säkerhet och compliance</h3>
      <ul>
        <li><strong>Dataskydd:</strong> All känslig objektinformation och BRF-data ska krypteras i vila och under överföring (TLS 1.3). Åtkomst till objektdata ska loggas för audit trail</li>
        <li><strong>GDPR-efterlevnad:</strong> Alla objektkontroller ska innehålla spårbarhet för vem som genomförde kontrollen, när och resultatet, för att uppfylla GDPR-krav</li>
        <li><strong>Audit trail:</strong> Alla ändringar i objektstatus, BRF-godkännande och värdering ska loggas med användar-ID, tidsstämplar och ändringsorsak för fullständig spårbarhet</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Testgenerering</summary>
        <div class="section-content">
<p class="muted">Detaljerad testgenerering för att säkerställa att feature goalet fungerar korrekt.</p>
      
      <h3>Testscenarier</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Namn</th>
            <th>Typ</th>
            <th>Persona</th>
            <th>Risk Level</th>
            <th>Assertion Type</th>
            <th>Outcome</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          
      <tr>
        <td><strong>S1</strong></td>
        <td>Småhus – ingen BRF-kontroll, värdering krävs</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P0</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är småhus. Testdata: object-control-house. <strong>When:</strong> "Is bostadsrätt?" gateway (is-bostadsratt) avgör "No". "Needs valuation?" gateway (needs-valuation) avgör "Yes". "Determine object value" user task (determine-object-value) fastställer värde. "Stakeholder review?" gateway (stakeholder-review) avgör "No". <strong>Then:</strong> Processen avslutas normalt (process-end-event).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S2</strong></td>
        <td>Bostadsrätt – BRF godkänd, värdering krävs</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P0</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är bostadsrätt. BRF-information finns. Testdata: object-control-brf-approved. <strong>When:</strong> "Is bostadsrätt?" gateway (is-bostadsratt) avgör "Yes". "Has updated BRF information?" gateway (has-brf-information) avgör "Yes". "BRF screening result" gateway (brf-screening-result) avgör "Accepted". "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) kontrollerar. "Object approved?" gateway (object-approved) avgör "Yes". "Needs valuation?" gateway (needs-valuation) avgör "Yes". "Determine object value" user task (determine-object-value) fastställer värde. <strong>Then:</strong> Processen avslutas normalt (process-end-event).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S3</strong></td>
        <td>Bostadsrätt – BRF-information saknas, registreras</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P0</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är bostadsrätt. BRF-information saknas. Testdata: object-control-brf-missing. <strong>When:</strong> "Is bostadsrätt?" gateway (is-bostadsratt) avgör "Yes". "Has updated BRF information?" gateway (has-brf-information) avgör "No". "Register BRF information" user task (register-brf-information) registrerar BRF. "Object information" call activity (object-information) samlar objektinformation. "Changes requires rescoring?" gateway (changes-requires-rescoring) avgör "No". "BRF screening result" gateway (brf-screening-result) avgör "Accepted". <strong>Then:</strong> Processen fortsätter till lägenhetsutdrag-kontroll.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S4</strong></td>
        <td>BRF avvisad – screening rejected</td>
        <td>Error</td>
        <td>advisor</td>
        <td>P0</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är bostadsrätt. BRF-information finns. BRF uppfyller inte krav. Testdata: object-control-brf-rejected. <strong>When:</strong> "Is bostadsrätt?" gateway (is-bostadsratt) avgör "Yes". "BRF screening result" gateway (brf-screening-result) avgör "Rejected". <strong>Then:</strong> "BRF rejected" error event (Event_1pqluun, error code: brf-rejected) triggas. Boundary event triggas i Manual Credit Evaluation-processen.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S5</strong></td>
        <td>BRF avvisad – manuell granskning</td>
        <td>Error</td>
        <td>advisor</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är bostadsrätt. BRF kräver manuell granskning. Testdata: object-control-brf-review-rejected. <strong>When:</strong> "BRF screening result" gateway (brf-screening-result) avgör "Review". "Review BRF" user task (review-brf) granskar BRF. "BRF approved?" gateway (brf-approved) avgör "No". <strong>Then:</strong> "BRF rejected" error event (Event_0i6cize, error code: brf-rejected) triggas. Boundary event triggas i Manual Credit Evaluation-processen.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S6</strong></td>
        <td>Objekt avvisat – lägenhetsutdrag ofullständig</td>
        <td>Error</td>
        <td>advisor</td>
        <td>P0</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. BRF är godkänd. Lägenhetsutdrag är ofullständig. Testdata: object-control-object-rejected. <strong>When:</strong> "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) kontrollerar. "Object approved?" gateway (object-approved) avgör "No". <strong>Then:</strong> "Object rejected" error event (Event_1yyhlmr, error code: object-rejected) triggas. Boundary event triggas i Manual Credit Evaluation-processen.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S7</strong></td>
        <td>Request lägenhetsutdrag boundary event</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. BRF är godkänd. Lägenhetsutdrag saknas. Testdata: object-control-request-documentation. <strong>When:</strong> "Control lägenhets-utdrag" user task (control-lagenhetsutdrag) aktiveras. "Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) triggas. "Upload documentation" user task (upload-documentation) aktiveras för stakeholder. Stakeholder laddar upp dokumentation. <strong>Then:</strong> Dokumentation sparas. Processen fortsätter till "Object approved?" gateway (object-approved).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S8</strong></td>
        <td>Request mäklarvärdering boundary event</td>
        <td>Happy</td>
        <td>valuator</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektvärdering krävs. Mäklarvärdering saknas. Testdata: object-control-request-valuation. <strong>When:</strong> "Needs valuation?" gateway (needs-valuation) avgör "Yes". "Determine object value" user task (determine-object-value) aktiveras. "Request mäklarvärdering" boundary event (request-maklarvardering) triggas. "Upload object valuation documentation" user task (upload-object-valuation-document) aktiveras för stakeholder. Stakeholder laddar upp mäklarvärdering. <strong>Then:</strong> Mäklarvärdering sparas. Värderare fortsätter värderingen. Processen fortsätter normalt.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S9</strong></td>
        <td>Ändringar kräver omvärdering – Automatic Credit Evaluation</td>
        <td>Happy</td>
        <td>system</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. BRF-information registreras. Ändringar kräver omvärdering. Testdata: object-control-rescoring. <strong>When:</strong> "Register BRF information" user task (register-brf-information) registrerar BRF. "Object information" call activity (object-information) samlar objektinformation. "Changes requires rescoring?" gateway (changes-requires-rescoring) avgör "Yes". "Automatic Credit Evaluation" call activity (credit-evaluation-2) anropas. <strong>Then:</strong> Automatic Credit Evaluation-processen genomförs. Resultatet returneras. Processen fortsätter till "BRF screening result" gateway (brf-screening-result).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S10</strong></td>
        <td>BRF information missing – loop</td>
        <td>Edge</td>
        <td>advisor</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. BRF-screening indikerar saknad information. Testdata: object-control-brf-missing-loop. <strong>When:</strong> "BRF screening result" gateway (brf-screening-result) avgör "BRF information missing". Processen loopar tillbaka till "Has updated BRF information?" gateway (has-brf-information) via Gateway_14f9my2. "Register BRF information" user task (register-brf-information) registrerar kompletterande information. <strong>Then:</strong> Processen fortsätter med ny BRF-screening. Handläggaren får tydlig feedback om loopen.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S11</strong></td>
        <td>Stakeholder avvisar ändringar – loop</td>
        <td>Edge</td>
        <td>customer</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Alla kontroller är godkända. Ändringar har gjorts. Testdata: object-control-changes-rejected. <strong>When:</strong> "Stakeholder review?" gateway (stakeholder-review) avgör "Yes". "Review changes" user task (review-changes) granskar ändringar. "Changes accepted?" gateway (changes-accepted) avgör "No". Processen loopar tillbaka till Gateway_0e24xxh. <strong>Then:</strong> Processen startar om med nya ändringar. Handläggaren får tydlig feedback om varför loopen skedde.</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S12</strong></td>
        <td>Bostadsrätt – BRF kräver manuell granskning, godkänns</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är bostadsrätt. BRF kräver manuell granskning. Testdata: object-control-brf-review-approved. <strong>When:</strong> "BRF screening result" gateway (brf-screening-result) avgör "Review". "Review BRF" user task (review-brf) granskar BRF. "BRF approved?" gateway (brf-approved) avgör "Yes". <strong>Then:</strong> Processen fortsätter till "Control lägenhets-utdrag" user task (control-lagenhetsutdrag).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S13</strong></td>
        <td>Ingen värdering behövs</td>
        <td>Happy</td>
        <td>advisor</td>
        <td>P1</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Objektet är godkänt. Värdering behövs inte. Testdata: object-control-no-valuation. <strong>When:</strong> "Needs valuation?" gateway (needs-valuation) avgör "No". "Stakeholder review?" gateway (stakeholder-review) avgör "No". <strong>Then:</strong> Processen avslutas normalt (process-end-event).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S14</strong></td>
        <td>Object information timeout – retry lyckas</td>
        <td>Edge</td>
        <td>system</td>
        <td>P2</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. BRF-information registreras. Object information service svarar långsamt. Testdata: object-control-object-info-timeout. <strong>When:</strong> "Object information" call activity (object-information) timeout (60 sekunder). Retry-logik aktiveras (max 3 försök, exponential backoff). <strong>Then:</strong> Efter retry lyckas samling. Processen fortsätter till "Changes requires rescoring?" gateway (changes-requires-rescoring).</td>
        <td>✅ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S15</strong></td>
        <td>Automatic Credit Evaluation timeout – retry lyckas</td>
        <td>Edge</td>
        <td>system</td>
        <td>P2</td>
        <td>functional</td>
        <td><strong>Given:</strong> Object Control-processen startar. Ändringar kräver omvärdering. Credit evaluation service svarar långsamt. Testdata: object-control-credit-eval-timeout. <strong>When:</strong> "Automatic Credit Evaluation" call activity (credit-evaluation-2) timeout (60 sekunder). Retry-logik aktiveras (max 3 försök, exponential backoff). <strong>Then:</strong> Efter retry lyckas omvärdering. Processen fortsätter till "BRF screening result" gateway (brf-screening-result).</td>
        <td>✅ Planerad</td>
      </tr>
    
        </tbody>
      </table>

      <h3>UI Flow per Scenario</h3>
      <p class="muted">Detaljerade steg för varje scenario. Expandera för att se UI Flow.</p>

      <h3>Testdata-referenser</h3>
      <ul>
        <li><strong>Småhus-objekt:</strong> Objekttyp = "småhus", objekt-ID = "OBJ-001". Förväntat resultat: BRF-kontroll hoppas över, värdering genomförs, processen avslutas normalt</li>
        <li><strong>Bostadsrätt med godkänd BRF:</strong> Objekttyp = "bostadsrätt", BRF-ID = "BRF-001", BRF-status = "godkänd". Förväntat resultat: BRF-kontroll genomförs, lägenhetsutdrag kontrolleras, värdering genomförs, processen avslutas normalt</li>
        <li><strong>Bostadsrätt med avvisad BRF:</strong> Objekttyp = "bostadsrätt", BRF-ID = "BRF-002", BRF-status = "avvisad". Förväntat resultat: "BRF rejected" error event triggas, processen avbryts</li>
        <li><strong>Objekt som avvisas:</strong> Objekt-ID = "OBJ-003", lägenhetsutdrag = "ofullständig". Förväntat resultat: "Object rejected" error event triggas, processen avbryts</li>
        <li><strong>Ändringar kräver omvärdering:</strong> Objekt-ID = "OBJ-004", ändringar = "storlek ändrad". Förväntat resultat: "Automatic Credit Evaluation" call activity anropas</li>
        <li><strong>Stakeholder avvisar ändringar:</strong> Objekt-ID = "OBJ-005", stakeholder-beslut = "avvisa". Förväntat resultat: Processen loopar tillbaka till början</li>
      </ul>

      <h3>Implementation Mapping</h3>
      <ul>
        <li><strong>Routes:</strong>
          <ul>
            <li><code>/api/object-control/check-brf</code> - "Is bostadsrätt?" gateway och BRF-kontroll</li>
            <li><code>/api/object-control/register-brf</code> - "Register BRF information" user task</li>
            <li><code>/api/object-control/screen-brf</code> - "BRF screening result" gateway</li>
            <li><code>/api/object-control/control-apartment-extract</code> - "Control lägenhets-utdrag" user task</li>
            <li><code>/api/object-control/determine-value</code> - "Determine object value" user task</li>
            <li><code>/api/object-control/review-changes</code> - "Review changes" user task</li>
            <li><code>/api/object-control/request-documentation</code> - "Request lägenhetsutdrag" boundary event</li>
            <li><code>/api/object-control/request-valuation</code> - "Request mäklarvärdering" boundary event</li>
          </ul>
        </li>
        <li><strong>Endpoints:</strong>
          <ul>
            <li><code>GET /api/object-control/check-brf</code> - Kontrollera om objekt är bostadsrätt och om BRF-kontroll behövs</li>
            <li><code>POST /api/object-control/register-brf</code> - Registrera BRF-information, returnerar registrerad information</li>
            <li><code>POST /api/object-control/screen-brf</code> - Screena BRF-information, returnerar screening-resultat</li>
            <li><code>GET /api/object-control/control-apartment-extract</code> - Hämta lägenhetsutdrag för kontroll</li>
            <li><code>POST /api/object-control/control-apartment-extract</code> - Spara kontrollresultat för lägenhetsutdrag</li>
            <li><code>GET /api/object-control/determine-value</code> - Hämta objektinformation för värdering</li>
            <li><code>POST /api/object-control/determine-value</code> - Spara värderingsresultat</li>
            <li><code>GET /api/object-control/review-changes</code> - Hämta ändringar för granskning</li>
            <li><code>POST /api/object-control/review-changes</code> - Spara granskningsresultat (acceptera/avvisa)</li>
            <li><code>POST /api/object-control/request-documentation</code> - Begära lägenhetsutdrag från stakeholder</li>
            <li><code>POST /api/object-control/request-valuation</code> - Begära mäklarvärdering från stakeholder</li>
          </ul>
        </li>
        <li><strong>Datastores:</strong>
          <ul>
            <li><code>brf_information_database</code> - Lagrar BRF-information som registreras av handläggaren</li>
            <li><code>object_control_results</code> - Lagrar objektkontrollresultat med objekt-ID, BRF-status, värdering och tidsstämplar</li>
            <li><code>object_control_audit</code> - Lagrar audit trail för alla objektkontroller med användar-ID, tidsstämplar och ändringsorsak</li>
            <li><code>documentation_storage</code> - Lagrar dokumentation (lägenhetsutdrag, mäklarvärdering) som laddas upp av stakeholder</li>
          </ul>
        </li>
      </ul>
        </div>
      </details>
    </section>
      </body>
</html>