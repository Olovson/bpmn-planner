<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="bpmn_file" content="mortgage-se-object-control.bpmn">
  <meta name="element_id" content="object-control">
  <meta name="version" content="v2">
  <title>Object control</title>
  <style>
    :root {
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --accent: #e0e7ff;
      --bg-light: #f8f9fa;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 24px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin: 0 0 32px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 12px;
      color: var(--text-strong);
    }
    h2 {
      color: var(--primary);
      margin: 0;
      font-size: 1.5rem;
    }
    h3 {
      color: var(--text-strong);
      margin: 32px 0 12px;
      font-size: 1.2rem;
    }
    p { margin: 0 0 12px; }
    ul {
      padding-left: 24px;
      margin: 0 0 16px;
    }
    li { margin-bottom: 8px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 12px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted {
      color: var(--text-muted);
      font-size: 0.9rem;
      font-style: italic;
    }
    .card {
      background: var(--bg-light);
      padding: 20px;
      border-radius: 8px;
      margin: 16px 0;
      border-left: 4px solid var(--primary);
    }
    .doc-section {
      margin-bottom: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .doc-section details {
      margin: 0;
    }
    .doc-section details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 16px 20px;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border);
      user-select: none;
      font-size: 1.5rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .doc-section details summary::-webkit-details-marker {
      display: none;
    }
    .doc-section details summary::before {
      content: '▶';
      display: inline-block;
      transition: transform 0.2s;
      font-size: 0.8rem;
      color: var(--primary);
    }
    .doc-section details[open] summary::before {
      transform: rotate(90deg);
    }
    .doc-section details summary:hover {
      background: var(--accent);
    }
    .doc-section details .section-content {
      padding: 20px;
    }
    .doc-section details[open] summary {
      border-bottom: 1px solid var(--border);
    }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .local-version-badge {
      background: #e0f2fe;
      color: #0369a1;
      padding: 8px 16px;
      margin: 16px 0;
      border-radius: 6px;
      border-left: 4px solid #0284c7;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    details {
      margin: 16px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 12px;
      background: var(--bg-light);
      border: 1px solid var(--border);
      border-radius: 6px;
      user-select: none;
    }
    details summary:hover {
      background: var(--accent);
    }
    details[open] summary {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
    details .collapsible-content {
      padding: 16px;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 6px 6px;
      margin-top: 0;
    }
    img {
      max-width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin: 12px 0;
    }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
</style>
</head>
<body>
  
    
      
<h1>Object control</h1>
  
  <section class="doc-section">
      <details open>
        <summary>Beskrivning av FGoal</summary>
        <div class="section-content">
      <p>Object control är en process där handläggare kontrollerar och validerar objektinformation, särskilt för bostadsrätter (BRF). Processen anropas från Manual Credit Evaluation när objektkontroll krävs som en del av den manuella kreditevalueringen. Processen syftar till att säkerställa att objektet uppfyller alla krav och att all nödvändig information är korrekt och komplett.</p>
      <p>Processen börjar med att systemet avgör om objektet är en bostadsrätt. Om det är en bostadsrätt, kontrolleras om BRF-information finns tillgänglig. Om information saknas, registrerar handläggaren BRF-information och samlar objektinformation via "Object information" call activity. Om ändringar kräver omvärdering, genomförs automatisk kreditevaluering. BRF-information screenas mot affärsregler, och om screeningen kräver manuell granskning, granskas BRF:en av handläggaren. Om BRF godkänns, kontrolleras lägenhetsutdrag. Om objektet inte är en bostadsrätt eller om bostadsrätten är godkänd, avgörs om objektvärdering behövs. Om värdering krävs, fastställs objektets värde av en värderare. Slutligen kan stakeholdern granska ändringar innan processen avslutas.</p>
        </div>
      </details>
    </section>
<section class="doc-section">
      <details>
        <summary>Processteg - Input</summary>
        <div class="section-content">
      <p>Object Control-processen startar när:</p>
      <ul>
        <li><strong>Objektkontroll krävs:</strong> Processen anropas från Manual Credit Evaluation-processen när "Object control" identifieras som ett krav via "Requirements?" inclusive gateway</li>
        <li><strong>Processkontext:</strong> Object Control anropas från Manual Credit Evaluation via "Object control" call activity. Alla relevanta processvariabler skickas med för att säkerställa fullständig kontext</li>
        <li><strong>Objektinformation är tillgänglig:</strong> Grundläggande objektinformation, inklusive objekttyp och identifierad information, är tillgänglig för att påbörja kontrollen</li>
        <li><strong>Ansökningsdata är tillgänglig:</strong> All befintlig ansökningsdata, inklusive kundinformation och tidigare kreditevalueringsresultat, är tillgänglig för handläggaren</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Processteg - Output</summary>
        <div class="section-content">
      <p>När Object Control-processen är slutförd har följande resultat uppnåtts:</p>
      <ul>
        <li><strong>Objektet är kontrollerat och godkänt:</strong> All objektinformation har verifierats, BRF-information (om tillämpligt) har screenats och godkänts, lägenhetsutdrag har kontrollerats, och objektet är godkänt för vidare processering</li>
        <li><strong>Objektvärdering är slutförd (om nödvändig):</strong> Om objektvärdering krävdes, har objektets värde fastställts av en värderare</li>
        <li><strong>Processen avslutas normalt:</strong> Om alla kontroller är godkända och stakeholdern (om relevant) har accepterat ändringar, avslutas processen normalt och Manual Credit Evaluation-processen fortsätter med nästa steg</li>
        <li><strong>Felhantering vid avvisning:</strong> Om BRF avvisas via "BRF screening result" gateway "Rejected" eller "BRF approved" gateway "No", triggas "BRF rejected" error event. Om objektet avvisas via "Object approved?" gateway "No", triggas "Object rejected" error event. Dessa signalerar till Manual Credit Evaluation-processen att objektet inte uppfyller kraven</li>
        <li><strong>Loop-mekanismer:</strong> Om ändringar inte accepteras av stakeholdern via "Changes accepted?" gateway "No", loopar processen tillbaka till början för att hantera nya ändringar</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Omfattning</summary>
        <div class="section-content">
      <p>Object Control-processen omfattar följande huvudsteg och aktiviteter:</p>
      
      <h3>1. Objekttyp-kontroll</h3>
      <ul>
        <li><strong>Is bostadsrätt? (gateway):</strong> En beslutspunkt avgör om objektet är en bostadsrätt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till BRF-kontroll</li>
            <li><strong>No:</strong> Processen hoppar över BRF-kontroll och går direkt till objektvärdering</li>
          </ul>
        </li>
      </ul>

      <h3>2. BRF-information och screening (för bostadsrätter)</h3>
      <ul>
        <li><strong>Has updated BRF information? (gateway):</strong> En beslutspunkt avgör om BRF-information finns tillgänglig:
          <ul>
            <li><strong>Yes:</strong> Processen hoppar över registrering och går direkt till BRF-screening</li>
            <li><strong>No:</strong> Processen går till "Register BRF information" user task</li>
          </ul>
        </li>
        <li><strong>Register BRF information (user task):</strong> Handläggaren registrerar BRF-information som saknas. Information sparas i "BRF information database" datastore</li>
        <li><strong>Object information (call activity):</strong> Systemet samlar objektinformation via "Object information" call activity</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> En beslutspunkt avgör om ändringar kräver omvärdering:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Automatic Credit Evaluation" call activity för omvärdering</li>
            <li><strong>No:</strong> Processen hoppar över omvärdering och går direkt till BRF-screening</li>
          </ul>
        </li>
        <li><strong>Automatic Credit Evaluation (call activity, om behövs):</strong> Om ändringar kräver omvärdering, genomförs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> En beslutspunkt avgör resultatet av BRF-screening:
          <ul>
            <li><strong>Rejected:</strong> Processen avslutas med "BRF rejected" error event</li>
            <li><strong>Accepted:</strong> Processen fortsätter till lägenhetsutdrag-kontroll</li>
            <li><strong>Review:</strong> Processen går till "Review BRF" user task för manuell granskning</li>
            <li><strong>BRF information missing:</strong> Processen loopar tillbaka till "Has updated BRF information?" gateway</li>
          </ul>
        </li>
        <li><strong>Review BRF (user task):</strong> Handläggaren granskar BRF-information manuellt när screeningen kräver det</li>
        <li><strong>BRF approved? (gateway):</strong> En beslutspunkt avgör om BRF godkänns efter manuell granskning:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till lägenhetsutdrag-kontroll</li>
            <li><strong>No:</strong> Processen avslutas med "BRF rejected" error event</li>
          </ul>
        </li>
      </ul>

      <h3>3. Lägenhetsutdrag-kontroll (för bostadsrätter)</h3>
      <ul>
        <li><strong>Control lägenhets-utdrag (user task):</strong> Handläggaren kontrollerar lägenhetsutdrag. Caseworker kan hämta dokument från Tambur eller begära dokumentation från stakeholder</li>
        <li><strong>Request lägenhetsutdrag (boundary event):</strong> På "Control lägenhets-utdrag" user task kan "Request lägenhetsutdrag" boundary event triggas för att begära dokumentation från stakeholder, vilket triggar "Upload documentation" user task</li>
        <li><strong>Upload documentation (user task):</strong> Stakeholder laddar upp begärd dokumentation</li>
        <li><strong>Object approved? (gateway):</strong> En beslutspunkt avgör om objektet är godkänt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till objektvärdering</li>
            <li><strong>No:</strong> Processen avslutas med "Object rejected" error event</li>
          </ul>
        </li>
      </ul>

      <h3>4. Objektvärdering</h3>
      <ul>
        <li><strong>Needs valuation? (gateway):</strong> En beslutspunkt avgör om objektvärdering behövs:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Determine object value" user task</li>
            <li><strong>No:</strong> Processen hoppar över värdering och går direkt till stakeholder-granskning</li>
          </ul>
        </li>
        <li><strong>Determine object value (user task):</strong> Värderaren fastställer objektets värde. Detta kan vara ett externt system som används av värderingsenheten</li>
        <li><strong>Request mäklarvärdering (boundary event):</strong> På "Determine object value" user task kan "Request mäklarvärdering" boundary event triggas för att begära mäklarvärdering, vilket triggar "Upload object valuation documentation" user task</li>
        <li><strong>Upload object valuation documentation (user task):</strong> Stakeholder laddar upp mäklarvärderingsdokumentation</li>
      </ul>

      <h3>5. Stakeholder-granskning och avslut</h3>
      <ul>
        <li><strong>Stakeholder review? (gateway):</strong> En beslutspunkt avgör om stakeholder ska granska ändringar:
          <ul>
            <li><strong>Yes:</strong> Processen går till "Review changes" user task</li>
            <li><strong>No:</strong> Processen hoppar över granskning och avslutas direkt</li>
          </ul>
        </li>
        <li><strong>Review changes (user task):</strong> Stakeholder granskar ändringar som gjorts under processen</li>
        <li><strong>Changes accepted? (gateway):</strong> En beslutspunkt avgör om ändringar accepteras:
          <ul>
            <li><strong>Yes:</strong> Processen avslutas normalt</li>
            <li><strong>No:</strong> Processen loopar tillbaka till början för att hantera nya ändringar</li>
          </ul>
        </li>
      </ul>

      <h3>6. Loop-mekanismer</h3>
      <ul>
        <li><strong>BRF information missing:</strong> Om "BRF screening result" gateway returnerar "BRF information missing", loopar processen tillbaka till "Has updated BRF information?" gateway</li>
        <li><strong>Ändringar inte accepterade:</strong> Om "Changes accepted?" gateway returnerar "No", loopar processen tillbaka till början via Gateway_0e24xxh för att hantera nya ändringar</li>
      </ul>

      <h3>7. Felhantering</h3>
      <ul>
        <li><strong>BRF rejected (error event):</strong> Om "BRF screening result" gateway returnerar "Rejected" eller "BRF approved" gateway returnerar "No", avslutas processen med "BRF rejected" error event (Event_1pqluun eller Event_0i6cize) med error code "brf-rejected"</li>
        <li><strong>Object rejected (error event):</strong> Om "Object approved?" gateway returnerar "No", avslutas processen med "Object rejected" error event (Event_1yyhlmr) med error code "object-rejected"</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Avgränsning</summary>
        <div class="section-content">
<ul>
        <li>Automatisk kreditevaluering (huvudprocess) ingår inte - den sker efter Object Control</li>
        <li>Dokumentationsbedömning (huvudprocess) ingår inte - den sker parallellt i Manual Credit Evaluation</li>
        <li>Avancerad underwriting (huvudprocess) ingår inte - den sker efter Object Control</li>
        <li>Application-processen ingår inte - den sker tidigare i huvudprocessen</li>
        <li>KYC-processen ingår inte - den sker senare i huvudprocessen</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Beroenden</summary>
        <div class="section-content">
<ul>
        <li><strong>Manual Credit Evaluation huvudprocess:</strong> Object Control anropas från mortgage-se-manual-credit-evaluation.bpmn när "Object control" identifieras som ett krav via "Requirements?" inclusive gateway</li>
        <li><strong>Object information (subprocess):</strong> Samling av objektinformation (storlek, typ, plats, max lånebelopp, energiklass, etc.)</li>
        <li><strong>Automatic Credit Evaluation (subprocess):</strong> Automatisk kreditevaluering för omvärdering när ändringar kräver rescoring</li>
        <li><strong>BRF information database (datastore):</strong> Lagrar BRF-information som registreras av handläggaren</li>
        <li><strong>Caseworker:</strong> Registrerar BRF-information, granskar BRF, kontrollerar lägenhetsutdrag, och hanterar dokumentation</li>
        <li><strong>Valuator:</strong> Fastställer objektets värde och kan begära mäklarvärdering</li>
        <li><strong>Stakeholder:</strong> Laddar upp dokumentation (lägenhetsutdrag, mäklarvärdering) och granskar ändringar</li>
        <li><strong>Tambur:</strong> Externt system där caseworker kan hämta dokument (lägenhetsutdrag)</li>
        <li><strong>Värderingsenhet:</strong> Externt system som används av värderingsenheten för objektvärdering</li>
        <li><strong>Felhantering:</strong> Om BRF eller objekt avvisas, triggas error events som signalerar till Manual Credit Evaluation-processen</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>BPMN - Process</summary>
        <div class="section-content">
      <p><a href="#/bpmn/mortgage-se-object-control.bpmn">Visa BPMN-processen för Object Control</a></p>
      
      <h3>Processflöde - Steg för steg</h3>
      <ol>
        <li><strong>Start:</strong> Processen startar när Manual Credit Evaluation-processen anropar "Object control" call activity när "Object control" identifieras som ett krav</li>
        <li><strong>Is bostadsrätt? (gateway):</strong> En beslutspunkt avgör om objektet är en bostadsrätt:
          <ul>
            <li><strong>Yes:</strong> Processen fortsätter till BRF-kontroll</li>
            <li><strong>No:</strong> Processen hoppar över BRF-kontroll och går direkt till objektvärdering</li>
          </ul>
        </li>
        <li><strong>Has updated BRF information? (gateway, för bostadsrätter):</strong> En beslutspunkt avgör om BRF-information finns tillgänglig. Om "No", registrerar handläggaren BRF-information och samlar objektinformation</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> En beslutspunkt avgör om ändringar kräver omvärdering. Om "Yes", genomförs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> En beslutspunkt avgör resultatet av BRF-screening. Om "Review", granskas BRF:en manuellt</li>
        <li><strong>Control lägenhets-utdrag (user task):</strong> Handläggaren kontrollerar lägenhetsutdrag. Om dokumentation begärs, triggas "Request lägenhetsutdrag" boundary event</li>
        <li><strong>Object approved? (gateway):</strong> En beslutspunkt avgör om objektet är godkänt. Om "No", avslutas processen med error event</li>
        <li><strong>Needs valuation? (gateway):</strong> En beslutspunkt avgör om objektvärdering behövs. Om "Yes", fastställs objektets värde</li>
        <li><strong>Stakeholder review? (gateway):</strong> En beslutspunkt avgör om stakeholder ska granska ändringar. Om "Yes", granskas ändringar</li>
        <li><strong>Changes accepted? (gateway):</strong> En beslutspunkt avgör om ändringar accepteras. Om "No", loopar processen tillbaka</li>
        <li><strong>Avslut:</strong> När alla kontroller är godkända och ändringar accepteras, avslutas processen normalt</li>
      </ol>
      
      <h3>Viktiga beslutspunkter</h3>
      <ul>
        <li><strong>Is bostadsrätt? (gateway):</strong> Avgör om objektet är en bostadsrätt. Om "No", hoppas BRF-kontroll över</li>
        <li><strong>Has updated BRF information? (gateway):</strong> Avgör om BRF-information finns tillgänglig. Om "No", registreras information</li>
        <li><strong>Changes requires rescoring? (gateway):</strong> Avgör om ändringar kräver omvärdering. Om "Yes", krävs automatisk kreditevaluering</li>
        <li><strong>BRF screening result (gateway):</strong> Avgör resultatet av BRF-screening. Kan resultera i avvisning, godkännande, manuell granskning, eller saknad information</li>
        <li><strong>BRF approved? (gateway):</strong> Avgör om BRF godkänns efter manuell granskning. Om "No", avslutas processen med error event</li>
        <li><strong>Object approved? (gateway):</strong> Avgör om objektet är godkänt. Om "No", avslutas processen med error event</li>
        <li><strong>Needs valuation? (gateway):</strong> Avgör om objektvärdering behövs. Om "Yes", fastställs objektets värde</li>
        <li><strong>Stakeholder review? (gateway):</strong> Avgör om stakeholder ska granska ändringar. Om "Yes", granskas ändringar</li>
        <li><strong>Changes accepted? (gateway):</strong> Avgör om ändringar accepteras. Om "No", loopar processen tillbaka</li>
      </ul>
      
      <h3>Loop-mekanismer</h3>
      <ul>
        <li><strong>BRF information missing:</strong> Om BRF-screening indikerar saknad information, loopar processen tillbaka till "Has updated BRF information?" gateway</li>
        <li><strong>Ändringar inte accepterade:</strong> Om stakeholder inte accepterar ändringar, loopar processen tillbaka till början för att hantera nya ändringar</li>
      </ul>
        </div>
      </details>
    </section>
    <section class="doc-section">
      <details>
        <summary>Effekt</summary>
        <div class="section-content">
<p class="muted">Förväntad affärseffekt som uppnås med feature goalet.</p>
      
      <h3>Strukturerad BRF-kontroll och screening</h3>
      <p>Genom automatisk BRF-screening via "BRF screening result" gateway kan systemet snabbt bedöma om en bostadsrättsförening uppfyller krav. För BRF:er som automatiskt godkänns kan processen fortsätta direkt, vilket kan minska handläggningstid med upp till 40-50% jämfört med manuell granskning av alla BRF:er. Endast BRF:er som kräver manuell granskning dirigeras till "Review BRF" user task.</p>
      
      <h3>Automatiserad omvärdering vid ändringar</h3>
      <p>När BRF-information ändras och "Changes requires rescoring?" gateway identifierar att omvärdering krävs, anropas automatiskt "Automatic Credit Evaluation" call activity. Detta säkerställer att kreditevalueringen alltid är uppdaterad med senaste informationen utan manuell intervention, vilket kan minska risken för felaktiga beslut med upp till 30-40%.</p>
      
      <h3>Effektiv dokumenthantering</h3>
      <p>Genom boundary events ("Request lägenhetsutdrag", "Request mäklarvärdering") kan handläggare och värderare begära dokumentation direkt från stakeholder utan att avbryta processen. Stakeholder kan ladda upp dokumentation via "Upload documentation" och "Upload object valuation documentation" user tasks. Detta kan minska antalet processavbrott med upp till 50-60% och förbättra kommunikationen mellan parter.</p>
      
      <h3>Flexibel loop-hantering</h3>
      <p>Processens loop-mekanismer möjliggör att saknad BRF-information och ändringar som inte accepteras av stakeholder hanteras automatiskt utan att processen behöver startas om. Detta kan minska antalet avbrutna processer med upp till 25-35% och förbättra kundupplevelsen.</p>
      
      <h3>Proaktiv felhantering</h3>
      <p>Genom tydliga error events ("BRF rejected", "Object rejected") signaleras omedelbart till Manual Credit Evaluation-processen när objektet inte uppfyller kraven. Detta förhindrar att processen fortsätter med ogiltiga objekt och kan minska handläggningstid för avvisade ansökningar med upp till 60-70%.</p>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>User stories</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska user stories som kan kopplas till feature goalet.</p>
      
      <h3>Handläggarperspektiv</h3>
      <ul>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt screenar BRF-information via "BRF screening result" gateway <strong>så att</strong> jag endast behöver granska BRF:er som kräver manuell bedömning, vilket sparar tid. <em>Acceptanskriterier: Systemet ska automatiskt screena BRF-information mot affärsregler, och endast BRF:er som kräver granskning ska dirigeras till "Review BRF" user task.</em></li>
        <li><strong>Som handläggare</strong> vill jag kunna begära lägenhetsutdrag direkt från stakeholder via "Request lägenhetsutdrag" boundary event på "Control lägenhets-utdrag" user task <strong>så att</strong> jag kan få dokumentation utan att avbryta processen. <em>Acceptanskriterier: Boundary event ska triggas när dokumentation begärs, och stakeholder ska kunna ladda upp dokumentation via "Upload documentation" user task.</em></li>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt omvärderar kredit när BRF-information ändras via "Changes requires rescoring?" gateway och "Automatic Credit Evaluation" call activity <strong>så att</strong> kreditevalueringen alltid är uppdaterad. <em>Acceptanskriterier: Systemet ska identifiera när ändringar kräver omvärdering och automatiskt anropa kreditevaluering.</em></li>
      </ul>
      
      <h3>Värderarperspektiv</h3>
      <ul>
        <li><strong>Som värderare</strong> vill jag kunna begära mäklarvärdering direkt från stakeholder via "Request mäklarvärdering" boundary event på "Determine object value" user task <strong>så att</strong> jag kan få kompletterande information för värderingen. <em>Acceptanskriterier: Boundary event ska triggas när mäklarvärdering begärs, och stakeholder ska kunna ladda upp dokumentation via "Upload object valuation documentation" user task.</em></li>
      </ul>
      
      <h3>Stakeholder-perspektiv</h3>
      <ul>
        <li><strong>Som stakeholder</strong> vill jag kunna granska ändringar som gjorts under processen via "Review changes" user task <strong>så att</strong> jag kan bekräfta att all information är korrekt innan processen avslutas. <em>Acceptanskriterier: "Stakeholder review?" gateway ska korrekt identifiera när granskning behövs, och stakeholder ska kunna acceptera eller avvisa ändringar via "Changes accepted?" gateway.</em></li>
        <li><strong>Som stakeholder</strong> vill jag kunna ladda upp begärd dokumentation (lägenhetsutdrag, mäklarvärdering) via "Upload documentation" och "Upload object valuation documentation" user tasks <strong>så att</strong> processen kan fortsätta utan avbrott. <em>Acceptanskriterier: Boundary events ska korrekt trigga upload-tasks, och stakeholder ska kunna ladda upp dokumentation som sparas i systemet.</em></li>
      </ul>
      
      <h3>Systemperspektiv</h3>
      <ul>
        <li><strong>Som system</strong> vill jag automatiskt avvisa BRF:er som inte uppfyller krav via "BRF screening result" gateway "Rejected" eller "BRF approved" gateway "No" <strong>så att</strong> endast kvalificerade objekt fortsätter i processen. <em>Acceptanskriterier: "BRF rejected" error event ska triggas automatiskt när BRF avvisas, och error code "brf-rejected" ska signalera till Manual Credit Evaluation-processen.</em></li>
        <li><strong>Som system</strong> vill jag automatiskt avvisa objekt som inte godkänns via "Object approved?" gateway "No" <strong>så att</strong> endast godkända objekt fortsätter i processen. <em>Acceptanskriterier: "Object rejected" error event ska triggas automatiskt när objekt avvisas, och error code "object-rejected" ska signalera till Manual Credit Evaluation-processen.</em></li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Acceptanskriterier</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska acceptanskriterier som kan kopplas till feature goalet.</p>
      
      <h3>Objekttyp-kontroll</h3>
      <ul>
        <li>"Is bostadsrätt?" gateway ska korrekt identifiera om objektet är en bostadsrätt. Om "Yes", ska processen fortsätta till BRF-kontroll. Om "No", ska processen hoppa över BRF-kontroll och gå direkt till objektvärdering</li>
      </ul>
      
      <h3>BRF-information och screening</h3>
      <ul>
        <li>"Has updated BRF information?" gateway ska korrekt identifiera om BRF-information finns tillgänglig. Om "No", ska "Register BRF information" user task aktiveras för handläggaren</li>
        <li>"Register BRF information" user task ska spara information i "BRF information database" datastore</li>
        <li>"Object information" call activity ska samla objektinformation (storlek, typ, plats, max lånebelopp, energiklass, etc.) när BRF-information registreras</li>
        <li>"Changes requires rescoring?" gateway ska korrekt identifiera om ändringar kräver omvärdering. Om "Yes", ska "Automatic Credit Evaluation" call activity anropas automatiskt</li>
        <li>"BRF screening result" gateway ska korrekt avgöra resultatet av BRF-screening. Gateway ska ha fyra utgångar: "Rejected", "Accepted", "Review", och "BRF information missing"</li>
        <li>Om "BRF screening result" gateway returnerar "Rejected", ska "BRF rejected" error event (Event_1pqluun) triggas med error code "brf-rejected"</li>
        <li>Om "BRF screening result" gateway returnerar "Review", ska "Review BRF" user task aktiveras för handläggaren</li>
        <li>"BRF approved?" gateway ska korrekt avgöra om BRF godkänns efter manuell granskning. Om "No", ska "BRF rejected" error event (Event_0i6cize) triggas med error code "brf-rejected"</li>
        <li>Om "BRF screening result" gateway returnerar "BRF information missing", ska processen automatiskt loopa tillbaka till "Has updated BRF information?" gateway</li>
      </ul>
      
      <h3>Lägenhetsutdrag-kontroll</h3>
      <ul>
        <li>"Control lägenhets-utdrag" user task ska aktiveras för handläggaren när BRF är godkänd</li>
        <li>"Request lägenhetsutdrag" boundary event (request-lagenhetsutdrag) ska kunna triggas på "Control lägenhets-utdrag" user task för att begära dokumentation från stakeholder</li>
        <li>När "Request lägenhetsutdrag" boundary event triggas, ska "Upload documentation" user task aktiveras för stakeholder</li>
        <li>"Object approved?" gateway ska korrekt avgöra om objektet är godkänt. Om "No", ska "Object rejected" error event (Event_1yyhlmr) triggas med error code "object-rejected"</li>
      </ul>
      
      <h3>Objektvärdering</h3>
      <ul>
        <li>"Needs valuation?" gateway ska korrekt identifiera om objektvärdering behövs. Om "Yes", ska "Determine object value" user task aktiveras för värderaren</li>
        <li>"Request mäklarvärdering" boundary event (request-maklarvardering) ska kunna triggas på "Determine object value" user task för att begära mäklarvärdering från stakeholder</li>
        <li>När "Request mäklarvärdering" boundary event triggas, ska "Upload object valuation documentation" user task aktiveras för stakeholder</li>
      </ul>
      
      <h3>Stakeholder-granskning och avslut</h3>
      <ul>
        <li>"Stakeholder review?" gateway ska korrekt identifiera om stakeholder ska granska ändringar. Om "Yes", ska "Review changes" user task aktiveras för stakeholder</li>
        <li>"Changes accepted?" gateway ska korrekt avgöra om ändringar accepteras. Om "Yes", ska processen avslutas normalt. Om "No", ska processen automatiskt loopa tillbaka till början via Gateway_0e24xxh för att hantera nya ändringar</li>
      </ul>
      
      <h3>Felhantering</h3>
      <ul>
        <li>Om "BRF screening result" gateway returnerar "Rejected", ska "BRF rejected" error event (Event_1pqluun) triggas med error code "brf-rejected", vilket signalerar till Manual Credit Evaluation-processen att BRF har avvisats</li>
        <li>Om "BRF approved?" gateway returnerar "No", ska "BRF rejected" error event (Event_0i6cize) triggas med error code "brf-rejected", vilket signalerar till Manual Credit Evaluation-processen att BRF har avvisats</li>
        <li>Om "Object approved?" gateway returnerar "No", ska "Object rejected" error event (Event_1yyhlmr) triggas med error code "object-rejected", vilket signalerar till Manual Credit Evaluation-processen att objektet har avvisats</li>
        <li>Alla error events ska korrekt trigga motsvarande boundary events i Manual Credit Evaluation-processen för att säkerställa att hela processen avbryts när objektet avvisas</li>
      </ul>
      
      <h3>Processvariabler och data</h3>
      <ul>
        <li>Alla processvariabler ska skickas med när Object Control anropas från Manual Credit Evaluation-processen för att säkerställa fullständig kontext</li>
        <li>BRF-information som registreras via "Register BRF information" user task ska korrekt sparas i "BRF information database" datastore</li>
        <li>Resultat från "Object information" call activity ska korrekt sparas och användas i efterföljande gateways</li>
        <li>Resultat från "Automatic Credit Evaluation" call activity (om anropad) ska korrekt sparas och användas i efterföljande gateways</li>
        <li>Dokumentation som laddas upp via "Upload documentation" och "Upload object valuation documentation" user tasks ska korrekt sparas i systemet</li>
      </ul>

      <h3>Tekniska krav</h3>
      <ul>
        <li><strong>Timeout:</strong> User tasks ska ha timeout på 7 dagar för handläggare, 14 dagar för stakeholder, 5 dagar för värderare. Call activities ("Object information", "Automatic Credit Evaluation") ska ha timeout på 60 sekunder</li>
        <li><strong>Retry:</strong> Call activities ska ha automatisk retry med exponential backoff (max 3 försök) vid tekniska fel</li>
        <li><strong>Error codes:</strong> Systemet ska returnera specifika error codes: BRF_REJECTED (för avvisad BRF), OBJECT_REJECTED (för avvisat objekt), OBJECT_CONTROL_TIMEOUT (för timeout), OBJECT_CONTROL_DATA_MISSING (för saknad data)</li>
        <li><strong>Logging:</strong> Alla gateways, user tasks och error events ska loggas med tidsstämplar, användar-ID och resultat för spårbarhet</li>
      </ul>

      <h3>UI/UX-krav</h3>
      <ul>
        <li><strong>Handläggarvyer:</strong> User tasks ska visa tydlig, strukturerad information om objekt, BRF, lägenhetsutdrag och värdering med separata sektioner för varje typ av information</li>
        <li><strong>Boundary events:</strong> Boundary events ("Request lägenhetsutdrag", "Request mäklarvärdering") ska vara tydligt synliga och lättåtkomliga för handläggare och värderare</li>
        <li><strong>Statusindikatorer:</strong> Systemet ska visa tydlig status för varje steg i processen (BRF-kontroll, lägenhetsutdrag, objektvärdering, stakeholder-granskning) med visuella indikatorer</li>
        <li><strong>Loop-indikatorer:</strong> När processen loopar tillbaka via Gateway_0e24xxh, ska systemet visa tydligt varför loopen skedde och vilka ändringar som gjorts</li>
      </ul>

      <h3>Skalbarhet och prestanda</h3>
      <ul>
        <li><strong>Parallellisering:</strong> Systemet ska kunna hantera flera Object Control-processer parallellt utan prestandaförsämring</li>
        <li><strong>Load balancing:</strong> Call activities ska kunna hantera minst 30 anrop per minut med genomsnittlig svarstid under 5 sekunder</li>
        <li><strong>Databasoptimering:</strong> Alla databasfrågor för BRF-information och objektdata ska vara optimerade med indexering</li>
      </ul>

      <h3>Säkerhet och compliance</h3>
      <ul>
        <li><strong>Dataskydd:</strong> All känslig objektinformation och BRF-data ska krypteras i vila och under överföring (TLS 1.3). Åtkomst till objektdata ska loggas för audit trail</li>
        <li><strong>GDPR-efterlevnad:</strong> Alla objektkontroller ska innehålla spårbarhet för vem som genomförde kontrollen, när och resultatet, för att uppfylla GDPR-krav</li>
        <li><strong>Audit trail:</strong> Alla ändringar i objektstatus, BRF-godkännande och värdering ska loggas med användar-ID, tidsstämplar och ändringsorsak för fullständig spårbarhet</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Testgenerering</summary>
        <div class="section-content">
<p class="muted">Detaljerad testgenerering för att säkerställa att feature goalet fungerar korrekt.</p>
      
      <h3>UI Flow per Scenario</h3>
      <ul>
        <li><strong>Scenario 1: Småhus (ingen BRF-kontroll) - lyckad</strong>
          <ol>
            <li>Systemet startar Object Control-processen via "Object control" call activity</li>
            <li>"Is bostadsrätt?" gateway identifierar objektet som småhus (No)</li>
            <li>Processen hoppar över BRF-kontroll och går direkt till "Needs valuation?" gateway</li>
            <li>"Needs valuation?" gateway returnerar "Yes"</li>
            <li>Värderare får "Determine object value" user task</li>
            <li>Värderare fastställer objektets värde</li>
            <li>"Stakeholder review?" gateway returnerar "No"</li>
            <li>Processen avslutas normalt</li>
          </ol>
        </li>
        <li><strong>Scenario 2: Bostadsrätt med BRF-kontroll - lyckad</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>"Is bostadsrätt?" gateway identifierar objektet som bostadsrätt (Yes)</li>
            <li>"Has updated BRF information?" gateway returnerar "No"</li>
            <li>Handläggare får "Register BRF information" user task</li>
            <li>Handläggare registrerar BRF-information</li>
            <li>"BRF screening result" gateway returnerar "Accepted"</li>
            <li>"Control lägenhets-utdrag" user task aktiveras</li>
            <li>Handläggare kontrollerar lägenhetsutdrag</li>
            <li>"Object approved?" gateway returnerar "Yes"</li>
            <li>"Needs valuation?" gateway returnerar "Yes"</li>
            <li>Värderare fastställer objektets värde</li>
            <li>"Stakeholder review?" gateway returnerar "Yes"</li>
            <li>Stakeholder granskar ändringar och accepterar</li>
            <li>Processen avslutas normalt</li>
          </ol>
        </li>
        <li><strong>Scenario 3: BRF avvisad</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>"Is bostadsrätt?" gateway identifierar objektet som bostadsrätt</li>
            <li>"BRF screening result" gateway returnerar "Rejected"</li>
            <li>"BRF rejected" error event (Event_1pqluun) triggas med error code "brf-rejected"</li>
            <li>Error event signalerar till Manual Credit Evaluation-processen</li>
            <li>Processen avbryts</li>
          </ol>
        </li>
        <li><strong>Scenario 4: Objekt avvisat</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>BRF-kontroll genomförs och godkänns</li>
            <li>"Control lägenhets-utdrag" user task aktiveras</li>
            <li>Handläggare kontrollerar lägenhetsutdrag</li>
            <li>"Object approved?" gateway returnerar "No"</li>
            <li>"Object rejected" error event (Event_1yyhlmr) triggas med error code "object-rejected"</li>
            <li>Error event signalerar till Manual Credit Evaluation-processen</li>
            <li>Processen avbryts</li>
          </ol>
        </li>
        <li><strong>Scenario 5: Begäran om lägenhetsutdrag (boundary event)</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>BRF-kontroll genomförs och godkänns</li>
            <li>"Control lägenhets-utdrag" user task aktiveras</li>
            <li>Handläggare triggar "Request lägenhetsutdrag" boundary event</li>
            <li>"Upload documentation" user task aktiveras för stakeholder</li>
            <li>Stakeholder laddar upp lägenhetsutdrag</li>
            <li>Handläggare fortsätter kontrollen</li>
            <li>Processen fortsätter normalt</li>
          </ol>
        </li>
        <li><strong>Scenario 6: Begäran om mäklarvärdering (boundary event)</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>"Needs valuation?" gateway returnerar "Yes"</li>
            <li>"Determine object value" user task aktiveras för värderare</li>
            <li>Värderare triggar "Request mäklarvärdering" boundary event</li>
            <li>"Upload object valuation documentation" user task aktiveras för stakeholder</li>
            <li>Stakeholder laddar upp mäklarvärdering</li>
            <li>Värderare fortsätter värderingen</li>
            <li>Processen fortsätter normalt</li>
          </ol>
        </li>
        <li><strong>Scenario 7: Ändringar kräver omvärdering</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>"Changes requires rescoring?" gateway returnerar "Yes"</li>
            <li>"Automatic Credit Evaluation" call activity anropas</li>
            <li>Automatic Credit Evaluation-processen genomförs</li>
            <li>Resultatet returneras till Object Control</li>
            <li>Processen fortsätter normalt</li>
          </ol>
        </li>
        <li><strong>Scenario 8: Stakeholder avvisar ändringar (loop)</strong>
          <ol>
            <li>Systemet startar Object Control-processen</li>
            <li>Alla kontroller genomförs framgångsrikt</li>
            <li>"Stakeholder review?" gateway returnerar "Yes"</li>
            <li>"Review changes" user task aktiveras för stakeholder</li>
            <li>Stakeholder granskar ändringar</li>
            <li>"Changes accepted?" gateway returnerar "No"</li>
            <li>Processen loopar tillbaka till början via Gateway_0e24xxh</li>
            <li>Processen startar om med nya ändringar</li>
          </ol>
        </li>
      </ul>

      <h3>Testdata-referenser</h3>
      <ul>
        <li><strong>Småhus-objekt:</strong> Objekttyp = "småhus", objekt-ID = "OBJ-001". Förväntat resultat: BRF-kontroll hoppas över, värdering genomförs, processen avslutas normalt</li>
        <li><strong>Bostadsrätt med godkänd BRF:</strong> Objekttyp = "bostadsrätt", BRF-ID = "BRF-001", BRF-status = "godkänd". Förväntat resultat: BRF-kontroll genomförs, lägenhetsutdrag kontrolleras, värdering genomförs, processen avslutas normalt</li>
        <li><strong>Bostadsrätt med avvisad BRF:</strong> Objekttyp = "bostadsrätt", BRF-ID = "BRF-002", BRF-status = "avvisad". Förväntat resultat: "BRF rejected" error event triggas, processen avbryts</li>
        <li><strong>Objekt som avvisas:</strong> Objekt-ID = "OBJ-003", lägenhetsutdrag = "ofullständig". Förväntat resultat: "Object rejected" error event triggas, processen avbryts</li>
        <li><strong>Ändringar kräver omvärdering:</strong> Objekt-ID = "OBJ-004", ändringar = "storlek ändrad". Förväntat resultat: "Automatic Credit Evaluation" call activity anropas</li>
        <li><strong>Stakeholder avvisar ändringar:</strong> Objekt-ID = "OBJ-005", stakeholder-beslut = "avvisa". Förväntat resultat: Processen loopar tillbaka till början</li>
      </ul>

      <h3>Implementation Mapping</h3>
      <ul>
        <li><strong>Routes:</strong>
          <ul>
            <li><code>/api/object-control/check-brf</code> - "Is bostadsrätt?" gateway och BRF-kontroll</li>
            <li><code>/api/object-control/register-brf</code> - "Register BRF information" user task</li>
            <li><code>/api/object-control/screen-brf</code> - "BRF screening result" gateway</li>
            <li><code>/api/object-control/control-apartment-extract</code> - "Control lägenhets-utdrag" user task</li>
            <li><code>/api/object-control/determine-value</code> - "Determine object value" user task</li>
            <li><code>/api/object-control/review-changes</code> - "Review changes" user task</li>
            <li><code>/api/object-control/request-documentation</code> - "Request lägenhetsutdrag" boundary event</li>
            <li><code>/api/object-control/request-valuation</code> - "Request mäklarvärdering" boundary event</li>
          </ul>
        </li>
        <li><strong>Endpoints:</strong>
          <ul>
            <li><code>GET /api/object-control/check-brf</code> - Kontrollera om objekt är bostadsrätt och om BRF-kontroll behövs</li>
            <li><code>POST /api/object-control/register-brf</code> - Registrera BRF-information, returnerar registrerad information</li>
            <li><code>POST /api/object-control/screen-brf</code> - Screena BRF-information, returnerar screening-resultat</li>
            <li><code>GET /api/object-control/control-apartment-extract</code> - Hämta lägenhetsutdrag för kontroll</li>
            <li><code>POST /api/object-control/control-apartment-extract</code> - Spara kontrollresultat för lägenhetsutdrag</li>
            <li><code>GET /api/object-control/determine-value</code> - Hämta objektinformation för värdering</li>
            <li><code>POST /api/object-control/determine-value</code> - Spara värderingsresultat</li>
            <li><code>GET /api/object-control/review-changes</code> - Hämta ändringar för granskning</li>
            <li><code>POST /api/object-control/review-changes</code> - Spara granskningsresultat (acceptera/avvisa)</li>
            <li><code>POST /api/object-control/request-documentation</code> - Begära lägenhetsutdrag från stakeholder</li>
            <li><code>POST /api/object-control/request-valuation</code> - Begära mäklarvärdering från stakeholder</li>
          </ul>
        </li>
        <li><strong>Datastores:</strong>
          <ul>
            <li><code>brf_information_database</code> - Lagrar BRF-information som registreras av handläggaren</li>
            <li><code>object_control_results</code> - Lagrar objektkontrollresultat med objekt-ID, BRF-status, värdering och tidsstämplar</li>
            <li><code>object_control_audit</code> - Lagrar audit trail för alla objektkontroller med användar-ID, tidsstämplar och ändringsorsak</li>
            <li><code>documentation_storage</code> - Lagrar dokumentation (lägenhetsutdrag, mäklarvärdering) som laddas upp av stakeholder</li>
          </ul>
        </li>
      </ul>
        </div>
      </details>
    </section>
      </body>
</html>