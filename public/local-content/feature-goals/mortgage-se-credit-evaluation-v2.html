<!DOCTYPE html>
<html lang="sv">
<head>
  <meta name="x-generation-source" content="local-fallback" />
  <meta name="x-feature-goal-template-version" content="v2" />
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Automatic Credit Evaluation</title>
  <style>
    :root {
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --accent: #e0e7ff;
      --bg-light: #f8f9fa;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 24px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin: 0 0 32px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 12px;
      color: var(--text-strong);
    }
    h2 {
      color: var(--primary);
      margin: 0;
      font-size: 1.5rem;
    }
    h3 {
      color: var(--text-strong);
      margin: 32px 0 12px;
      font-size: 1.2rem;
    }
    p { margin: 0 0 12px; }
    ul {
      padding-left: 24px;
      margin: 0 0 16px;
    }
    li { margin-bottom: 8px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 12px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted {
      color: var(--text-muted);
      font-size: 0.9rem;
      font-style: italic;
    }
    .card {
      background: var(--bg-light);
      padding: 20px;
      border-radius: 8px;
      margin: 16px 0;
      border-left: 4px solid var(--primary);
    }
    .doc-section {
      margin-bottom: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .doc-section details {
      margin: 0;
    }
    .doc-section details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 16px 20px;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border);
      user-select: none;
      font-size: 1.5rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .doc-section details summary::-webkit-details-marker {
      display: none;
    }
    .doc-section details summary::before {
      content: '‚ñ∂';
      display: inline-block;
      transition: transform 0.2s;
      font-size: 0.8rem;
      color: var(--primary);
    }
    .doc-section details[open] summary::before {
      transform: rotate(90deg);
    }
    .doc-section details summary:hover {
      background: var(--accent);
    }
    .doc-section details .section-content {
      padding: 20px;
    }
    .doc-section details[open] summary {
      border-bottom: 1px solid var(--border);
    }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .local-version-badge {
      background: #e0f2fe;
      color: #0369a1;
      padding: 8px 16px;
      margin: 16px 0;
      border-radius: 6px;
      border-left: 4px solid #0284c7;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    details {
      margin: 16px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 12px;
      background: var(--bg-light);
      border: 1px solid var(--border);
      border-radius: 6px;
      user-select: none;
    }
    details summary:hover {
      background: var(--accent);
    }
    details[open] summary {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
    details .collapsible-content {
      padding: 16px;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 6px 6px;
      margin-top: 0;
    }
    img {
      max-width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin: 12px 0;
    }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
</style>
</head>
<body>
  <div class="local-version-badge" style="background: #e0f2fe; color: #0369a1; padding: 8px 16px; margin: 16px; border-radius: 6px; border-left: 4px solid #0284c7; font-size: 0.9rem; font-weight: 500;">
      üìÑ Lokal version ‚Äì F√∂rb√§ttrat inneh√•ll
    </div>
  
    
      


    
    <section class="doc-section">
      <details open>
        <summary>Beskrivning av FGoal</summary>
        <div class="section-content">
<p>Automatic Credit Evaluation √§r en process som [TODO: L√§gg till beskrivning baserat p√• BPMN-filen].</p>
        </div>
      </details>
    </section>
<section class="doc-section">
      <details>
        <summary>Processteg - Input</summary>
        <div class="section-content">
<ul>
        <li>Kreditomv√§rdering har triggrats via boundary event "Credit reevaluation required" fr√•n Documentation assessment</li>
        <li>Uppdaterad dokumentation √§r tillg√§nglig</li>
        <li>Ans√∂kningsdata √§r redo f√∂r ny automatisk utv√§rdering</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Processteg - Output</summary>
        <div class="section-content">
<ul>
        <li>Komplett automatisk kreditevaluering med uppdaterade data</li>
        <li>Beslut om ans√∂kan ska avvisas automatiskt (rejected gateway)</li>
        <li>Resultatet fl√∂dar tillbaka till Manual Credit Evaluation-processen f√∂r vidare hantering</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Omfattning</summary>
        <div class="section-content">
<ul>
        <li>H√§mtning av produktinformation och priss√§ttning</li>
        <li>Amortisationsber√§kning</li>
        <li>Multi-instance bearbetning av alla hush√•ll i ans√∂kan (affordability-ber√§kningar)</li>
        <li>Riskklassificering</li>
        <li>Policyutv√§rdering mot aff√§rsregler</li>
        <li>Automatiskt avvisningsbeslut om ans√∂kan inte uppfyller kriterier</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Avgr√§nsning</summary>
        <div class="section-content">
<ul>
        <li>Manuell granskning och advanced underwriting sker i Manual Credit Evaluation-processen, inte h√§r</li>
        <li>Objektv√§rdering hanteras separat i Manual Credit Evaluation</li>
        <li>Dokumentationshantering sker i Documentation assessment, inte i denna subprocess</li>
        <li>Denna subprocess fokuserar enbart p√• automatisk utv√§rdering, inte p√• manuella √•tg√§rder</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Beroenden</summary>
        <div class="section-content">
<ul>
        <li><strong>KALP-system:</strong> Ber√§knar hush√•llsaffordability</li>
        <li><strong>Pricing engine:</strong> H√§mtar produkt- och priss√§ttningsdata</li>
        <li><strong>Aff√§rsregelmotor (DMN):</strong> Utv√§rderar mot policykriterier och aff√§rsregler</li>
        <li><strong>Riskklassificeringssystem:</strong> Klassificerar riskniv√• baserat p√• utv√§rderingsresultat</li>
        <li><strong>Kunddata och engagemangsdata:</strong> F√∂r hush√•llsbehandling och affordability-ber√§kningar</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>BPMN - Process</summary>
        <div class="section-content">
<p><a href="#/bpmn/mortgage-se-credit-evaluation.bpmn">Visa BPMN-processen f√∂r Automatic Credit Evaluation</a></p>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Testgenerering</summary>
        <div class="section-content">
<p class="muted">Information f√∂r att generera automatiserade tester. Delar kan auto-genereras fr√•n processbeskrivningen, men kompletteras manuellt med implementation-specifik information (routes, locators, testdata).</p>

      <h3>Testscenarier</h3>
      <table>
        <thead>
          <tr>
            <th>ID</th>
            <th>Namn</th>
            <th>Typ</th>
            <th>Persona</th>
            <th>Risk Level</th>
            <th>Assertion Type</th>
            <th>Outcome</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody>
          
      <tr>
        <td><strong>S1</strong></td>
        <td>Normalfl√∂de ‚Äì ans√∂kan godk√§nd automatiskt</td>
        <td>Happy</td>
        <td>system</td>
        <td>P0</td>
        <td>functional</td>
        <td>Komplett automatisk kreditevaluering: produkt och pris h√§mtade, amortisation ber√§knad, hush√•llsaffordability OK, riskklassificering l√•g, ans√∂kan och kreditpolicyer godk√§nda. Processen avslutas och resultatet fl√∂dar tillbaka till Manual Credit Evaluation.</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S2</strong></td>
        <td>Ans√∂kan avvisad ‚Äì hush√•llsaffordability otillr√§cklig</td>
        <td>Error</td>
        <td>system</td>
        <td>P0</td>
        <td>functional</td>
        <td>Hush√•llsaffordability √§r otillr√§cklig (h√∂g skulds√§ttning, l√•g inkomst). Evaluate household avvisar. Rejected gateway triggas och processen avslutas med avslag. Resultatet fl√∂dar tillbaka till Manual Credit Evaluation.</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S3</strong></td>
        <td>Ans√∂kan avvisad ‚Äì kreditpolicyer inte uppfyllda</td>
        <td>Error</td>
        <td>system</td>
        <td>P0</td>
        <td>functional</td>
        <td>Hush√•llsaffordability OK, men Evaluate credit policies avvisar (t.ex. f√∂r h√∂g LTV, otillr√§cklig s√§kerhet, eller policy√∂vertr√§delse). Rejected gateway triggas och processen avslutas med avslag.</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S4</strong></td>
        <td>Multi-instance ‚Äì flera hush√•ll i ans√∂kan</td>
        <td>Happy</td>
        <td>system</td>
        <td>P1</td>
        <td>functional</td>
        <td>Ans√∂kan inneh√•ller flera hush√•ll (multi-instance loop). Varje hush√•ll genomg√•r Calculate household affordability och Evaluate household. Alla hush√•ll godk√§nns. Processen forts√§tter med riskklassificering och policyutv√§rdering. Ans√∂kan godk√§nns.</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S5</strong></td>
        <td>H√∂g riskklassificering ‚Äì ans√∂kan godk√§nd √§nd√•</td>
        <td>Edge</td>
        <td>system</td>
        <td>P1</td>
        <td>functional</td>
        <td>Riskklassificering √§r h√∂g, men hush√•llsaffordability och kreditpolicyer √§r √§nd√• OK. Evaluate application och Evaluate credit policies godk√§nner trots h√∂g risk. Processen avslutas med godk√§nnande (kan kr√§va manuell granskning i Manual Credit Evaluation).</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
      <tr>
        <td><strong>S6</strong></td>
        <td>Pris- eller produktdata saknas ‚Äì felhantering</td>
        <td>Error</td>
        <td>system</td>
        <td>P1</td>
        <td>functional</td>
        <td>Fetch product eller Fetch price misslyckas (t.ex. produkt inte tillg√§nglig, eller priss√§ttning saknas). Systemet hanterar felet gracefully och processen kan antingen avvisas eller kr√§va manuell hantering.</td>
        <td>‚úÖ Planerad</td>
      </tr>
    
        </tbody>
      </table>

      <h3>UI Flow per Scenario</h3>
      <p class="muted">Detaljerade steg f√∂r varje scenario. Expandera f√∂r att se UI Flow.</p>
      
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S1: Normalfl√∂de ‚Äì ans√∂kan godk√§nd automatiskt</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1</td>
          <td>credit-evaluation-start</td>
          <td>verify</td>
          <td>process-started</td>
          <td>application-approved</td>
          <td>Processen startar automatiskt n√§r anropas fr√•n Manual Credit Evaluation (eller fr√•n huvudprocessen). Verifiera att processen √§r initierad.</td>
        </tr>
      
        <tr>
          <td>2</td>
          <td>fetch-product</td>
          <td>verify</td>
          <td>api-product-fetched</td>
          <td>application-approved</td>
          <td>Fetch product business rule task k√∂rs automatiskt. Verifiera att produktinformation h√§mtas (t.ex. bol√•neprodukt, r√§ntetyp, villkor).</td>
        </tr>
      
        <tr>
          <td>3</td>
          <td>fetch-price</td>
          <td>verify</td>
          <td>api-price-fetched</td>
          <td>application-approved</td>
          <td>Fetch price service task k√∂rs automatiskt fr√•n Pricing engine. Verifiera att priss√§ttning h√§mtas (r√§nta, avgifter).</td>
        </tr>
      
        <tr>
          <td>4</td>
          <td>evaluate-amortisation</td>
          <td>verify</td>
          <td>dmn-amortisation-calculated</td>
          <td>application-approved</td>
          <td>Amortisation business rule task ber√§knar amorteringsplan. Verifiera att amortering ber√§knas korrekt baserat p√• produkt, pris och l√•nebelopp.</td>
        </tr>
      
        <tr>
          <td>5</td>
          <td>loop-household</td>
          <td>verify</td>
          <td>multi-instance-household-started</td>
          <td>application-approved</td>
          <td>For each household subprocess startar (multi-instance loop). Verifiera att loop startar f√∂r varje hush√•ll i ans√∂kan.</td>
        </tr>
      
        <tr>
          <td>6</td>
          <td>calculate-household-affordability</td>
          <td>verify</td>
          <td>api-kalp-affordability-calculated</td>
          <td>application-approved</td>
          <td>Calculate household affordability service task k√∂rs per hush√•ll via KALP-system. Verifiera att affordability ber√§knas (inkomster, utgifter, skulds√§ttning, tillg√•ngar).</td>
        </tr>
      
        <tr>
          <td>7</td>
          <td>evaluate-household</td>
          <td>verify</td>
          <td>dmn-household-approved</td>
          <td>application-approved</td>
          <td>Evaluate household business rule task utv√§rderar affordability mot policykriterier. Verifiera att hush√•ll godk√§nns (tillr√§cklig affordability, OK skulds√§ttning).</td>
        </tr>
      
        <tr>
          <td>8</td>
          <td>evaluate-stakeholders</td>
          <td>verify</td>
          <td>dmn-stakeholders-approved</td>
          <td>application-approved</td>
          <td>Evaluate stakeholders business rule task utv√§rderar stakeholders per hush√•ll. Verifiera att stakeholders godk√§nns.</td>
        </tr>
      
        <tr>
          <td>9</td>
          <td>loop-household</td>
          <td>verify</td>
          <td>multi-instance-household-completed</td>
          <td>application-approved</td>
          <td>Verifiera att alla hush√•ll i multi-instance loop √§r bearbetade och godk√§nda.</td>
        </tr>
      
        <tr>
          <td>10</td>
          <td>fetch-risk-classification</td>
          <td>verify</td>
          <td>api-risk-classification-fetched</td>
          <td>application-approved</td>
          <td>Fetch risk classification service task h√§mtar riskklassificering fr√•n risk engine. Verifiera att riskklassificering √§r l√•g eller medel.</td>
        </tr>
      
        <tr>
          <td>11</td>
          <td>evaluate-application</td>
          <td>verify</td>
          <td>dmn-application-approved</td>
          <td>application-approved</td>
          <td>Evaluate application business rule task utv√§rderar hela ans√∂kan. Verifiera att ans√∂kan godk√§nns baserat p√• riskklassificering, affordability och stakeholders.</td>
        </tr>
      
        <tr>
          <td>12</td>
          <td>evaluate-credit-policies</td>
          <td>verify</td>
          <td>dmn-credit-policies-approved</td>
          <td>application-approved</td>
          <td>Evaluate credit policies business rule task utv√§rderar mot alla kreditpolicyer och aff√§rsregler. Verifiera att alla policyer uppfylls (LTV, s√§kerhet, l√•nevillkor).</td>
        </tr>
      
        <tr>
          <td>13</td>
          <td>credit-evaluation-completed</td>
          <td>verify</td>
          <td>process-end-approved</td>
          <td>application-approved</td>
          <td>Verifiera att processen avslutas med godk√§nnande. Resultatet fl√∂dar tillbaka till Manual Credit Evaluation (eller huvudprocessen) f√∂r vidare hantering.</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S2: Ans√∂kan avvisad ‚Äì hush√•llsaffordability otillr√§cklig</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1-4</td>
          <td>credit-evaluation-start till evaluate-amortisation</td>
          <td>verify</td>
          <td>process-started, api-product-fetched, api-price-fetched, dmn-amortisation-calculated</td>
          <td>application-rejected-affordability</td>
          <td>Samma som S1 steg 1-4: Processen startar, produkt och pris h√§mtas, amortering ber√§knas</td>
        </tr>
      
        <tr>
          <td>5-6</td>
          <td>loop-household, calculate-household-affordability</td>
          <td>verify</td>
          <td>multi-instance-household-started, api-kalp-affordability-calculated</td>
          <td>application-rejected-affordability</td>
          <td>Household loop startar, affordability ber√§knas (med otillr√§cklig inkomst eller f√∂r h√∂g skulds√§ttning)</td>
        </tr>
      
        <tr>
          <td>7</td>
          <td>evaluate-household</td>
          <td>verify</td>
          <td>dmn-household-rejected</td>
          <td>application-rejected-affordability</td>
          <td>Evaluate household business rule task avvisar hush√•llet (otillr√§cklig affordability, f√∂r h√∂g skulds√§ttning, eller policy√∂vertr√§delse).</td>
        </tr>
      
        <tr>
          <td>8</td>
          <td>rejected-gateway</td>
          <td>verify</td>
          <td>gateway-rejected-triggered</td>
          <td>application-rejected-affordability</td>
          <td>Rejected gateway triggas n√§r hush√•ll avvisas. Processen avslutas med avslag.</td>
        </tr>
      
        <tr>
          <td>9</td>
          <td>credit-evaluation-rejected</td>
          <td>verify</td>
          <td>process-end-rejected</td>
          <td>application-rejected-affordability</td>
          <td>Verifiera att processen avslutas med avslag. Resultatet fl√∂dar tillbaka till Manual Credit Evaluation med avslagsorsak.</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S3: Ans√∂kan avvisad ‚Äì kreditpolicyer inte uppfyllda</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1-11</td>
          <td>credit-evaluation-start till evaluate-application</td>
          <td>verify</td>
          <td>process-started, api-product-fetched, api-price-fetched, dmn-amortisation-calculated, api-kalp-affordability-calculated, dmn-household-approved, api-risk-classification-fetched, dmn-application-approved</td>
          <td>application-rejected-policy</td>
          <td>Samma som S1 steg 1-11: Processen startar, produkt/pris/amortering OK, hush√•llsaffordability OK, riskklassificering OK, ans√∂kan godk√§nd</td>
        </tr>
      
        <tr>
          <td>12</td>
          <td>evaluate-credit-policies</td>
          <td>verify</td>
          <td>dmn-credit-policies-rejected</td>
          <td>application-rejected-policy</td>
          <td>Evaluate credit policies business rule task avvisar (t.ex. f√∂r h√∂g LTV &gt;85%, otillr√§cklig s√§kerhet, eller policy√∂vertr√§delse).</td>
        </tr>
      
        <tr>
          <td>13</td>
          <td>rejected-gateway</td>
          <td>verify</td>
          <td>gateway-rejected-triggered</td>
          <td>application-rejected-policy</td>
          <td>Rejected gateway triggas n√§r kreditpolicyer inte uppfylls. Processen avslutas med avslag.</td>
        </tr>
      
        <tr>
          <td>14</td>
          <td>credit-evaluation-rejected</td>
          <td>verify</td>
          <td>process-end-rejected</td>
          <td>application-rejected-policy</td>
          <td>Verifiera att processen avslutas med avslag. Resultatet fl√∂dar tillbaka med avslagsorsak (policy√∂vertr√§delse).</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S4: Multi-instance ‚Äì flera hush√•ll i ans√∂kan</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1-4</td>
          <td>credit-evaluation-start till evaluate-amortisation</td>
          <td>verify</td>
          <td>process-started, api-product-fetched, api-price-fetched, dmn-amortisation-calculated</td>
          <td>application-multi-household</td>
          <td>Samma som S1 steg 1-4: Processen startar, produkt/pris/amortering OK</td>
        </tr>
      
        <tr>
          <td>5</td>
          <td>loop-household</td>
          <td>verify</td>
          <td>multi-instance-household-started</td>
          <td>application-multi-household</td>
          <td>For each household subprocess startar f√∂r flera hush√•ll (multi-instance loop)</td>
        </tr>
      
        <tr>
          <td>6-8</td>
          <td>calculate-household-affordability till evaluate-stakeholders</td>
          <td>verify</td>
          <td>api-kalp-affordability-calculated, dmn-household-approved, dmn-stakeholders-approved</td>
          <td>application-multi-household</td>
          <td>F√∂rsta hush√•llet: affordability ber√§knas, hush√•ll och stakeholders godk√§nns</td>
        </tr>
      
        <tr>
          <td>9</td>
          <td>loop-household</td>
          <td>verify</td>
          <td>multi-instance-continue</td>
          <td>application-multi-household</td>
          <td>Multi-instance loop forts√§tter till n√§sta hush√•ll</td>
        </tr>
      
        <tr>
          <td>10-12</td>
          <td>calculate-household-affordability till evaluate-stakeholders</td>
          <td>verify</td>
          <td>api-kalp-affordability-calculated, dmn-household-approved, dmn-stakeholders-approved</td>
          <td>application-multi-household</td>
          <td>Andra hush√•llet: affordability ber√§knas, hush√•ll och stakeholders godk√§nns</td>
        </tr>
      
        <tr>
          <td>13</td>
          <td>loop-household</td>
          <td>verify</td>
          <td>multi-instance-all-completed</td>
          <td>application-multi-household</td>
          <td>Verifiera att alla hush√•ll i multi-instance loop √§r bearbetade och godk√§nda</td>
        </tr>
      
        <tr>
          <td>14-17</td>
          <td>fetch-risk-classification till credit-evaluation-completed</td>
          <td>verify</td>
          <td>api-risk-classification-fetched, dmn-application-approved, dmn-credit-policies-approved, process-end-approved</td>
          <td>application-multi-household</td>
          <td>Forts√§tt med riskklassificering, ans√∂kan och kreditpolicyer (samma som S1 steg 10-13)</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S5: H√∂g riskklassificering ‚Äì ans√∂kan godk√§nd √§nd√•</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1-9</td>
          <td>credit-evaluation-start till loop-household</td>
          <td>verify</td>
          <td>process-started, api-product-fetched, api-price-fetched, dmn-amortisation-calculated, api-kalp-affordability-calculated, dmn-household-approved</td>
          <td>application-high-risk-approved</td>
          <td>Samma som S1 steg 1-9: Processen startar, produkt/pris/amortering OK, hush√•llsaffordability OK</td>
        </tr>
      
        <tr>
          <td>10</td>
          <td>fetch-risk-classification</td>
          <td>verify</td>
          <td>api-risk-classification-fetched-high</td>
          <td>application-high-risk-approved</td>
          <td>Fetch risk classification returnerar h√∂g riskklassificering (t.ex. medelh√∂g kreditv√§rdighet, eller komplex ans√∂kan)</td>
        </tr>
      
        <tr>
          <td>11</td>
          <td>evaluate-application</td>
          <td>verify</td>
          <td>dmn-application-approved</td>
          <td>application-high-risk-approved</td>
          <td>Evaluate application godk√§nner √§nd√• trots h√∂g risk (t.ex. tillr√§cklig affordability och s√§kerhet kompenserar f√∂r risk).</td>
        </tr>
      
        <tr>
          <td>12</td>
          <td>evaluate-credit-policies</td>
          <td>verify</td>
          <td>dmn-credit-policies-approved</td>
          <td>application-high-risk-approved</td>
          <td>Evaluate credit policies godk√§nner (alla policyer uppfyllda trots h√∂g risk).</td>
        </tr>
      
        <tr>
          <td>13</td>
          <td>credit-evaluation-completed</td>
          <td>verify</td>
          <td>process-end-approved</td>
          <td>application-high-risk-approved</td>
          <td>Processen avslutas med godk√§nnande trots h√∂g risk. Resultatet fl√∂dar tillbaka (kan kr√§va manuell granskning i Manual Credit Evaluation).</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    
      <details style="margin: 12px 0; padding: 12px; border: 1px solid var(--border); border-radius: 6px;">
        <summary style="cursor: pointer; font-weight: 600; color: var(--primary);">
          <strong>S6: Pris- eller produktdata saknas ‚Äì felhantering</strong> (Klicka f√∂r att expandera)
        </summary>
        <table style="margin-top: 12px;">
          <thead>
            <tr>
              <th>Steg</th>
              <th>Page ID</th>
              <th>Action</th>
              <th>Locator ID</th>
              <th>Data Profile</th>
              <th>Kommentar</th>
            </tr>
          </thead>
          <tbody>
            
        <tr>
          <td>1</td>
          <td>credit-evaluation-start</td>
          <td>verify</td>
          <td>process-started</td>
          <td>application-missing-data</td>
          <td>Processen startar automatiskt</td>
        </tr>
      
        <tr>
          <td>2</td>
          <td>fetch-product</td>
          <td>verify</td>
          <td>api-product-fetched</td>
          <td>application-missing-data</td>
          <td>Fetch product k√∂rs. Verifiera att produktinformation h√§mtas OK.</td>
        </tr>
      
        <tr>
          <td>3</td>
          <td>fetch-price</td>
          <td>verify</td>
          <td>api-price-fetch-failed</td>
          <td>application-missing-data</td>
          <td>Fetch price misslyckas (t.ex. produkt inte tillg√§nglig f√∂r denna kundtyp, eller priss√§ttning saknas f√∂r denna kombination).</td>
        </tr>
      
        <tr>
          <td>4</td>
          <td>error-handling</td>
          <td>verify</td>
          <td>error-price-missing</td>
          <td>application-missing-data</td>
          <td>Systemet hanterar felet gracefully. Processen kan antingen: 1) Avvisas automatiskt, 2) Kr√§va manuell hantering, eller 3) Anv√§nda fallback-priss√§ttning.</td>
        </tr>
      
        <tr>
          <td>5</td>
          <td>credit-evaluation-error</td>
          <td>verify</td>
          <td>process-end-error</td>
          <td>application-missing-data</td>
          <td>Verifiera att processen hanterar felet korrekt och resultatet fl√∂dar tillbaka med felinformation f√∂r vidare hantering.</td>
        </tr>
      
          </tbody>
        </table>
      </details>
    

      <h3>Testdata-referenser</h3>
      <p class="muted">Testdata-profilerna som anv√§nds i scenarion. Definiera faktiska testdata i separat testdata-katalog.</p>
      <ul>
        
      <li><strong>application-approved</strong>: Ans√∂kan som godk√§nns automatiskt - tillr√§cklig hush√•llsaffordability, l√•g riskklassificering, alla kreditpolicyer uppfyllda (LTV &lt;80%, tillr√§cklig s√§kerhet, god kreditv√§rdighet)</li>
    
      <li><strong>application-rejected-affordability</strong>: Ans√∂kan som avvisas p√• grund av otillr√§cklig hush√•llsaffordability - h√∂g skulds√§ttning (&gt;40% DTI), l√•g inkomst, eller otillr√§ckliga tillg√•ngar</li>
    
      <li><strong>application-rejected-policy</strong>: Ans√∂kan som avvisas p√• grund av policy√∂vertr√§delse - f√∂r h√∂g LTV (&gt;85%), otillr√§cklig s√§kerhet, eller l√•nebelopp √∂verskrider policygr√§nser</li>
    
      <li><strong>application-multi-household</strong>: Ans√∂kan med flera hush√•ll (t.ex. huvudans√∂kande + meds√∂kande med separata hush√•ll) - alla hush√•ll har tillr√§cklig affordability, alla godk√§nns</li>
    
      <li><strong>application-high-risk-approved</strong>: Ans√∂kan med h√∂g riskklassificering men √§nd√• godk√§nd - medelh√∂g kreditv√§rdighet, men tillr√§cklig affordability och s√§kerhet kompenserar f√∂r risk</li>
    
      <li><strong>application-missing-data</strong>: Ans√∂kan d√§r produkt- eller priss√§ttningsdata saknas - produkt inte tillg√§nglig f√∂r kundtyp, eller priss√§ttning saknas f√∂r specifik kombination</li>
    
      </ul>

      <h3>Implementation Mapping</h3>
      <p class="muted">Mappning mellan BPMN-aktiviteter och faktisk implementation (routes, endpoints, locators).</p>
      <table>
        <thead>
          <tr>
            <th>BPMN Aktivitet</th>
            <th>Type</th>
            <th>Route/Endpoint</th>
            <th>Method</th>
            <th>Base URL</th>
            <th>Kommentar</th>
          </tr>
        </thead>
        <tbody>
          
      <tr>
        <td>Credit Evaluation (start)</td>
        <td>System</td>
        <td>Internal process trigger</td>
        <td>-</td>
        <td>-</td>
        <td>Processen startar automatiskt n√§r anropas fr√•n Manual Credit Evaluation (eller fr√•n huvudprocessen). Ingen direkt API-endpoint, triggas via BPMN engine.</td>
      </tr>
    
      <tr>
        <td>Fetch product</td>
        <td>API</td>
        <td>/api/credit-evaluation/product</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som h√§mtar produktinformation (bol√•neprodukt, r√§ntetyp, villkor) baserat p√• ans√∂kningsdata. Input: Application ID, Customer Type, Loan Amount. Output: Product Details.</td>
      </tr>
    
      <tr>
        <td>Fetch price</td>
        <td>API</td>
        <td>/api/pricing/calculate</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Service task som h√§mtar priss√§ttning fr√•n Pricing engine. Input: Product ID, Loan Amount, Loan Term, Customer Risk Profile. Output: Interest Rate, Fees, Total Cost.</td>
      </tr>
    
      <tr>
        <td>Evaluate amortisation</td>
        <td>API</td>
        <td>/api/dmn/evaluate-amortisation</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som ber√§knar amorteringsplan baserat p√• produkt, pris och l√•nebelopp. Input: Product, Price, Loan Amount, Loan Term. Output: Amortisation Schedule.</td>
      </tr>
    
      <tr>
        <td>Calculate household affordability</td>
        <td>API</td>
        <td>/api/kalp/calculate-affordability</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Service task som ber√§knar hush√•llsaffordability via KALP-system. Input: Household Income, Expenses, Existing Debts, Assets. Output: Affordability Metrics (DTI Ratio, Stress Test Results, Available Capacity).</td>
      </tr>
    
      <tr>
        <td>Evaluate household</td>
        <td>API</td>
        <td>/api/dmn/evaluate-household</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som utv√§rderar hush√•llsaffordability mot policykriterier. Input: Affordability Metrics, Loan Amount, Amortisation. Output: APPROVED / REJECTED + Reason.</td>
      </tr>
    
      <tr>
        <td>Evaluate stakeholders</td>
        <td>API</td>
        <td>/api/dmn/evaluate-stakeholders</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som utv√§rderar stakeholders per hush√•ll. Input: Stakeholder Data, Household Context. Output: APPROVED / REJECTED + Reason.</td>
      </tr>
    
      <tr>
        <td>Fetch risk classification</td>
        <td>API</td>
        <td>/api/risk/classify</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Service task som h√§mtar riskklassificering fr√•n risk engine. Input: Application Data, Credit Scores, Financial Data. Output: Risk Classification (Low / Medium / High), Risk Score, Risk Factors.</td>
      </tr>
    
      <tr>
        <td>Evaluate application</td>
        <td>API</td>
        <td>/api/dmn/evaluate-application</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som utv√§rderar hela ans√∂kan. Input: Risk Classification, Household Results, Stakeholder Results. Output: APPROVED / REJECTED / REVIEW_NEEDED + Reason.</td>
      </tr>
    
      <tr>
        <td>Evaluate credit policies</td>
        <td>API</td>
        <td>/api/dmn/evaluate-credit-policies</td>
        <td>POST</td>
        <td>https://api.sbab.se</td>
        <td>Business rule task som utv√§rderar mot alla kreditpolicyer och aff√§rsregler. Input: Application Data, LTV, Security, Loan Terms. Output: APPROVED / REJECTED + Policy Violations.</td>
      </tr>
    
      <tr>
        <td>Rejected gateway</td>
        <td>System</td>
        <td>Internal gateway logic</td>
        <td>-</td>
        <td>-</td>
        <td>Exclusive gateway som triggas n√§r n√•gon utv√§rdering avvisar (Evaluate household, Evaluate application, eller Evaluate credit policies). Processen avslutas med avslag.</td>
      </tr>
    
        </tbody>
      </table>
        </div>
      </details>
    </section>
    <section class="doc-section">
      <details>
        <summary>Effekt</summary>
        <div class="section-content">
<p class="muted">F√∂rv√§ntad aff√§rseffekt som uppn√•s med feature goalet.</p>
      <p>[Beskriv specifikt hur detta feature goal bidrar till aff√§rseffekter. T.ex. om feature goalet leder till √∂kad automatisering, beskriv hur specifikt detta feature goal bidrar till effekten. Var konkret och m√§tbar d√§r det √§r m√∂jligt.]</p>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>User stories</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska user stories som kan kopplas till feature goalet.</p>
      <ul>
        <li><strong>Som [roll]</strong> vill jag [m√•l] <strong>s√• att</strong> [v√§rde]</li>
        <li><strong>Som [roll]</strong> vill jag [m√•l] <strong>s√• att</strong> [v√§rde]</li>
        <li><strong>Som [roll]</strong> vill jag [m√•l] <strong>s√• att</strong> [v√§rde]</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Acceptanskriterier</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska acceptanskriterier som kan kopplas till feature goalet.</p>
      <ul>
        <li>[Acceptanskriterium 1: t.ex. "Systemet ska automatiskt utv√§rdera ans√∂kan mot aff√§rsregler och avg√∂ra beslutsniv√•"]</li>
        <li>[Acceptanskriterium 2: t.ex. "Ans√∂kningar med l√•g risk ska dirigeras till straight-through processing"]</li>
        <li>[Acceptanskriterium 3: t.ex. "Ans√∂kningar med h√∂g risk ska dirigeras till r√§tt beslutsniv√•"]</li>
      </ul>
        </div>
      </details>
    </section>
      </body>
</html>
