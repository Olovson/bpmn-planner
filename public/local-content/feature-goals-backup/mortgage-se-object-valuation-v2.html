<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="bpmn_file" content="mortgage-se-object-valuation.bpmn">
  <meta name="element_id" content="object-valuation">
  <meta name="version" content="v2">
  <title>Object valuation</title>
  <style>
    :root {
      --primary: #1d4ed8;
      --text-strong: #0f172a;
      --text-muted: #64748b;
      --border: #e2e8f0;
      --accent: #e0e7ff;
      --bg-light: #f8f9fa;
    }
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      margin: 0;
      padding: 24px;
      background: #ffffff;
      color: var(--text-strong);
      line-height: 1.6;
      max-width: 1200px;
      margin: 0 auto;
    }
    h1 {
      font-size: 2rem;
      margin: 0 0 32px;
      border-bottom: 2px solid var(--border);
      padding-bottom: 12px;
      color: var(--text-strong);
    }
    h2 {
      color: var(--primary);
      margin: 0;
      font-size: 1.5rem;
    }
    h3 {
      color: var(--text-strong);
      margin: 32px 0 12px;
      font-size: 1.2rem;
    }
    p { margin: 0 0 12px; }
    ul {
      padding-left: 24px;
      margin: 0 0 16px;
    }
    li { margin-bottom: 8px; }
    table {
      width: 100%;
      border-collapse: collapse;
      margin: 16px 0;
      background: white;
      border: 1px solid var(--border);
      border-radius: 6px;
      overflow: hidden;
    }
    table th,
    table td {
      border-bottom: 1px solid var(--border);
      padding: 12px;
      text-align: left;
    }
    table th {
      background: var(--accent);
      color: var(--primary);
      font-weight: 600;
    }
    table tr:last-child td {
      border-bottom: none;
    }
    .muted {
      color: var(--text-muted);
      font-size: 0.9rem;
      font-style: italic;
    }
    .card {
      background: var(--bg-light);
      padding: 20px;
      border-radius: 8px;
      margin: 16px 0;
      border-left: 4px solid var(--primary);
    }
    .doc-section {
      margin-bottom: 16px;
      background: white;
      border: 1px solid var(--border);
      border-radius: 8px;
      overflow: hidden;
    }
    .doc-section details {
      margin: 0;
    }
    .doc-section details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 16px 20px;
      background: var(--bg-light);
      border-bottom: 1px solid var(--border);
      user-select: none;
      font-size: 1.5rem;
      list-style: none;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .doc-section details summary::-webkit-details-marker {
      display: none;
    }
    .doc-section details summary::before {
      content: '▶';
      display: inline-block;
      transition: transform 0.2s;
      font-size: 0.8rem;
      color: var(--primary);
    }
    .doc-section details[open] summary::before {
      transform: rotate(90deg);
    }
    .doc-section details summary:hover {
      background: var(--accent);
    }
    .doc-section details .section-content {
      padding: 20px;
    }
    .doc-section details[open] summary {
      border-bottom: 1px solid var(--border);
    }
    .doc-badge {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: var(--accent);
      color: var(--primary);
      padding: 2px 10px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    .local-version-badge {
      background: #e0f2fe;
      color: #0369a1;
      padding: 8px 16px;
      margin: 16px 0;
      border-radius: 6px;
      border-left: 4px solid #0284c7;
      font-size: 0.9rem;
      font-weight: 500;
    }
    .llm-fallback-banner {
      padding: 8px 12px;
      margin-bottom: 16px;
      border-radius: 6px;
      background-color: #fefce8;
      color: #854d0e;
      border: 1px solid #fef9c3;
      font-size: 0.85rem;
    }
    .llm-fallback-badge {
      display: inline-block;
      padding: 4px 8px;
      margin-bottom: 12px;
      border-radius: 4px;
      background-color: #fff3cd;
      color: #856404;
      border: 1px solid #ffeeba;
      font-size: 0.9rem;
      font-weight: 600;
    }
    .llm-fallback-details {
      font-size: 0.8rem;
      color: #4b5563;
      margin-bottom: 16px;
      white-space: pre-wrap;
    }
    .llm-fallback-local-note {
      font-size: 0.8rem;
      color: #2563eb;
      margin-bottom: 16px;
    }
    details {
      margin: 16px 0;
    }
    details summary {
      cursor: pointer;
      font-weight: 600;
      color: var(--primary);
      padding: 12px;
      background: var(--bg-light);
      border: 1px solid var(--border);
      border-radius: 6px;
      user-select: none;
    }
    details summary:hover {
      background: var(--accent);
    }
    details[open] summary {
      border-bottom-left-radius: 0;
      border-bottom-right-radius: 0;
    }
    details .collapsible-content {
      padding: 16px;
      border: 1px solid var(--border);
      border-top: none;
      border-radius: 0 0 6px 6px;
      margin-top: 0;
    }
    img {
      max-width: 100%;
      height: auto;
      border: 1px solid var(--border);
      border-radius: 4px;
      margin: 12px 0;
    }
    a {
      color: var(--primary);
      text-decoration: none;
      font-weight: 500;
    }
    a:hover { text-decoration: underline; }
</style>
</head>
<body>
  
    
      
<h1>Object valuation</h1>
  
  <section class="doc-section">
      <details open>
        <summary>Beskrivning av FGoal</summary>
        <div class="section-content">
      <p>Object valuation är en automatiserad process där systemet hämtar objektvärdering från externa tjänster baserat på objekttyp. Processen anropas från huvudprocessen (Mortgage) när objektvärdering behövs för att bedöma objektets värde för låneansökan.</p>
      <p>Processen börjar med att systemet avgör objekttyp via "Object type" gateway. Om objektet är ett småhus, hämtar systemet fastighetsvärdering från "Fastighet valuation service" via "Fetch fastighets-valuation" service task. Om objektet är en bostadsrätt, hämtar systemet bostadsrättsvärdering från "Bostadsrätt valuation service" via "Fetch bostadsrätts-valuation" service task. Båda flödena sammanstrålar i en gateway innan processen avslutas.</p>
        </div>
      </details>
    </section>
<section class="doc-section">
      <details>
        <summary>Processteg - Input</summary>
        <div class="section-content">
      <p>Object Valuation-processen startar när:</p>
      <ul>
        <li><strong>Objektvärdering behövs:</strong> Processen anropas från huvudprocessen (Mortgage) när objektvärdering behövs för att bedöma objektets värde</li>
        <li><strong>Processkontext:</strong> Object Valuation anropas via "Object valuation" call activity. Alla relevanta processvariabler, inklusive objekttyp och identifierad objektinformation, skickas med för att säkerställa fullständig kontext</li>
        <li><strong>Objekttyp är identifierad eller kan identifieras:</strong> Systemet måste kunna avgöra om objektet är ett småhus eller en bostadsrätt för att välja rätt flöde</li>
        <li><strong>Externa tjänster är tillgängliga:</strong> "Fastighet valuation service" (för småhus) och "Bostadsrätt valuation service" (för bostadsrätter) måste vara tillgängliga för att hämta värdering</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Processteg - Output</summary>
        <div class="section-content">
      <p>När Object Valuation-processen är slutförd har följande resultat uppnåtts:</p>
      <ul>
        <li><strong>Objektvärdering är hämtad:</strong> Systemet har hämtat objektvärdering från rätt extern tjänst baserat på objekttyp</li>
        <li><strong>För småhus:</strong> Fastighetsvärdering har hämtats från "Fastighet valuation service" via "Fetch fastighets-valuation" service task och sparas i datastoren</li>
        <li><strong>För bostadsrätter:</strong> Bostadsrättsvärdering har hämtats från "Bostadsrätt valuation service" via "Fetch bostadsrätts-valuation" service task och sparas i datastoren</li>
        <li><strong>Processen avslutas normalt:</strong> När objektvärdering är hämtad, avslutas processen normalt och huvudprocessen fortsätter med nästa steg baserat på värderingen</li>
        <li><strong>Värdering är tillgänglig:</strong> Objektvärderingen är tillgänglig för huvudprocessen för vidare bearbetning och beslut</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Omfattning</summary>
        <div class="section-content">
      <p>Object Valuation-processen omfattar följande huvudsteg och aktiviteter:</p>
      
      <h3>1. Objekttyp-identifiering</h3>
      <ul>
        <li><strong>Object type (gateway):</strong> En beslutspunkt avgör objekttyp:
          <ul>
            <li><strong>Småhus:</strong> Processen går till "Fetch fastighets-valuation" service task</li>
            <li><strong>Bostadsrätt:</strong> Processen går till "Fetch bostadsrätts-valuation" service task</li>
          </ul>
        </li>
      </ul>

      <h3>2. Hämtning av värdering</h3>
      <ul>
        <li><strong>Fetch fastighets-valuation (service task, för småhus):</strong> Systemet hämtar fastighetsvärdering från "Fastighet valuation service" datastore. Värdering sparas i datastoren för vidare användning</li>
        <li><strong>Fetch bostadsrätts-valuation (service task, för bostadsrätter):</strong> Systemet hämtar bostadsrättsvärdering från "Bostadsrätt valuation service" datastore. Värdering sparas i datastoren för vidare användning</li>
      </ul>

      <h3>3. Avslut</h3>
      <ul>
        <li><strong>Gateway_0f8c0ne (gateway):</strong> Båda flödena (småhus och bostadsrätt) sammanstrålar i denna gateway innan processen avslutas</li>
        <li><strong>Processen avslutas normalt:</strong> När objektvärdering är hämtad, avslutas processen normalt och huvudprocessen fortsätter med nästa steg</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Avgränsning</summary>
        <div class="section-content">
<ul>
        <li>Manuell värdering (värderare fastställer objektets värde) ingår inte - den sker i Object Control-processen</li>
        <li>Kreditevaluering sker i separata subprocesser, inte i denna subprocess</li>
        <li>Dokumentationshantering sker i andra subprocesser, inte i denna subprocess</li>
        <li>Denna subprocess fokuserar enbart på automatisk hämtning av värdering, inte på manuell värdering eller dokumentation</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Beroenden</summary>
        <div class="section-content">
<ul>
        <li><strong>Mortgage huvudprocess:</strong> Object Valuation anropas från mortgage.bpmn när objektvärdering behövs</li>
        <li><strong>Fastighet valuation service:</strong> För att hämta fastighetsvärdering för småhus</li>
        <li><strong>Bostadsrätt valuation service:</strong> För att hämta bostadsrättsvärdering för bostadsrätter</li>
        <li><strong>Objekttyp måste vara identifierad:</strong> Systemet måste kunna avgöra om objektet är ett småhus eller en bostadsrätt för att välja rätt flöde</li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>BPMN - Process</summary>
        <div class="section-content">
      <p><a href="#/bpmn/mortgage-se-object-valuation.bpmn">Visa BPMN-processen för Object valuation</a></p>
      
      <h3>Processflöde - Steg för steg</h3>
      <ol>
        <li><strong>Start:</strong> Processen startar när Object Valuation anropas från huvudprocessen (Mortgage) via "Object valuation" call activity</li>
        <li><strong>Object type (gateway):</strong> En beslutspunkt avgör objekttyp:
          <ul>
            <li><strong>Småhus:</strong> Processen går till "Fetch fastighets-valuation" service task</li>
            <li><strong>Bostadsrätt:</strong> Processen går till "Fetch bostadsrätts-valuation" service task</li>
          </ul>
        </li>
        <li><strong>För småhus - Fetch fastighets-valuation (service task):</strong> Systemet hämtar fastighetsvärdering från "Fastighet valuation service" datastore</li>
        <li><strong>För bostadsrätter - Fetch bostadsrätts-valuation (service task):</strong> Systemet hämtar bostadsrättsvärdering från "Bostadsrätt valuation service" datastore</li>
        <li><strong>Gateway_0f8c0ne (gateway):</strong> Båda flödena sammanstrålar i denna gateway</li>
        <li><strong>Avslut:</strong> När objektvärdering är hämtad, avslutas processen normalt och huvudprocessen fortsätter med nästa steg</li>
      </ol>
      
      <h3>Viktiga beslutspunkter</h3>
      <ul>
        <li><strong>Object type (gateway):</strong> Avgör om objektet är ett småhus eller en bostadsrätt. Detta styr vilket flöde som används för att hämta värdering</li>
      </ul>
        </div>
      </details>
    </section>    <section class="doc-section">
      <details>
        <summary>Effekt</summary>
        <div class="section-content">
<p class="muted">Förväntad affärseffekt som uppnås med feature goalet.</p>
      
      <h3>Automatiserad värderingshämtning</h3>
      <p>Genom automatisk hämtning av objektvärdering från externa tjänster ("Fastighet valuation service" för småhus, "Bostadsrätt valuation service" för bostadsrätter) elimineras behovet av manuell datainmatning. Detta kan minska handläggningstid med upp till 60-70% för objektvärdering jämfört med manuell process, särskilt för objekt där värdering redan finns i externa system.</p>
      
      <h3>Konsistent värderingshantering</h3>
      <p>Genom att använda samma process för både småhus och bostadsrätter (med olika flöden baserat på objekttyp) säkerställs konsistent värderingshantering oavsett objekttyp. Detta kan minska risken för felaktig värdering med upp till 30-40% och förbättra kvaliteten på beslutsunderlaget.</p>
      
      <h3>Återanvändbar process</h3>
      <p>Genom att Object Valuation är en återanvändbar call activity som kan anropas från huvudprocessen elimineras duplicerad logik och säkerställs konsistent värderingshantering. Detta kan minska underhållskostnader med upp till 25-35% och förbättra systemets övergripande kvalitet.</p>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>User stories</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska user stories som kan kopplas till feature goalet.</p>
      
      <h3>Systemperspektiv</h3>
      <ul>
        <li><strong>Som system</strong> vill jag automatiskt hämta objektvärdering från externa tjänster ("Fastighet valuation service" för småhus, "Bostadsrätt valuation service" för bostadsrätter) via "Fetch fastighets-valuation" och "Fetch bostadsrätts-valuation" service tasks <strong>så att</strong> värdering är tillgänglig utan manuell datainmatning. <em>Acceptanskriterier: Systemet ska automatiskt identifiera objekttyp via "Object type" gateway och hämta värdering från rätt extern tjänst baserat på objekttyp.</em></li>
      </ul>
      
      <h3>Handläggarperspektiv</h3>
      <ul>
        <li><strong>Som handläggare</strong> vill jag att systemet automatiskt hämtar objektvärdering <strong>så att</strong> jag får värdering direkt utan att behöva manuellt söka i externa system, vilket sparar tid. <em>Acceptanskriterier: Systemet ska automatiskt hämta objektvärdering från externa tjänster baserat på objekttyp, och värderingen ska vara tillgänglig för vidare bearbetning.</em></li>
      </ul>
        </div>
      </details>
    </section>

    <section class="doc-section">
      <details>
        <summary>Acceptanskriterier</summary>
        <div class="section-content">
<p class="muted">Relevanta och realistiska acceptanskriterier som kan kopplas till feature goalet.</p>
      
      <h3>Objekttyp-identifiering</h3>
      <ul>
        <li>"Object type" gateway ska korrekt identifiera om objektet är ett småhus eller en bostadsrätt. Om "Småhus", ska processen gå till "Fetch fastighets-valuation" service task. Om "Bostadsrätt", ska processen gå till "Fetch bostadsrätts-valuation" service task</li>
      </ul>
      
      <h3>Hämtning av objektvärdering</h3>
      <ul>
        <li>För småhus: "Fetch fastighets-valuation" service task ska automatiskt hämta fastighetsvärdering från "Fastighet valuation service" datastore. Värdering ska sparas i datastoren för vidare användning</li>
        <li>För bostadsrätter: "Fetch bostadsrätts-valuation" service task ska automatiskt hämta bostadsrättsvärdering från "Bostadsrätt valuation service" datastore. Värdering ska sparas i datastoren för vidare användning</li>
      </ul>
      
      <h3>Processflöde och avslut</h3>
      <ul>
        <li>Båda flödena (småhus och bostadsrätt) ska sammanstråla i Gateway_0f8c0ne innan processen avslutas</li>
        <li>När objektvärdering är hämtad, ska processen avslutas normalt och huvudprocessen fortsätta med nästa steg baserat på värderingen</li>
      </ul>
      
      <h3>Processvariabler och data</h3>
      <ul>
        <li>Alla processvariabler ska skickas med när Object Valuation anropas från huvudprocessen för att säkerställa fullständig kontext</li>
        <li>Objektvärdering som hämtas från externa tjänster ska korrekt sparas i datastores ("Fastighet valuation service" för småhus, "Bostadsrätt valuation service" för bostadsrätter)</li>
        <li>Värderingen ska korrekt sparas och vara tillgänglig för huvudprocessen för vidare bearbetning</li>
      </ul>
      
      <h3>Felhantering</h3>
      <ul>
        <li>Om externa tjänster ("Fastighet valuation service" eller "Bostadsrätt valuation service") inte är tillgängliga, ska processen hantera felet på ett tydligt sätt (t.ex. via error event eller retry-mekanismer)</li>
        <li>Om värderingen inte kan hämtas, ska processen hantera felet på ett tydligt sätt och signalera till huvudprocessen</li>
      </ul>
        </div>
      </details>
    </section>
      </body>
</html>