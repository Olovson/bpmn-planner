<!DOCTYPE html>
<html lang="sv">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BPMN Renderer Test</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      margin: 0;
      padding: 20px;
      background: white;
      overflow: hidden;
    }
    #canvas {
      width: 100%;
      height: 100vh;
      min-height: 800px;
      max-height: 1200px;
      border: 1px solid #e2e8f0;
    }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/bpmn-js@18.8.0/dist/assets/diagram-js.css" />
  <link rel="stylesheet" href="https://unpkg.com/bpmn-js@18.8.0/dist/assets/bpmn-js.css" />
  <link rel="stylesheet" href="https://unpkg.com/bpmn-js@18.8.0/dist/assets/bpmn-font/css/bpmn-embedded.css" />
</head>
<body>
  <div id="canvas"></div>
  <script src="https://cdn.jsdelivr.net/npm/bpmn-js@18.8.0/dist/bpmn-viewer.production.min.js"></script>
  <script>
    const bpmnXML = "<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n<bpmn:definitions xmlns:bpmn=\"http://www.omg.org/spec/BPMN/20100524/MODEL\" xmlns:bpmndi=\"http://www.omg.org/spec/BPMN/20100524/DI\" xmlns:dc=\"http://www.omg.org/spec/DD/20100524/DC\" xmlns:camunda=\"http://camunda.org/schema/1.0/bpmn\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:di=\"http://www.omg.org/spec/DD/20100524/DI\" xmlns:bioc=\"http://bpmn.io/schema/bpmn/biocolor/1.0\" xmlns:color=\"http://www.omg.org/spec/BPMN/non-normative/color/1.0\" xmlns:modeler=\"http://camunda.org/schema/modeler/1.0\" id=\"Definitions_1dzbrd5\" targetNamespace=\"http://bpmn.io/schema/bpmn\" exporter=\"Camunda Modeler\" exporterVersion=\"5.40.0\" modeler:executionPlatform=\"Camunda Platform\" modeler:executionPlatformVersion=\"7.20.0\">\n  <bpmn:escalation id=\"Escalation_1v6p9v7\" name=\"application-rejected\" escalationCode=\"application-rejected\" />\n  <bpmn:escalation id=\"Escalation_0gwy918\" name=\"application-rejected\" escalationCode=\"application-rejected\" />\n  <bpmn:escalation id=\"Escalation_1hx638b\" name=\"application-rejected\" escalationCode=\"application-rejected\" />\n  <bpmn:escalation id=\"Escalation_1q0zgdt\" name=\"application-rejected\" escalationCode=\"application-rejected\" />\n  <bpmn:error id=\"Error_1y4topa\" name=\"application-aborted\" errorCode=\"application-aborted\" />\n  <bpmn:error id=\"Error_0wtalyh\" name=\"kyc-aborted\" errorCode=\"kyc-aborted\" />\n  <bpmn:error id=\"Error_030920h\" name=\"credit-evaluation-aborted\" errorCode=\"credit-evaluation-aborted\" />\n  <bpmn:escalation id=\"Escalation_26ogfaj\" name=\"reevaluation-required\" escalationCode=\"reevaluation-required\" />\n  <bpmn:escalation id=\"Escalation_2bbe9hr\" name=\"recalculation-needed\" escalationCode=\"recalculation-needed\" />\n  <bpmn:message id=\"Message_3g9un62\" name=\"event-appeal-requested\" />\n  <bpmn:escalation id=\"Escalation_3v2lrul\" name=\"proof-of-finance-rejected\" escalationCode=\"proof-of-finance-rejected\" />\n  <bpmn:escalation id=\"Escalation_3vubi88\" name=\"event-offer-rejected\" escalationCode=\"event-offer-rejected\" />\n  <bpmn:message id=\"Message_3blc0qh\" name=\"event-advance-paid-out\" />\n  <bpmn:escalation id=\"Escalation_1oa001l\" name=\"event-trigger-advance\" escalationCode=\"event-trigger-advance\" />\n  <bpmn:message id=\"Message_0j968r1\" name=\"update-party\" />\n  <bpmn:collaboration id=\"Collaboration_00t5o41\">\n    <bpmn:participant id=\"Participant_0b001dk\" name=\"Appeal\" processRef=\"mortgage-se-appeal\" />\n  </bpmn:collaboration>\n  <bpmn:process id=\"mortgage-se-appeal\" name=\"\" isExecutable=\"true\" camunda:historyTimeToLive=\"180\">\n    <bpmn:laneSet id=\"LaneSet_1i54wnh\">\n      <bpmn:lane id=\"Lane_1tcx2h4\" name=\"Stakeholder\">\n        <bpmn:flowNodeRef>Event_0ssbeto</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>submit-appeal</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>Gateway_1v59ktc</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>event-appeal-timeout</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>appeal-timeout</bpmn:flowNodeRef>\n      </bpmn:lane>\n      <bpmn:lane id=\"Lane_1i6gzl2\" name=\"Caseworker\">\n        <bpmn:flowNodeRef>screen-appeal</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>screening-accepted</bpmn:flowNodeRef>\n        <bpmn:flowNodeRef>Event_1pzbohb</bpmn:flowNodeRef>\n      </bpmn:lane>\n    </bpmn:laneSet>\n    <bpmn:startEvent id=\"Event_0ssbeto\">\n      <bpmn:outgoing>Flow_06bug8d</bpmn:outgoing>\n    </bpmn:startEvent>\n    <bpmn:userTask id=\"screen-appeal\" name=\"Screen appeal\">\n      <bpmn:incoming>Flow_0gd3wlg</bpmn:incoming>\n      <bpmn:outgoing>Flow_0rx2qaf</bpmn:outgoing>\n    </bpmn:userTask>\n    <bpmn:exclusiveGateway id=\"screening-accepted\" name=\"Screening accepted?\">\n      <bpmn:incoming>Flow_0rx2qaf</bpmn:incoming>\n      <bpmn:outgoing>screening-accepted-yes</bpmn:outgoing>\n      <bpmn:outgoing>screening-accepted-no</bpmn:outgoing>\n    </bpmn:exclusiveGateway>\n    <bpmn:endEvent id=\"Event_1pzbohb\">\n      <bpmn:incoming>screening-accepted-yes</bpmn:incoming>\n    </bpmn:endEvent>\n    <bpmn:userTask id=\"submit-appeal\" name=\"Submit appeal\">\n      <bpmn:incoming>Flow_0r8cpy6</bpmn:incoming>\n      <bpmn:outgoing>Flow_0gd3wlg</bpmn:outgoing>\n    </bpmn:userTask>\n    <bpmn:exclusiveGateway id=\"Gateway_1v59ktc\">\n      <bpmn:incoming>Flow_06bug8d</bpmn:incoming>\n      <bpmn:incoming>screening-accepted-no</bpmn:incoming>\n      <bpmn:outgoing>Flow_0r8cpy6</bpmn:outgoing>\n    </bpmn:exclusiveGateway>\n    <bpmn:boundaryEvent id=\"event-appeal-timeout\" attachedToRef=\"submit-appeal\">\n      <bpmn:outgoing>Flow_1iwfpvp</bpmn:outgoing>\n      <bpmn:timerEventDefinition id=\"TimerEventDefinition_1bzif96\">\n        <bpmn:timeDuration xsi:type=\"bpmn:tFormalExpression\">P30D</bpmn:timeDuration>\n      </bpmn:timerEventDefinition>\n    </bpmn:boundaryEvent>\n    <bpmn:sequenceFlow id=\"Flow_06bug8d\" sourceRef=\"Event_0ssbeto\" targetRef=\"Gateway_1v59ktc\" />\n    <bpmn:sequenceFlow id=\"Flow_0gd3wlg\" sourceRef=\"submit-appeal\" targetRef=\"screen-appeal\" />\n    <bpmn:sequenceFlow id=\"Flow_0rx2qaf\" sourceRef=\"screen-appeal\" targetRef=\"screening-accepted\" />\n    <bpmn:sequenceFlow id=\"screening-accepted-yes\" name=\"Yes\" sourceRef=\"screening-accepted\" targetRef=\"Event_1pzbohb\" />\n    <bpmn:sequenceFlow id=\"screening-accepted-no\" name=\"No\" sourceRef=\"screening-accepted\" targetRef=\"Gateway_1v59ktc\" />\n    <bpmn:sequenceFlow id=\"Flow_0r8cpy6\" sourceRef=\"Gateway_1v59ktc\" targetRef=\"submit-appeal\" />\n    <bpmn:sequenceFlow id=\"Flow_1iwfpvp\" sourceRef=\"event-appeal-timeout\" targetRef=\"appeal-timeout\" />\n    <bpmn:endEvent id=\"appeal-timeout\" name=\"Appeal timeout\">\n      <bpmn:incoming>Flow_1iwfpvp</bpmn:incoming>\n      <bpmn:escalationEventDefinition id=\"EscalationEventDefinition_0tsn8qt\" escalationRef=\"Escalation_34epnhh\" />\n    </bpmn:endEvent>\n  </bpmn:process>\n  <bpmn:escalation id=\"Escalation_34epnhh\" name=\"appeal-timeout\" escalationCode=\"appeal-timeout\" />\n  <bpmndi:BPMNDiagram id=\"BPMNDiagram_1\">\n    <bpmndi:BPMNPlane id=\"BPMNPlane_1\" bpmnElement=\"Collaboration_00t5o41\">\n      <bpmndi:BPMNShape id=\"Participant_0b001dk_di\" bpmnElement=\"Participant_0b001dk\" isHorizontal=\"true\">\n        <dc:Bounds x=\"153\" y=\"80\" width=\"1040\" height=\"510\" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Lane_1i6gzl2_di\" bpmnElement=\"Lane_1i6gzl2\" isHorizontal=\"true\">\n        <dc:Bounds x=\"183\" y=\"80\" width=\"1010\" height=\"230\" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Lane_1tcx2h4_di\" bpmnElement=\"Lane_1tcx2h4\" isHorizontal=\"true\">\n        <dc:Bounds x=\"183\" y=\"310\" width=\"1010\" height=\"280\" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Event_0ssbeto_di\" bpmnElement=\"Event_0ssbeto\">\n        <dc:Bounds x=\"252\" y=\"372\" width=\"36\" height=\"36\" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Activity_0vuo19w_di\" bpmnElement=\"screen-appeal\">\n        <dc:Bounds x=\"750\" y=\"180\" width=\"100\" height=\"80\" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Gateway_0lqz4f7_di\" bpmnElement=\"screening-accepted\" isMarkerVisible=\"true\">\n        <dc:Bounds x=\"965\" y=\"195\" width=\"50\" height=\"50\" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x=\"965\" y=\"255\" width=\"51\" height=\"27\" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Event_1pzbohb_di\" bpmnElement=\"Event_1pzbohb\">\n        <dc:Bounds x=\"1132\" y=\"202\" width=\"36\" height=\"36\" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Activity_047jh08_di\" bpmnElement=\"submit-appeal\">\n        <dc:Bounds x=\"530\" y=\"350\" width=\"100\" height=\"80\" />\n        <bpmndi:BPMNLabel />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Gateway_1v59ktc_di\" bpmnElement=\"Gateway_1v59ktc\" isMarkerVisible=\"true\">\n        <dc:Bounds x=\"395\" y=\"365\" width=\"50\" height=\"50\" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Event_10kz2ny_di\" bpmnElement=\"appeal-timeout\" bioc:stroke=\"#831311\" bioc:fill=\"#ffcdd2\" color:background-color=\"#ffcdd2\" color:border-color=\"#831311\">\n        <dc:Bounds x=\"612\" y=\"512\" width=\"36\" height=\"36\" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x=\"595\" y=\"555\" width=\"74\" height=\"14\" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id=\"Event_01lkini_di\" bpmnElement=\"event-appeal-timeout\">\n        <dc:Bounds x=\"612\" y=\"412\" width=\"36\" height=\"36\" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNEdge id=\"Flow_06bug8d_di\" bpmnElement=\"Flow_06bug8d\">\n        <di:waypoint x=\"288\" y=\"390\" />\n        <di:waypoint x=\"395\" y=\"390\" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_0gd3wlg_di\" bpmnElement=\"Flow_0gd3wlg\">\n        <di:waypoint x=\"630\" y=\"390\" />\n        <di:waypoint x=\"690\" y=\"390\" />\n        <di:waypoint x=\"690\" y=\"220\" />\n        <di:waypoint x=\"750\" y=\"220\" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_0rx2qaf_di\" bpmnElement=\"Flow_0rx2qaf\">\n        <di:waypoint x=\"850\" y=\"220\" />\n        <di:waypoint x=\"965\" y=\"220\" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_1xx8gqp_di\" bpmnElement=\"screening-accepted-yes\">\n        <di:waypoint x=\"1015\" y=\"220\" />\n        <di:waypoint x=\"1132\" y=\"220\" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x=\"1051\" y=\"202\" width=\"18\" height=\"14\" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_1snbiav_di\" bpmnElement=\"screening-accepted-no\">\n        <di:waypoint x=\"990\" y=\"195\" />\n        <di:waypoint x=\"990\" y=\"120\" />\n        <di:waypoint x=\"420\" y=\"120\" />\n        <di:waypoint x=\"420\" y=\"365\" />\n        <bpmndi:BPMNLabel>\n          <dc:Bounds x=\"1002\" y=\"146\" width=\"15\" height=\"14\" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_0r8cpy6_di\" bpmnElement=\"Flow_0r8cpy6\">\n        <di:waypoint x=\"445\" y=\"390\" />\n        <di:waypoint x=\"530\" y=\"390\" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNEdge id=\"Flow_1iwfpvp_di\" bpmnElement=\"Flow_1iwfpvp\">\n        <di:waypoint x=\"630\" y=\"448\" />\n        <di:waypoint x=\"630\" y=\"512\" />\n      </bpmndi:BPMNEdge>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</bpmn:definitions>\n";
    
    const viewer = new BpmnJS({
      container: '#canvas'
    });
    
    window.viewer = viewer;
    
    viewer.importXML(bpmnXML)
      .then(() => {
        const canvas = viewer.get('canvas');
        const elementRegistry = viewer.get('elementRegistry');
        
        const allElements = elementRegistry.getAll();
        let minX = Infinity, minY = Infinity, maxX = -Infinity, maxY = -Infinity;
        
        allElements.forEach(element => {
          if (element.x !== undefined && element.y !== undefined) {
            const x = element.x;
            const y = element.y;
            const width = element.width || 0;
            const height = element.height || 0;
            
            minX = Math.min(minX, x);
            minY = Math.min(minY, y);
            maxX = Math.max(maxX, x + width);
            maxY = Math.max(maxY, y + height);
          }
        });
        
        if (minX !== Infinity) {
          const diagramWidth = maxX - minX;
          const diagramHeight = maxY - minY;
          const diagramCenterX = minX + diagramWidth / 2;
          const diagramCenterY = minY + diagramHeight / 2;
          
          window.diagramBounds = {
            x: minX,
            y: minY,
            width: diagramWidth,
            height: diagramHeight,
            centerX: diagramCenterX,
            centerY: diagramCenterY
          };
          
          // Använd fit-viewport - detta säkerställer att hela diagrammet syns
          canvas.zoom('fit-viewport', 'auto');
          
          // INTE zoom in mer - låt fit-viewport vara så diagrammet fyller viewporten korrekt
        } else {
          canvas.zoom('fit-viewport', 'auto');
        }
        
        setTimeout(() => {
          window.renderComplete = true;
        }, 2000);
      })
      .catch(err => {
        console.error('Error rendering BPMN:', err);
        window.renderError = err.message || 'Unknown error';
        window.renderComplete = true;
      });
  </script>
</body>
</html>