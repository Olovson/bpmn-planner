# Cursor / Codex project rules - TEMPLATE
# 
# Kopiera denna fil till .cursorrules i nya projekt för att använda samma regler
# 
# Denna fil innehåller PERMANENTA GLOBALA REGLER som gäller för ALL kod, ALLA projekt

{
  "version": 3,
  "rules": [
    {
      "pattern": "tests/**/*.test.{ts,tsx,js,jsx}",
      "description": "Test files - PERMANENT GLOBAL RULE: NO DUPLICATED LOGIC, NO FALLBACKS",
      "instructions": [
        "⚠️ CRITICAL PERMANENT RULE - Applies to ALL code, ALL projects, FOREVER:",
        "",
        "1. NEVER duplicate production logic in tests. This makes debugging impossible because tests can pass while production fails.",
        "2. ALWAYS import and use the actual production code. If it's not exported, export it from production first.",
        "3. NEVER create fallback solutions in tests unless ABSOLUTELY necessary for test isolation (e.g., tmpdir() for file operations).",
        "4. Tests MUST use the same code paths as production. This is the ONLY way to catch bugs.",
        "5. If you find yourself copying code from production into tests, STOP IMMEDIATELY. Export it from production and import it instead.",
        "",
        "Practical rules:",
        "- When testing file operations, use tmpdir() to create temporary directories. Never use production paths.",
        "- Mock only external dependencies (APIs, databases, file system for isolation).",
        "- NEVER mock internal production code that you're testing.",
        "- If production code doesn't export what you need, export it from production code first, then import it in tests.",
        "",
        "This rule exists because:",
        "- Duplicated logic means tests can pass while production fails (false confidence).",
        "- Fallback solutions hide bugs and make debugging impossible.",
        "- Tests should validate production code, not a copy of it."
      ]
    }
  ]
}

